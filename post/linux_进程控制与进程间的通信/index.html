<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='https://y-m-m.github.io/js/theme-mode.js'></script>
    <link rel="stylesheet" href='https://y-m-m.github.io/css/frameworks.min.css' />
    <link rel="stylesheet" href='https://y-m-m.github.io/css/github.min.css' />
    <link rel="stylesheet" href='https://y-m-m.github.io/css/github-style.css' />
    <link rel="stylesheet" href='https://y-m-m.github.io/css/light.css' />
    <link rel="stylesheet" href='https://y-m-m.github.io/css/dark.css' />
    <link rel="stylesheet" href='https://y-m-m.github.io/css/syntax.css' />
    <title>Linux 进程控制与进程之间的通信 - 陈皮的博客</title>
    
    <link rel="icon" type="image/x-icon" href='/images/github-mark.png'>
    
    <meta name="theme-color" content="#1e2327">

    
    <meta name="description"
  content="进程的基本概念 进程的基本概念和逻辑内存 进程与程序
程序 指令和数据的集合 存放在磁盘上的一个普通文件里 文件的i节点中标为可执行，内容符合系统要求 进程 包括指令段、用户数据段和系统数据段的执行环境 进程与程序的关系 程序用于初始化进程的指令段和用户数据段，初始化后，进程和初始化它的程序之间无联系 进程运行时磁盘上的程序文件不可修改/删除 同时运行的多个进程可由统一程序初始化得到，进程之间没什么联系。内核通过安排它们共享指令段甚至不同程序的进程共享函数库(动态链接)以节省内存，但这种安排对用户来说是透明的 进程的组成部分
四部分：指令段、数据段、栈段和系统数据 指令段Text 程序的CPU指令代码,包括：主程序和子程序编译后的CPU指令代码，以及调用的库函数代码 指令段的大小固定不变，只读 用户数据段 全局变量，静态(static)变量，字符串常数 允许数据段增长和缩小，实现内存的动态分配 系统调用sbrk()允许编程调整数据段的大小（调整单位为“页”） 内存管理库函数，如：malloc()，free() sbrk vs. malloc sbrk malloc 用户栈段 程序执行所需要的栈空间，实现函数的调用 用于保存子程序返回地址 在函数和被调函数之间传递参数 函数体内部定义的变量(静态变量除外) main函数得到的命令行参数以及环境参数 存放在栈的最底部 main函数运行之前，这些部分就已经被系统初始化 栈段的动态增长与增长限制（getrlimit, setrlimit） 系统数据段 上述三部分在进程私有的独立的逻辑地址空间内（CPU用户态访问） 系统数据段是内核内的数据，每个进程对应一套 包括页表和进程控制块PCB 进程虚拟地址空间的布局 size命令观察可执行程序的段大小
size filename-list 列出程序或目标文件的相应段大小 Pentinum虚拟地址到物理地址转换 一个4K是一个页 VPN页号 VPO业内偏移量 术语 两级页表 虚实地址转换 PDE （Page Directory Entry） PTE （Page Table Entry） PDE与PTE中的标志位能解决的问题 内存越界 内存读写保护 缺页调入 利用磁盘交换区实现以较小物理内存提供较大逻辑内存的效果 栈段的生长 多进程共享内存，写时复制 LRU算法判断页有没有被访问 淘汰页面时判断是否需要回写磁盘 进程的执行状态 进程的系统数据
" />
<meta name="keywords"
  content='blog, google analytics' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://y-m-m.github.io/post/linux_%E8%BF%9B%E7%A8%8B%E6%8E%A7%E5%88%B6%E4%B8%8E%E8%BF%9B%E7%A8%8B%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Linux 进程控制与进程之间的通信 - 陈皮的博客" />
<meta name="twitter:description"
  content="进程的基本概念 进程的基本概念和逻辑内存 进程与程序
程序 指令和数据的集合 存放在磁盘上的一个普通文件里 文件的i节点中标为可执行，内容符合系统要求 进程 包括指令段、用户数据段和系统数据段的执行环境 进程与程序的关系 程序用于初始化进程的指令段和用户数据段，初始化后，进程和初始化它的程序之间无联系 进程运行时磁盘上的程序文件不可修改/删除 同时运行的多个进程可由统一程序初始化得到，进程之间没什么联系。内核通过安排它们共享指令段甚至不同程序的进程共享函数库(动态链接)以节省内存，但这种安排对用户来说是透明的 进程的组成部分
四部分：指令段、数据段、栈段和系统数据 指令段Text 程序的CPU指令代码,包括：主程序和子程序编译后的CPU指令代码，以及调用的库函数代码 指令段的大小固定不变，只读 用户数据段 全局变量，静态(static)变量，字符串常数 允许数据段增长和缩小，实现内存的动态分配 系统调用sbrk()允许编程调整数据段的大小（调整单位为“页”） 内存管理库函数，如：malloc()，free() sbrk vs. malloc sbrk malloc 用户栈段 程序执行所需要的栈空间，实现函数的调用 用于保存子程序返回地址 在函数和被调函数之间传递参数 函数体内部定义的变量(静态变量除外) main函数得到的命令行参数以及环境参数 存放在栈的最底部 main函数运行之前，这些部分就已经被系统初始化 栈段的动态增长与增长限制（getrlimit, setrlimit） 系统数据段 上述三部分在进程私有的独立的逻辑地址空间内（CPU用户态访问） 系统数据段是内核内的数据，每个进程对应一套 包括页表和进程控制块PCB 进程虚拟地址空间的布局 size命令观察可执行程序的段大小
size filename-list 列出程序或目标文件的相应段大小 Pentinum虚拟地址到物理地址转换 一个4K是一个页 VPN页号 VPO业内偏移量 术语 两级页表 虚实地址转换 PDE （Page Directory Entry） PTE （Page Table Entry） PDE与PTE中的标志位能解决的问题 内存越界 内存读写保护 缺页调入 利用磁盘交换区实现以较小物理内存提供较大逻辑内存的效果 栈段的生长 多进程共享内存，写时复制 LRU算法判断页有没有被访问 淘汰页面时判断是否需要回写磁盘 进程的执行状态 进程的系统数据
" />
<meta name="twitter:site" content="https://y-m-m.github.io/" />
<meta name="twitter:creator" content="陈皮" />
<meta name="twitter:image"
  content="https://y-m-m.github.io/">


<meta property="og:type" content="article" />
<meta property="og:title" content="Linux 进程控制与进程之间的通信 - 陈皮的博客">
<meta property="og:description"
  content="进程的基本概念 进程的基本概念和逻辑内存 进程与程序
程序 指令和数据的集合 存放在磁盘上的一个普通文件里 文件的i节点中标为可执行，内容符合系统要求 进程 包括指令段、用户数据段和系统数据段的执行环境 进程与程序的关系 程序用于初始化进程的指令段和用户数据段，初始化后，进程和初始化它的程序之间无联系 进程运行时磁盘上的程序文件不可修改/删除 同时运行的多个进程可由统一程序初始化得到，进程之间没什么联系。内核通过安排它们共享指令段甚至不同程序的进程共享函数库(动态链接)以节省内存，但这种安排对用户来说是透明的 进程的组成部分
四部分：指令段、数据段、栈段和系统数据 指令段Text 程序的CPU指令代码,包括：主程序和子程序编译后的CPU指令代码，以及调用的库函数代码 指令段的大小固定不变，只读 用户数据段 全局变量，静态(static)变量，字符串常数 允许数据段增长和缩小，实现内存的动态分配 系统调用sbrk()允许编程调整数据段的大小（调整单位为“页”） 内存管理库函数，如：malloc()，free() sbrk vs. malloc sbrk malloc 用户栈段 程序执行所需要的栈空间，实现函数的调用 用于保存子程序返回地址 在函数和被调函数之间传递参数 函数体内部定义的变量(静态变量除外) main函数得到的命令行参数以及环境参数 存放在栈的最底部 main函数运行之前，这些部分就已经被系统初始化 栈段的动态增长与增长限制（getrlimit, setrlimit） 系统数据段 上述三部分在进程私有的独立的逻辑地址空间内（CPU用户态访问） 系统数据段是内核内的数据，每个进程对应一套 包括页表和进程控制块PCB 进程虚拟地址空间的布局 size命令观察可执行程序的段大小
size filename-list 列出程序或目标文件的相应段大小 Pentinum虚拟地址到物理地址转换 一个4K是一个页 VPN页号 VPO业内偏移量 术语 两级页表 虚实地址转换 PDE （Page Directory Entry） PTE （Page Table Entry） PDE与PTE中的标志位能解决的问题 内存越界 内存读写保护 缺页调入 利用磁盘交换区实现以较小物理内存提供较大逻辑内存的效果 栈段的生长 多进程共享内存，写时复制 LRU算法判断页有没有被访问 淘汰页面时判断是否需要回写磁盘 进程的执行状态 进程的系统数据
" />
<meta property="og:url" content="https://y-m-m.github.io/post/linux_%E8%BF%9B%E7%A8%8B%E6%8E%A7%E5%88%B6%E4%B8%8E%E8%BF%9B%E7%A8%8B%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1/" />
<meta property="og:site_name" content="Linux 进程控制与进程之间的通信" />
<meta property="og:image"
  content="https://y-m-m.github.io/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2025-04-30 00:00:00 &#43;0000 UTC" />











</head>

<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="https://y-m-m.github.io/">
        <img class="octicon" height="32" width="32" src="/images/github-mark-white.png">
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button class="Header-link btn-link js-details-target" type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'">
        <svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" version="1.1" width="24">
          <path fill-rule="evenodd" d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z">
          </path>
        </svg>
      </button>
    </div>
    <div style="display: none;" id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
        <div class="position-relative">
          
          <form target="_blank" id="search-form" action="" accept-charset="UTF-8" method="get"
            autocomplete="off">
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
              <input type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q" value="" placeholder="Search" autocomplete="off">
            </label>
          </form>
          
        </div>
      </div>
    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="https://y-m-m.github.io/">
        <img class="octicon octicon-mark-github v-align-middle" height="32" width="32" src="/images/github-mark-white.png">
      </a>
    </div>
    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>

  <div id="search-result" class="container-lg px-3 new-discussion-timeline" style="display: none;">
</div>

  
<div class="application-main">
  <div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="https://y-m-m.github.io/">
                  <img class=" avatar-user"
                    src="/images/me.png"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="https://y-m-m.github.io/">陈皮</a>
                  </span>
                  <span class="path-divider">/</span>
                  <strong class="css-truncate css-truncate-target mr-1" style="max-width: 410px">
                    <a href="https://y-m-m.github.io/post/linux_%E8%BF%9B%E7%A8%8B%E6%8E%A7%E5%88%B6%E4%B8%8E%E8%BF%9B%E7%A8%8B%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1/">Linux 进程控制与进程之间的通信</a>
                  </strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Wed, 30 Apr 2025 00:00:00 &#43;0000"
                    class="no-wrap">
                    Wed, 30 Apr 2025 00:00:00 &#43;0000</relative-time>

                  
                  <span class="file-info-divider"></span>
                  Modified <relative-time datetime="Tue, 13 May 2025 10:28:11 &#43;0800"
                    class="no-wrap">
                    Tue, 13 May 2025 10:28:11 &#43;0800</relative-time>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style="z-index: 2">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    
                    <summary id="toc-toggle" onclick="clickToc()" class="btn btn-octicon m-0 mr-2 p-2">
                      <svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered">
                        <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
                      </svg>
                    </summary>
                    <details-menu class="SelectMenu" id="toc-details" style="display: none;">
                      <div class="SelectMenu-modal rounded-3 mt-1" style="max-height: 340px;">
                        <div class="SelectMenu-list SelectMenu-list--borderless p-2" style="overscroll-behavior: contain;" id="toc-list">
                        </div>
                      </div>
                    </details-menu>
                      5105 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                    
                    <a class="muted-link mr-3" href="https://y-m-m.github.io/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E4%B8%8E%E6%8A%80%E6%9C%AF">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      计算机科学与技术
                    </a>
                    
                    <a class="muted-link mr-3" href="https://y-m-m.github.io/tags/linux">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      Linux
                    </a>
                    
                    <a class="muted-link mr-3" href="https://y-m-m.github.io/tags/%E8%BF%9B%E7%A8%8B%E6%8E%A7%E5%88%B6%E4%B8%8E%E8%BF%9B%E7%A8%8B%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      进程控制与进程间的通信
                    </a>
                    
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5" style="z-index: 1">
                <article class="markdown-body entry-content container-lg"><h1 id="进程的基本概念">进程的基本概念</h1>
<h2 id="进程的基本概念和逻辑内存">进程的基本概念和逻辑内存</h2>
<ul>
<li>
<p>进程与程序</p>
<ul>
<li>程序
<ul>
<li>指令和数据的集合</li>
<li>存放在磁盘上的一个普通文件里</li>
<li>文件的i节点中标为可执行，内容符合系统要求</li>
</ul>
</li>
<li>进程
<ul>
<li>包括指令段、用户数据段和系统数据段的执行环境</li>
</ul>
</li>
<li>进程与程序的关系
<ul>
<li>程序用于初始化进程的指令段和用户数据段，初始化后，进程和初始化它的程序之间无联系</li>
<li>进程运行时磁盘上的程序文件不可修改/删除</li>
<li>同时运行的多个进程可由统一程序初始化得到，进程之间没什么联系。内核通过安排它们共享指令段甚至不同程序的进程共享函数库(动态链接)以节省内存，但这种安排对用户来说是透明的
<img src="/images/%E6%88%AA%E5%B1%8F2025-04-30%2008.08.25.png" alt=""></li>
</ul>
</li>
</ul>
</li>
<li>
<p>进程的组成部分</p>
<ul>
<li>四部分：指令段、数据段、栈段和系统数据
<ul>
<li>指令段Text
<ul>
<li>程序的CPU指令代码,包括：主程序和子程序编译后的CPU指令代码，以及调用的库函数代码</li>
<li>指令段的大小固定不变，只读</li>
</ul>
</li>
<li>用户数据段
<ul>
<li>全局变量，静态(static)变量，字符串常数</li>
<li>允许数据段增长和缩小，实现内存的动态分配
<ul>
<li>系统调用sbrk()允许编程调整数据段的大小（调整单位为“页”）</li>
<li>内存管理库函数，如：malloc()，free()</li>
</ul>
</li>
<li>sbrk vs. malloc
<img src="/images/%E6%88%AA%E5%B1%8F2025-04-30%2008.12.48.png" alt="">
<ul>
<li>sbrk</li>
<li>malloc</li>
</ul>
</li>
</ul>
</li>
<li>用户栈段
<ul>
<li>程序执行所需要的栈空间，实现函数的调用
<ul>
<li>用于保存子程序返回地址</li>
<li>在函数和被调函数之间传递参数</li>
<li>函数体内部定义的变量(静态变量除外)</li>
</ul>
</li>
<li>main函数得到的命令行参数以及环境参数
<ul>
<li>存放在栈的最底部</li>
<li>main函数运行之前，这些部分就已经被系统初始化</li>
</ul>
</li>
<li>栈段的动态增长与增长限制（getrlimit, setrlimit）</li>
</ul>
</li>
<li>系统数据段
<ul>
<li>上述三部分在进程私有的独立的逻辑地址空间内（CPU用户态访问）</li>
<li>系统数据段是内核内的数据，每个进程对应一套
<ul>
<li>包括页表和进程控制块PCB</li>
</ul>
</li>
</ul>
</li>
<li>进程虚拟地址空间的布局
<img src="/images/%E6%88%AA%E5%B1%8F2025-04-30%2008.17.21.png" alt=""></li>
</ul>
</li>
</ul>
</li>
<li>
<p>size命令观察可执行程序的段大小</p>
<ul>
<li>size filename-list 列出程序或目标文件的相应段大小
<img src="/images/%E6%88%AA%E5%B1%8F2025-04-30%2008.22.42.png" alt=""></li>
</ul>
</li>
<li>
<p>Pentinum虚拟地址到物理地址转换
<img src="/images/%E6%88%AA%E5%B1%8F2025-04-30%2008.23.37.png" alt=""></p>
<ul>
<li>一个4K是一个页</li>
<li>VPN页号</li>
<li>VPO业内偏移量</li>
<li>术语
<img src="/images/%E6%88%AA%E5%B1%8F2025-04-30%2008.30.52.png" alt=""></li>
<li>两级页表
<img src="/images/%E6%88%AA%E5%B1%8F2025-04-30%2008.31.37.png" alt=""></li>
<li>虚实地址转换
<img src="/images/%E6%88%AA%E5%B1%8F2025-04-30%2008.35.07.png" alt=""></li>
<li>PDE （Page Directory Entry）
<img src="/images/%E6%88%AA%E5%B1%8F2025-04-30%2008.35.59.png" alt=""></li>
<li>PTE （Page Table Entry）
<img src="/images/%E6%88%AA%E5%B1%8F2025-04-30%2008.36.26.png" alt=""></li>
<li>PDE与PTE中的标志位能解决的问题
<ul>
<li>内存越界</li>
<li>内存读写保护</li>
<li>缺页调入</li>
<li>利用磁盘交换区实现以较小物理内存提供较大逻辑内存的效果</li>
<li>栈段的生长</li>
<li>多进程共享内存，写时复制</li>
<li>LRU算法判断页有没有被访问</li>
<li>淘汰页面时判断是否需要回写磁盘</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="进程的执行状态">进程的执行状态</h2>
<ul>
<li>
<p>进程的系统数据</p>
<ul>
<li>在操作系统内核中，含有进程的属性，包括
<ul>
<li>页表（基地址寄存器PDBR）</li>
<li>打开的文件描述符表</li>
<li>核心态堆栈（几KB）</li>
<li>进程状态，优先级信息</li>
<li>当前目录(记录了当前目录的i-节点)，根目录</li>
<li>umask值</li>
<li>进程PID，PPID</li>
<li>进程主的实际UID/GID，有效UID/GID</li>
<li>进程组组号（一个终端上启动的所有进程构成一个进程组）</li>
</ul>
</li>
</ul>
</li>
<li>
<p>传统unix的user+proc结构</p>
<ul>
<li>user结构(约5000字节)，&lt;sys/user.h&gt;
<ul>
<li>进程运行时才需要的数据在user结构 (如打开的文件的描述符)</li>
<li>核心态堆栈占用了较多空间</li>
</ul>
</li>
<li>proc结构(约300字节)，&lt;sys/proc.h&gt;
<ul>
<li>进程不运行时也需要的管理信息存于proc结构 (如PID, PPID)</li>
<li>用户程序不能直接存取和修改进程的系统数据
<ul>
<li>系统调用可用来访问或修改这些属性</li>
<li>chdir， umask，open， close，setpgrp， getpid， getppid
<ul>
<li>chdir 改变当前进程的工作目录，将进程的当前工作目录改为path指定的路径，失败返回-1</li>
<li>umask 设置进程的文件创建源码，返回旧的umask值(权限计算：最终权限 = mode &amp; ~umask)</li>
<li>open 打开或创建文件，返回文件描述符，成功返回文件描述符fd，失败返回-1</li>
<li>close 关闭文件描述符，释放资源，失败返回-1</li>
<li>setpgrp 设置进程的进程组ID，将当前进程的PGID设置成自身或pgid</li>
<li>getpid 获取当前进程的PID</li>
<li>getppid 获取复进程的pid</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>进程的基本状态</p>
<ul>
<li>基本状态
<ul>
<li>进程创建之后，主要有运行状态和睡眠状态(也叫阻塞状态，等待状态，挂起状态，等等)</li>
<li>内核总是在分时处理运行状态的进程，而不顾那些处于睡眠状态的进程</li>
<li>睡眠状态的进程，在条件满足后转化为运行状态</li>
<li>进程在睡眠时，不占用CPU时间
<ul>
<li>注意：在编程时，尽量不要让程序处于忙等待状态</li>
</ul>
</li>
</ul>
</li>
<li>进程的调度
<ul>
<li>调度优先级
<ul>
<li>内核将可运行进程按优先级调度，高优先级进程优先</li>
<li>进程的优先级总在不停地发生变化</li>
<li>处于睡眠状态的进程一旦被叫醒后，被赋以高优先级，以保证人机会话操作和其它外设的响应速度</li>
<li>用户程序用nice()系统调用有限地调整进程的优先级
<img src="/images/%E6%88%AA%E5%B1%8F2025-04-30%2008.43.37.png" alt=""></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>命令ps</p>
<ul>
<li>功能
<ul>
<li>查阅进程状态(process status)(实际上就是将内核中PCB数组的内容有选择地打印出来)</li>
</ul>
</li>
<li>选项
<ul>
<li>用于控制列表的行数(进程范围)和列数(每进程列出的属性内容)</li>
<li>无选项：只列出在当前终端上启动的进程
<ul>
<li>列出的项目有：PID，TTY，TIME，COMMAND</li>
</ul>
</li>
<li>e选项：列出系统中所有的进程(进程范围)</li>
<li>f选项：以full格式列出每一个进程(控制列的数目)</li>
<li>l选项：以long格式列出每一个进程(控制列的数目)</li>
</ul>
</li>
<li>命令ps举例
<img src="/images/%E6%88%AA%E5%B1%8F2025-04-30%2008.58.21.png" alt=""></li>
</ul>
</li>
<li>
<p>命令ps列出的进程属性</p>
<ul>
<li>UID：用户ID(注册名)</li>
<li>PID：进程ID</li>
<li>C：CPU占用指数：最近一段时间(秒级别)进程占用CPU情况。不同系统算法不同，例如：正占CPU进程10ms加1，所有进程1秒衰减一半</li>
<li>PPID：父进程的PID</li>
<li>STIME：启动时间</li>
<li>SZ：进程逻辑内存大小(Size)</li>
<li>TTY：终端的名字</li>
<li>COMMAND：命令名</li>
<li>WCHAN：进程睡眠通道(Wait Channel)，进程阻塞在何处</li>
<li>TIME：累计执行时间(占用CPU的时间)</li>
<li>PRI：优先级</li>
<li>S：状态，S(Sleep)，R(Run)， Z(Zombie)</li>
</ul>
</li>
<li>
<p>time 进程的执行时间</p>
<ul>
<li>进程执行时间包括
<ul>
<li>睡眠时间，CPU时间(用户时间和系统时间)</li>
<li>外部命令/usr/bin/time和内部命令time输出的数据格式不同
<ul>
<li>/usr/bin/time find /usr -name &lsquo;*.c&rsquo; -print</li>
<li>Real 6.06 进程从开始到停止</li>
<li>User 0.36 用户态下CPU执行时间</li>
<li>System 2.13 内核态下CPU执行时间</li>
</ul>
</li>
<li>C-shell: time find /usr -name &lsquo;*.h&rsquo; -print
<ul>
<li>0.4u 6.2s 0:10 61% 4+28k 0+0io 0pf+0w</li>
</ul>
</li>
<li>与CPU时间有关的命令vmstat
<ul>
<li>$ vmstat 10
<img src="/images/%E6%88%AA%E5%B1%8F2025-04-30%2009.01.33.png" alt=""></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>系统调用times()</p>
<ul>
<li>当前进程CPU时间，已结束子进程占用过的CPU时间
<img src="/images/%E6%88%AA%E5%B1%8F2025-04-30%2009.03.18.png" alt=""></li>
<li>clock()
<ul>
<li>返回times()的四个CPU时间的总和。单位是1/CLOCKS_PER_SEC秒</li>
</ul>
</li>
<li>getrusage()函数，times()函数的升级版本
<ul>
<li>返回CPU时间，还返回表示资源使用状况的另外14个值，包括内存使用情况，I/O次数，进程切换次数</li>
</ul>
</li>
</ul>
</li>
<li>
<p>与时间有关的函数</p>
<ul>
<li>标准函数库中time()：获得当前时间坐标
<ul>
<li>坐标0为1970年1月1日零点，单位：秒</li>
<li>t=time(0);和time(&amp;t);都会使t值为当前时间坐标</li>
</ul>
</li>
<li>函数gettimeofday()
<ul>
<li>获得当前时间坐标，坐标的0是1970年1月1日零点</li>
<li>可以精确到微秒μs(10-6秒)</li>
</ul>
</li>
<li>mktime
<ul>
<li>将年月日时分秒转换为坐标值</li>
</ul>
</li>
<li>ctime()和asctime()，localtime()
<ul>
<li>坐标值和年月日时分秒转换</li>
</ul>
</li>
<li>strftime
<ul>
<li>定制表示日期和时间的字符串（包括年月日时分秒等）</li>
</ul>
</li>
</ul>
</li>
<li>
<p>忙等待
<img src="/images/%E6%88%AA%E5%B1%8F2025-04-30%2009.08.59.png" alt=""></p>
<ul>
<li>程序14行前增加sleep(1)：1秒定时轮询</li>
<li>select()调用可将睡眠时间设为10毫秒级精度</li>
</ul>
</li>
<li>
<p>进程的基本概念：小结</p>
<ul>
<li>什么叫程序，什么是进程，进程与程序的关系</li>
<li>进程的4个组成部分以及每部分的作用（与实际C源代码中变量和程序的对应关系）</li>
<li>进程逻辑地址空间的布局</li>
<li>以32位奔腾CPU为例理解虚实地址的转换是怎样实现的，需要哪些数据结构（PD，PDE，PT，PTE），软硬件如何配合以实现内存保护、栈生长、写时复制、缺页调入、LRU调度、多进程内存共享等功能</li>
<li>进程的系统数据以及获值方法</li>
<li>进程的基本状态，进程调度</li>
<li>通过具体的C实例代码解释进程状态切换</li>
<li>ps命令可观察到的进程的一些属性C，SZ，TIME</li>
<li>time、vmstat命令</li>
<li>系统调用times/clock/getrusage</li>
<li>与时间有关的几个库函数，时间坐标与年月日时分秒的转换</li>
<li>忙等待</li>
</ul>
</li>
</ul>
<h1 id="进程控制">进程控制</h1>
<h2 id="进程的生命周期">进程的生命周期</h2>
<ul>
<li>进程的用户数据
<img src="/images/%E6%88%AA%E5%B1%8F2025-05-08%2010.55.28.png" alt=""></li>
<li>进程的系统数据
<ul>
<li>在操作系统内核中，含有进程的属性，包括:
<ul>
<li>页表（32位奔腾CPU，页表作为管理数据约占已分配虚拟内存的1/1024）</li>
<li>打开的文件描述符表</li>
<li>核心态堆栈（几KB）</li>
<li>进程状态，优先级信息</li>
<li>当前目录(记录了当前目录的i-节点)，根目录</li>
<li>umask值</li>
<li>进程PID，PPID</li>
<li>进程主的实际UID/GID，有效UID/GID</li>
<li>进程组组号（一个终端上启动的所有进程构成一个进程组）</li>
</ul>
</li>
</ul>
</li>
<li>fork创建新进程
<ul>
<li>功能 int fork(void)
<ul>
<li>fork系统调用是创建新进程的唯一方式，没有参数</li>
<li>原先的进程称做“父进程”，新创建进程被称作“子进程”</li>
<li>完全复制：新进程的指令，用户数据段，堆栈段</li>
<li>部分复制：系统数据段</li>
</ul>
</li>
<li>fork返回值：父子进程都收到返回值，但不相同
<ul>
<li>1次调用，两次返回
<ul>
<li>父进程(返回值&gt;0，是子进程的PID)</li>
<li>子进程(返回值=0)，失败时返回-1</li>
</ul>
</li>
</ul>
</li>
<li>内核实现
<ul>
<li>创建新的PCB，复制父进程环境给子进程</li>
<li>父子进程可以共享程序的数据(例如：copy-on-write技术，COW)，但是系统核心的这些安排，对程序员透明</li>
</ul>
</li>
<li>fork举例
<ul>
<li>fork之后，父、子进程各自从fork()后面那条语句开始执行
<img src="/images/%E6%88%AA%E5%B1%8F2025-05-12%2021.12.22.png" alt="">
<img src="/images/%E6%88%AA%E5%B1%8F2025-05-12%2021.23.50.png" alt=""></li>
</ul>
</li>
</ul>
</li>
<li>exec系统调用
<ul>
<li>功能
<ul>
<li>用一个指定的程序文件，重新初始化一个进程</li>
<li>可指定新的命令行参数和环境参数(初始化堆栈底部)</li>
<li>exec不创建新进程，只是将当前进程重新初始化了指令段和用户数据段，堆栈段以及CPU的PC指针（指向新程序的main函数）</li>
</ul>
</li>
<li>6种格式exec系统调用
<ul>
<li>exec前缀，后跟一至两个字母
<ul>
<li>l—list, v—vector, e—env, p—path</li>
<li>l与v：指定命令行参数的两种方式，l以表的形式，v要事先组织成一个指针数组</li>
<li>e：需要指定envp来初始化进程</li>
<li>p：使用环境变量PATH查找可执行文件</li>
<li>六种格式的区别：不同的参数方式初始化堆栈底部
<img src="/images/%E6%88%AA%E5%B1%8F2025-05-13%2009.15.25.png" alt=""></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>命令行参数和环境参数
<ul>
<li>位于进程堆栈底部的初始化数据</li>
<li>访问命令行参数的方法(argc, argv)</li>
<li>访问环境参数的三种方法
<ul>
<li>通过C库定义的外部变量environ</li>
<li>main函数的第三个参数</li>
<li>getenv库函数调用
<img src="/images/%E6%88%AA%E5%B1%8F2025-05-13%2009.18.54.png" alt=""></li>
</ul>
</li>
</ul>
</li>
<li>&ldquo;僵尸进程&rdquo;(zombie或defunct)
<ul>
<li>进程生命期结束时的特殊状态
<ul>
<li>系统已经释放了进程占用的包括内存在内的系统资源，但仍在内核中保留进程的部分数据结构，记录进程的终止状态，等待父进程来“收尸”</li>
<li>父进程的“收尸”动作完成之后，“僵尸”进程不再存在</li>
</ul>
</li>
<li>僵尸进程占用资源很少，仅占用内核进程表资源
<ul>
<li>过多的僵尸进程会导致系统有限数目的进程表被用光</li>
</ul>
</li>
<li>孤儿进程
<ul>
<li>所有孤儿进程都作为1号进程（操作系统的init进程）的子进程</li>
<li>0号：调度进程 swapper</li>
<li>2号：页守护进程 page daemon</li>
</ul>
</li>
<li>wait系统调用
<ul>
<li>功能
<ul>
<li>等待进程的子进程终止</li>
<li>如果已经有子进程终止，则立即返回</li>
</ul>
</li>
<li>函数原型
<ul>
<li>#include &lt;sys/types.h&gt;</li>
<li>#include &lt;sys/wait.h&gt;</li>
<li>pid_t wait(int *stat_loc);</li>
<li>函数返回值为已终止的子进程PID</li>
</ul>
</li>
<li>waitpid()和wait3() : wait系统调用的升级版本，资源等管理信息
<img src="/images/%E6%88%AA%E5%B1%8F2025-05-13%2009.26.18.png" alt=""></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="自编shell-xsh0">自编shell: xsh0</h2>
<ul>
<li>字符串分割库函数strtok
<ul>
<li>char *strtok(char *str, char *tokens)</li>
<li>功能: 返回第一个单词的首字节指针
<img src="/images/%E6%88%AA%E5%B1%8F2025-05-13%2009.34.40.png" alt=""></li>
<li>将手工录入的命令行参数字符串转换成一个指针数组给exec使用</li>
<li>空格、制表符、换行都作为字符串结束标识</li>
<li>NULL指示继续分割</li>
<li>无从分割则返回NULL
<img src="/images/%E6%88%AA%E5%B1%8F2025-05-13%2009.40.10.png" alt="">
<img src="/images/%E6%88%AA%E5%B1%8F2025-05-13%2009.41.08.png" alt=""></li>
</ul>
</li>
<li>执行xsh0
<img src="/images/%E6%88%AA%E5%B1%8F2025-05-13%2009.46.49.png" alt=""></li>
<li>库函数system：运行一个命令
<ul>
<li>int system(char *string);
<ul>
<li>执行用字符串传递的shell命令，可使用管道符和重定向</li>
<li>库函数system()是利用系统调用fork，exec，wait实现的
<img src="/images/%E6%88%AA%E5%B1%8F2025-05-13%2009.57.13.png" alt=""></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="小结">小结</h2>
<ul>
<li>深入理解系统调用fork()</li>
<li>进程的命令行参数和环境变量：访问方法和在逻辑地址空间的位置</li>
<li>环境变量的三种访问方法</li>
<li>exec系统调用</li>
<li>exec的六种格式以及为何设置6种格式</li>
<li>僵尸进程</li>
<li>孤儿进程</li>
<li>wait：等待子进程终止并销毁僵尸子进程获取其退出状态</li>
<li>C语言库函数strtok</li>
<li>fork+exec+wait:xsh0.c</li>
<li>库函数system的作用</li>
</ul>
<h1 id="重定向与管道">重定向与管道</h1>
<h2 id="进程与文件描述符">进程与文件描述符</h2>
<ul>
<li>磁盘文件目录(分两级)
<ul>
<li>i节点，文件名</li>
</ul>
</li>
<li>活动文件目录(分三级)
<ul>
<li>文件描述符表FDT：每进程一张，PCB的user结构中
<ul>
<li>user结构中整型数组u_ofile记录进程打开的文件</li>
<li>文件描述符fd是u_ofile数组的下标</li>
</ul>
</li>
<li>系统文件表SFT：整个内核一张，file结构
<img src="/images/%E6%88%AA%E5%B1%8F2025-05-13%2010.05.18.png" alt=""></li>
<li>活动i节点表：整个内核一张，inode结构
<ul>
<li>内存中inode表是外存中inode的缓存</li>
<li>内存inode表里也有个专用的引用计数
<img src="/images/%E6%88%AA%E5%B1%8F2025-05-13%2010.06.00.png" alt=""></li>
</ul>
</li>
</ul>
</li>
<li>文件描述符的继承与关闭
<ul>
<li>fork创建的子进程继承父进程的文件描述符表</li>
<li>父进程在fork前打开的文件，父子进程有相同的文件偏移
<img src="/images/%E6%88%AA%E5%B1%8F2025-05-13%2010.06.52.png" alt=""></li>
<li>例
<img src="/images/%E6%88%AA%E5%B1%8F2025-05-13%2010.08.06.png" alt="">
<img src="/images/%E6%88%AA%E5%B1%8F2025-05-13%2010.11.10.png" alt=""></li>
</ul>
</li>
<li>close-on-exec标志
<ul>
<li>文件设置了close-on-exec标志，执行exec()系统会自动关闭这些文件
<ul>
<li>在open()调用的第二个参数里可以加O_CLOEXEC属性</li>
<li>通过系统调用fcntl()设置</li>
</ul>
</li>
<li>函数
<ul>
<li>#include &lt;fcntl.h&gt;</li>
<li>int fcntl (fd, cmd, arg);</li>
<li>cmd: F_GETFD 获取文件fd的控制字flag，控制字的比特0为close-on-exec标志位
<ul>
<li>flag = fcntl(fd, F_GETFD, 0);</li>
</ul>
</li>
<li>cmd: F_SETFD 设置文件fd的控制字 fcntl(fd, F_SETFD, flag);</li>
</ul>
</li>
<li>例
<ul>
<li>flags = fcntl(fd, F_GETFD, 0);</li>
<li>flags |= FD_CLOEXEC;</li>
<li>fcntl(fd, F_SETFD, flags);</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="重定向">重定向</h2>
<ul>
<li>文件描述符的复制
<ul>
<li>系统调用
<ul>
<li>int dup2(int fd1, int fd2);</li>
</ul>
</li>
<li>功能
<ul>
<li>复制文件描述符fd1到fd2
<ul>
<li>fd2可以是空闲的文件描述符</li>
<li>如果fd2是已打开文件，则关闭已打开文件
<img src="/images/%E6%88%AA%E5%B1%8F2025-05-13%2010.20.34.png" alt=""></li>
</ul>
</li>
<li>xsh1:输入输出重定向(1)
<img src="/images/%E6%88%AA%E5%B1%8F2025-05-13%2010.22.02.png" alt="">
<img src="/images/%E6%88%AA%E5%B1%8F2025-05-13%2010.27.50.png" alt="">
<img src="/images/%E6%88%AA%E5%B1%8F2025-05-13%2010.23.54.png" alt=""></li>
</ul>
</li>
</ul>
</li>
</ul>
</article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
<script type="application/javascript" src='https://y-m-m.github.io/js/toc.js'></script>
<link rel="stylesheet" href='https://y-m-m.github.io/css/toc.css' />

  
<div id="gitalk-container" class="gitalk-container"></div>
<link rel="stylesheet" href='https://y-m-m.github.io/css/gitalk.css'>
<script src='https://y-m-m.github.io/js/gitalk.min.js'></script>
<script>
  const gitalk = new Gitalk({
    clientID: 'Ov23livxKNtTlPeMjV2H',
    clientSecret: '6d3bc9f47a1296f29628a63701ea5624cd28a26b',
    repo: 'y-m-m.github.io',
    owner: 'Y-M-M',
    admin: ['Y-M-M'],
    id: eval("location.pathname"), 
    distractionFreeMode: false 
  });
  (function() {
    gitalk.render('gitalk-container');
  })();
</script>

</div>

  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="https://y-m-m.github.io/">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0">Theme by <a href='https://github.com/MeiK2333/github-style'>github-style</a></li>
      
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>
</body>

<script type="application/javascript" src="https://y-m-m.github.io/js/github-style.js"></script>





<script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js"></script>
<script type="application/javascript" src='https://y-m-m.github.io/js/search.js'></script>



</html>