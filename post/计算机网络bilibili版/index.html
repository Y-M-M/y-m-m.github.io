<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='https://y-m-m.github.io/js/theme-mode.js'></script>
    <link rel="stylesheet" href='https://y-m-m.github.io/css/frameworks.min.css' />
    <link rel="stylesheet" href='https://y-m-m.github.io/css/github.min.css' />
    <link rel="stylesheet" href='https://y-m-m.github.io/css/github-style.css' />
    <link rel="stylesheet" href='https://y-m-m.github.io/css/light.css' />
    <link rel="stylesheet" href='https://y-m-m.github.io/css/dark.css' />
    <link rel="stylesheet" href='https://y-m-m.github.io/css/syntax.css' />
    <title>计算机网络bilibili版 - 陈皮的博客</title>
    
    <link rel="icon" type="image/x-icon" href='/images/github-mark.png'>
    
    <meta name="theme-color" content="#1e2327">

    
    <meta name="description"
  content="bilibili 计算机网络微课堂
P1 概述 1.1 计算机网络在信息时代的作用 1.2 因特网概述 网络、互联网和因特网 网络Network：若干节点Node和连接这些节点的链路Link组成 多个网络还可以通过路由器互联起来，这样就构成了一个范围更大的网络，即互联网，因此，互联网是“网络的网络” 因特网Internet是世界上最大的互联网络 区别Internet（因特网，采用TCP/IP协议） 和 internet（互联网） 因特网发展的三个阶段 从单个网络ARPANET向互联网发展 逐步建成三级结构的因特网 逐步形成了多层次的ISP结构的因特网 基于ISP的三层结构的因特网 因特网服务提供者ISP(Internet Service Provider) 国际性区域（主干网） 第一层ISP 区域性或国家性覆盖规模 第二层ISP 大公司 本地ISP 校园网、企业网、住宅用户、无线移动 因特网的标准化工作 因特网的标准化工作对因特网的发展起到了非常重要的作用 面向公众 RFC技术文档可以免费下载 任何人都可以随时用电子邮件发表对某个文档的意见或建议 因特网协会ISOC是一个国际性组织，它负责对因特网进行全面管理，以及在世界范围内促进其发展和作用 制定因特网的正式标准需要经过以下4个阶段： 因特网草案（还不是RFC文档） 建议标准（从这个阶段开始就成为RFC文档） 草案标准 因特网标准 因特网的组成 边缘部分：由多有连接在因特网上的主机组成，是用户直接使用的，用来进行通信和资源共享 核心部分：由大量网络和连接这些网络的路由器组成，这部分市委边缘部分提供服务的（提供连通性和交换） 路由器：专用计算机，不称之为主机，是实现分组交换的关键部件，转发收到的分组 1.3 三种交换方式 电路交换circuit switching 电话两两连接 中间介质：电话交换机 电话交换机接通电话线的方式 从通信资源的分配角度来看，交换就是按照某种方式动态地分配传输线路的资源 用户线为单个用户所有 电话交换机之间的中继线共用 电路交换的三个步骤 建立连接（分配通信资源） 通话（一直占用通信资源） 释放连接（归还通信资源） 使用电路交换来传送计算机数据时，其线路的传输效率往往很低 比特流直达终点 优点 通信时延小 有序传输 没有冲突 适用范围广（模拟信号、数字信号） 实时性强 控制简单 缺点 建立连接时间长 线路独占、使用效率低 灵活性差 难以规格化（不同类型、不同速率的终端难以进行通信，难以进行差错控制） 分组交换Packet Switching 计算机网络通常采用
" />
<meta name="keywords"
  content='blog, google analytics' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://y-m-m.github.io/post/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9Cbilibili%E7%89%88/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="计算机网络bilibili版 - 陈皮的博客" />
<meta name="twitter:description"
  content="bilibili 计算机网络微课堂
P1 概述 1.1 计算机网络在信息时代的作用 1.2 因特网概述 网络、互联网和因特网 网络Network：若干节点Node和连接这些节点的链路Link组成 多个网络还可以通过路由器互联起来，这样就构成了一个范围更大的网络，即互联网，因此，互联网是“网络的网络” 因特网Internet是世界上最大的互联网络 区别Internet（因特网，采用TCP/IP协议） 和 internet（互联网） 因特网发展的三个阶段 从单个网络ARPANET向互联网发展 逐步建成三级结构的因特网 逐步形成了多层次的ISP结构的因特网 基于ISP的三层结构的因特网 因特网服务提供者ISP(Internet Service Provider) 国际性区域（主干网） 第一层ISP 区域性或国家性覆盖规模 第二层ISP 大公司 本地ISP 校园网、企业网、住宅用户、无线移动 因特网的标准化工作 因特网的标准化工作对因特网的发展起到了非常重要的作用 面向公众 RFC技术文档可以免费下载 任何人都可以随时用电子邮件发表对某个文档的意见或建议 因特网协会ISOC是一个国际性组织，它负责对因特网进行全面管理，以及在世界范围内促进其发展和作用 制定因特网的正式标准需要经过以下4个阶段： 因特网草案（还不是RFC文档） 建议标准（从这个阶段开始就成为RFC文档） 草案标准 因特网标准 因特网的组成 边缘部分：由多有连接在因特网上的主机组成，是用户直接使用的，用来进行通信和资源共享 核心部分：由大量网络和连接这些网络的路由器组成，这部分市委边缘部分提供服务的（提供连通性和交换） 路由器：专用计算机，不称之为主机，是实现分组交换的关键部件，转发收到的分组 1.3 三种交换方式 电路交换circuit switching 电话两两连接 中间介质：电话交换机 电话交换机接通电话线的方式 从通信资源的分配角度来看，交换就是按照某种方式动态地分配传输线路的资源 用户线为单个用户所有 电话交换机之间的中继线共用 电路交换的三个步骤 建立连接（分配通信资源） 通话（一直占用通信资源） 释放连接（归还通信资源） 使用电路交换来传送计算机数据时，其线路的传输效率往往很低 比特流直达终点 优点 通信时延小 有序传输 没有冲突 适用范围广（模拟信号、数字信号） 实时性强 控制简单 缺点 建立连接时间长 线路独占、使用效率低 灵活性差 难以规格化（不同类型、不同速率的终端难以进行通信，难以进行差错控制） 分组交换Packet Switching 计算机网络通常采用
" />
<meta name="twitter:site" content="https://y-m-m.github.io/" />
<meta name="twitter:creator" content="陈皮" />
<meta name="twitter:image"
  content="https://y-m-m.github.io/">


<meta property="og:type" content="article" />
<meta property="og:title" content="计算机网络bilibili版 - 陈皮的博客">
<meta property="og:description"
  content="bilibili 计算机网络微课堂
P1 概述 1.1 计算机网络在信息时代的作用 1.2 因特网概述 网络、互联网和因特网 网络Network：若干节点Node和连接这些节点的链路Link组成 多个网络还可以通过路由器互联起来，这样就构成了一个范围更大的网络，即互联网，因此，互联网是“网络的网络” 因特网Internet是世界上最大的互联网络 区别Internet（因特网，采用TCP/IP协议） 和 internet（互联网） 因特网发展的三个阶段 从单个网络ARPANET向互联网发展 逐步建成三级结构的因特网 逐步形成了多层次的ISP结构的因特网 基于ISP的三层结构的因特网 因特网服务提供者ISP(Internet Service Provider) 国际性区域（主干网） 第一层ISP 区域性或国家性覆盖规模 第二层ISP 大公司 本地ISP 校园网、企业网、住宅用户、无线移动 因特网的标准化工作 因特网的标准化工作对因特网的发展起到了非常重要的作用 面向公众 RFC技术文档可以免费下载 任何人都可以随时用电子邮件发表对某个文档的意见或建议 因特网协会ISOC是一个国际性组织，它负责对因特网进行全面管理，以及在世界范围内促进其发展和作用 制定因特网的正式标准需要经过以下4个阶段： 因特网草案（还不是RFC文档） 建议标准（从这个阶段开始就成为RFC文档） 草案标准 因特网标准 因特网的组成 边缘部分：由多有连接在因特网上的主机组成，是用户直接使用的，用来进行通信和资源共享 核心部分：由大量网络和连接这些网络的路由器组成，这部分市委边缘部分提供服务的（提供连通性和交换） 路由器：专用计算机，不称之为主机，是实现分组交换的关键部件，转发收到的分组 1.3 三种交换方式 电路交换circuit switching 电话两两连接 中间介质：电话交换机 电话交换机接通电话线的方式 从通信资源的分配角度来看，交换就是按照某种方式动态地分配传输线路的资源 用户线为单个用户所有 电话交换机之间的中继线共用 电路交换的三个步骤 建立连接（分配通信资源） 通话（一直占用通信资源） 释放连接（归还通信资源） 使用电路交换来传送计算机数据时，其线路的传输效率往往很低 比特流直达终点 优点 通信时延小 有序传输 没有冲突 适用范围广（模拟信号、数字信号） 实时性强 控制简单 缺点 建立连接时间长 线路独占、使用效率低 灵活性差 难以规格化（不同类型、不同速率的终端难以进行通信，难以进行差错控制） 分组交换Packet Switching 计算机网络通常采用
" />
<meta property="og:url" content="https://y-m-m.github.io/post/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9Cbilibili%E7%89%88/" />
<meta property="og:site_name" content="计算机网络bilibili版" />
<meta property="og:image"
  content="https://y-m-m.github.io/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2024-03-07 00:00:00 &#43;0000 UTC" />











</head>

<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="https://y-m-m.github.io/">
        <img class="octicon" height="32" width="32" src="/images/github-mark-white.png">
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button class="Header-link btn-link js-details-target" type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'">
        <svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" version="1.1" width="24">
          <path fill-rule="evenodd" d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z">
          </path>
        </svg>
      </button>
    </div>
    <div style="display: none;" id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
        <div class="position-relative">
          
          <form target="_blank" id="search-form" action="" accept-charset="UTF-8" method="get"
            autocomplete="off">
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
              <input type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q" value="" placeholder="Search" autocomplete="off">
            </label>
          </form>
          
        </div>
      </div>
    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="https://y-m-m.github.io/">
        <img class="octicon octicon-mark-github v-align-middle" height="32" width="32" src="/images/github-mark-white.png">
      </a>
    </div>
    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>

  <div id="search-result" class="container-lg px-3 new-discussion-timeline" style="display: none;">
</div>

  
<div class="application-main">
  <div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="https://y-m-m.github.io/">
                  <img class=" avatar-user"
                    src="/images/me.png"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="https://y-m-m.github.io/">陈皮</a>
                  </span>
                  <span class="path-divider">/</span>
                  <strong class="css-truncate css-truncate-target mr-1" style="max-width: 410px">
                    <a href="https://y-m-m.github.io/post/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9Cbilibili%E7%89%88/">计算机网络bilibili版</a>
                  </strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Thu, 07 Mar 2024 00:00:00 &#43;0000"
                    class="no-wrap">
                    Thu, 07 Mar 2024 00:00:00 &#43;0000</relative-time>

                  
                  <span class="file-info-divider"></span>
                  Modified <relative-time datetime="Tue, 22 Oct 2024 14:59:55 &#43;0800"
                    class="no-wrap">
                    Tue, 22 Oct 2024 14:59:55 &#43;0800</relative-time>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style="z-index: 2">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    
                    <summary id="toc-toggle" onclick="clickToc()" class="btn btn-octicon m-0 mr-2 p-2">
                      <svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered">
                        <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
                      </svg>
                    </summary>
                    <details-menu class="SelectMenu" id="toc-details" style="display: none;">
                      <div class="SelectMenu-modal rounded-3 mt-1" style="max-height: 340px;">
                        <div class="SelectMenu-list SelectMenu-list--borderless p-2" style="overscroll-behavior: contain;" id="toc-list">
                        </div>
                      </div>
                    </details-menu>
                      55772 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                    
                    <a class="muted-link mr-3" href="https://y-m-m.github.io/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      计算机科学
                    </a>
                    
                    <a class="muted-link mr-3" href="https://y-m-m.github.io/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      计算机网络
                    </a>
                    
                    <a class="muted-link mr-3" href="https://y-m-m.github.io/tags/%E7%AC%94%E8%AE%B0">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      笔记
                    </a>
                    
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5" style="z-index: 1">
                <article class="markdown-body entry-content container-lg"><p>bilibili 计算机网络微课堂</p>
<h1 id="p1-概述">P1 概述</h1>
<h2 id="11-计算机网络在信息时代的作用">1.1 计算机网络在信息时代的作用</h2>
<h2 id="12-因特网概述">1.2 因特网概述</h2>
<h3 id="网络互联网和因特网">网络、互联网和因特网</h3>
<ul>
<li>网络Network：若干节点Node和连接这些节点的链路Link组成</li>
<li>多个网络还可以通过路由器互联起来，这样就构成了一个范围更大的网络，即互联网，因此，互联网是“网络的网络”</li>
<li>因特网Internet是世界上最大的互联网络</li>
<li>区别Internet（因特网，采用TCP/IP协议） 和 internet（互联网）</li>
</ul>
<h3 id="因特网发展的三个阶段">因特网发展的三个阶段</h3>
<ul>
<li>从单个网络ARPANET向互联网发展</li>
<li>逐步建成三级结构的因特网</li>
<li>逐步形成了多层次的ISP结构的因特网</li>
</ul>
<h3 id="基于isp的三层结构的因特网">基于ISP的三层结构的因特网</h3>
<ul>
<li>因特网服务提供者ISP(Internet Service Provider)</li>
<li>国际性区域（主干网） 第一层ISP</li>
<li>区域性或国家性覆盖规模 第二层ISP 大公司</li>
<li>本地ISP 校园网、企业网、住宅用户、无线移动</li>
</ul>
<h3 id="因特网的标准化工作">因特网的标准化工作</h3>
<ul>
<li>因特网的标准化工作对因特网的发展起到了非常重要的作用</li>
<li>面向公众
<ul>
<li>RFC技术文档可以免费下载</li>
<li>任何人都可以随时用电子邮件发表对某个文档的意见或建议</li>
</ul>
</li>
<li>因特网协会ISOC是一个国际性组织，它负责对因特网进行全面管理，以及在世界范围内促进其发展和作用</li>
<li>制定因特网的正式标准需要经过以下4个阶段：
<ul>
<li>因特网草案（还不是RFC文档）</li>
<li>建议标准（从这个阶段开始就成为RFC文档）</li>
<li>草案标准</li>
<li>因特网标准</li>
</ul>
</li>
</ul>
<h3 id="因特网的组成">因特网的组成</h3>
<ul>
<li>边缘部分：由多有连接在因特网上的主机组成，是用户直接使用的，用来进行通信和资源共享</li>
<li>核心部分：由大量网络和连接这些网络的路由器组成，这部分市委边缘部分提供服务的（提供连通性和交换）
<ul>
<li>路由器：专用计算机，不称之为主机，是实现分组交换的关键部件，转发收到的分组</li>
</ul>
</li>
</ul>
<h2 id="13-三种交换方式">1.3 三种交换方式</h2>
<h3 id="电路交换circuit-switching">电路交换circuit switching</h3>
<ul>
<li>电话两两连接</li>
<li>中间介质：电话交换机</li>
<li>电话交换机接通电话线的方式</li>
<li>从通信资源的分配角度来看，交换就是按照某种方式动态地分配传输线路的资源</li>
<li>用户线为单个用户所有</li>
<li>电话交换机之间的中继线共用</li>
<li>电路交换的三个步骤
<ul>
<li>建立连接（分配通信资源）</li>
<li>通话（一直占用通信资源）</li>
<li>释放连接（归还通信资源）</li>
</ul>
</li>
<li>使用电路交换来传送计算机数据时，其线路的传输效率往往很低</li>
<li>比特流直达终点</li>
<li>优点
<ul>
<li>通信时延小</li>
<li>有序传输</li>
<li>没有冲突</li>
<li>适用范围广（模拟信号、数字信号）</li>
<li>实时性强</li>
<li>控制简单</li>
</ul>
</li>
<li>缺点
<ul>
<li>建立连接时间长</li>
<li>线路独占、使用效率低</li>
<li>灵活性差</li>
<li>难以规格化（不同类型、不同速率的终端难以进行通信，难以进行差错控制）</li>
</ul>
</li>
</ul>
<h3 id="分组交换packet-switching">分组交换Packet Switching</h3>
<ul>
<li>
<p>计算机网络通常采用</p>
</li>
<li>
<p>报文-&gt;加首部-&gt;包（分组） 首部中包含了分组的目的地址</p>
</li>
<li>
<p>分组从源站到目的栈可以走不同的路由器；分组从源站到目的栈顺序可能会发生改变</p>
</li>
<li>
<p>发送方：构造分组、发送分组</p>
</li>
<li>
<p>路由器：缓存分组、转发分组</p>
</li>
<li>
<p>接收方：接受分组、还原报文</p>
</li>
<li>
<p>分组在各节点交换机上存储、转发，相比报文交换，减少转发时延，避免过长的报文长时间占用链路，同时也有利于进行差错控制</p>
</li>
<li>
<p>优点</p>
<ul>
<li>无需建立连接</li>
<li>线路利用率高</li>
<li>简化了存储管理</li>
<li>加速传输</li>
<li>减少出错概率和重发数据量</li>
</ul>
</li>
<li>
<p>缺点</p>
<ul>
<li>引起了转发时延</li>
<li>需要传输额外的信息量</li>
<li>对于数据服务，存在失序、丢失或重复分组的问题；对于虚电路服务（面向连接），存在呼叫建立、数据传输和虚电路释放三个过程</li>
</ul>
</li>
</ul>
<h3 id="报文交换message-switching">报文交换Message Switching</h3>
<ul>
<li>主要用于早期的电报通信网</li>
<li>节点交换机进行存储、转发，需要有较大的空间</li>
<li>优点
<ul>
<li>无需建立连接</li>
<li>动态分配线路</li>
<li>提高线路可靠性</li>
<li>提高线路利用率</li>
<li>提供多目标服务</li>
</ul>
</li>
<li>缺点
<ul>
<li>引起了转发时延</li>
<li>需要较大的存储缓存空间</li>
<li>需要传输额外的信息量</li>
</ul>
</li>
</ul>
<h2 id="14-计算机网络的定义和分类">1.4 计算机网络的定义和分类</h2>
<h3 id="计算机网络的定义">计算机网络的定义</h3>
<ul>
<li>计算机网络的精确定义并未统一</li>
<li>简单的定义：计算机网络是一些相互连接的、自治的计算机的集合
<ul>
<li>互连：计算机之间可以通过有线的或无线的方式进行数据通信</li>
<li>自治：独立的计算机，它有自己的硬件和软件，可以单独运行使用</li>
<li>集合：至少需要两台计算机</li>
</ul>
</li>
<li>计算机网络的较好定义：计算机网络主要是由一些通用的、可编程的硬件互连而成的，而这些硬件并非专门用来实现某一特定目的（例如：传送数据或视频信号）。这些可编程的硬件能够用来传送多种不同类型的数据，并能支持广泛的和日益增长的应用。
<ul>
<li>计算机网络的硬件，并不限于一般的计算机，而是包括了智能手表等智能硬件</li>
<li>计算机网络并非专门用来传送数据，而是能够支撑很多种的应用（包括今后可能出现的各种应用）</li>
</ul>
</li>
</ul>
<h3 id="计算机网络的分类">计算机网络的分类</h3>
<ul>
<li>
<p>按交换技术分类</p>
<ul>
<li>电路交换网络</li>
<li>报文交换网络 路由器全部接收后才能再传输</li>
<li>分组交换网络</li>
</ul>
</li>
<li>
<p>按使用者分类</p>
<ul>
<li>公用网（公众网）</li>
<li>专用网（某个部门为本单位的特殊业务工作需要而建立的网络，不向本单位以外的人提供服务，如军队、铁路等）</li>
</ul>
</li>
<li>
<p>按传输介质分类</p>
<ul>
<li>有线网络（双绞线网络、光纤网络等）。</li>
<li>无线网络（Wifi）</li>
</ul>
</li>
<li>
<p>按覆盖范围分类</p>
<ul>
<li>广域网WAN 几十公里到几千公里，远程网，是因特网的核心部分，为远程路由器提供远距离告诉连接，互连MAN和LAN</li>
<li>城域网MAN 一个城市 5～50公里，城市骨干网，互连大量企业、机构和校园LAN，成为现代城市的信息服务基础设施，为大量用户提供接入和各种信息服务</li>
<li>局域网LAN 一般用微型计算机或工作站或高速通信线路相连，速率通常在10Mbit/s以上，地理上局限在较小的范围内，1公里以内</li>
<li>个域网PAN 个人区域网络的简称，在个人工作的地方把个人使用的电子设备用无线技术连接起来的网络，无线个人区域网WPAN，覆盖范围大约为10米</li>
</ul>
</li>
<li>
<p>若中央处理机之间的距离非常近，例如，仅1米的数量级甚至更小，则一般就称之为多处理机系统而不称之为计算机网络</p>
</li>
<li>
<p>按拓扑结构分类</p>
<ul>
<li>总线型网络</li>
<li>星型网络</li>
<li>环型网络
<ul>
<li>单环/双环，环中数据单向传输</li>
</ul>
</li>
<li>网状型网络
<ul>
<li>可靠性高</li>
<li>控制复杂，线路成本高</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="15-计算机网络的性能指标">1.5 计算机网络的性能指标</h2>
<ul>
<li>从不同的方面度量计算机网络的性能</li>
<li>常用的计算机网络的性能指标有以下8个
<ul>
<li>速率
<ul>
<li>比特：计算机中数据量的单位
<ul>
<li>1 Byte = 8 bit</li>
<li>KB = 2<sup>10</sup>B</li>
<li>MB = 2<sup>20</sup>B</li>
<li>GB = 2<sup>30</sup>B</li>
<li>TB = 2<sup>40</sup>B</li>
</ul>
</li>
<li>连接在计算机网络上的主机在数字信道上传送比特的速率，也称为比特率或数据率</li>
<li>常用数据率单位bit/s(b/s, bps), kb/s=10<sup>3</sup> b/s(bps), Mb/s = 10<sup>6</sup>b/s(bps), Gb/s = 10<sup>9</sup>b/s(bps), Tb/s = 10<sup>12</sup>b/s(bps)</li>
</ul>
</li>
<li>带宽
<ul>
<li>带宽在模拟信号系统中的意义：信号所包含的各种不同频率成分所占据的频率范围</li>
<li>单位：Hz(kHz, MHz, GHz)</li>
<li>带宽在计算机网络中的意义：用来表示网络的通信线路所能传输数据的能力，因此网络带宽表示在单位时间内从网络中的某一点到另一点所能通过的“最高数据率”</li>
<li>单位：b/s(kb/s, Mb/s, Gb/s, Tb/s)</li>
<li>联系：一条通信线路的“频带宽度”越宽，其所传输数据的“最高数据率”也越高</li>
</ul>
</li>
<li>吞吐量
<ul>
<li>在单位时间内通过某个网络（或信道、接口）的数据量</li>
<li>被经常用于对现实世界中的网络的一种测量，以便知道实际上到底有多少数据量能够通过网络</li>
<li>受网络带宽或戈丁速率的限制</li>
</ul>
</li>
<li>时延
<ul>
<li>发送时延：分组从源主机发往传输线路 分组长度(b)/发送速率(b/s) 发送速率由网卡的发送速率、信道带宽、接口速率共同决定 主机在发送信号的同时信号也在传播</li>
<li>传播时延 信道长度(m)/电磁波传输速率(m/s) 电磁波在自由空间的传播速率为3 * 10<sup>8</sup>m/s，在铜线中的传播速率为2.3 * 10<sup>8</sup>m/s，在光纤中的传播速率为2 * 10<sup>8</sup>m/s</li>
<li>处理时延（合并了排队时延）：路由器收到分组后对其进行存储转发 一般不方便计算</li>
<li>会有多个传播时延和处理时延</li>
<li>不考虑处理时延时，具体问题具体分析，不一定是谁占主导
<img src="/images/WechatIMG52.jpg" alt="例题"></li>
<li>注：发送时延与传播时延分开计算，发送后面的bit的同时前面的也在传播</li>
<li>若有n个分组，m段链路，则总时延是多少？n个分组的发送时延+1个分组的发送时延*（m-1）+1段链路的传播时延*m
<img src="/images/WechatIMG53.jpg" alt="计算时延的示意图"></li>
</ul>
</li>
<li>时延带宽积
<ul>
<li>传播时延 * 带宽</li>
<li>若发送端连续发送数据，则在所发送的第一个比特即将到达终点时，发送端就已经发送了时延带宽积个比特</li>
<li>链路的时延带宽积又称为以比特为单位的链路长度</li>
</ul>
</li>
<li>往返时间
<ul>
<li>因特网上的信息不仅仅单方向传输，而是双向交互</li>
<li>我们有时候很需要知道交互一次所需的时间</li>
<li>往返时间RTT(Round-Trip Time)也是一个重要的性能指标</li>
<li>从源主机发送发组开始，到源主机收到来自目的主机的确认分组为止所需要的时间</li>
<li>在卫星链路上耗时较多
<img src="/images/WechatIMG20.jpg" alt="RTT"></li>
</ul>
</li>
<li>利用率
<ul>
<li>信道利用率：用来表示某信道有百分之几的时间是被利用的（有数据通过）</li>
<li>网络利用率：全网络的信道利用率加权平均</li>
<li>根据排队论，当某信道的利用率增大时，该信道引起的时延也会增加-&gt;信道利用率并非越高越好</li>
<li>当网络利用率达到50%时，时延就要加倍</li>
<li>当网络利用率超过50%时，时延急剧增大</li>
<li>当网络利用率接近100%时，时延就会趋于无穷大</li>
<li>一些拥有较大主干网的ISP通常会控制它们的信道利用率不超过50%，如果超过了，就要准备扩容，增大线路的带宽
<img src="/images/WechatIMG21.jpg" alt="网络利用率和网络时延的关系">
<img src="/images/WechatIMG22.jpg" alt="用图表表示"></li>
<li>也不能使信道利用率太低，这会使宝贵的通信资源被白白浪费。应该使用一些机制，可以根据情况动态调整输入到网络中的通信量，使网络利用率保持在一个合理的范围内</li>
</ul>
</li>
<li>丢包率
<ul>
<li>分组的丢失率：在一定的空间范围内，传输过程中丢失的分组数量与总分组数量的比率</li>
<li>分为接口丢包率、节点丢包率、链路丢包率、路径丢包率、网络丢包率</li>
<li>丢包率是网络运维人员非常关心的一个网络性能指标，但对于普通用户来说往往并不关心这个指标，他们通常意识不到网络丢包</li>
<li>分组丢失主要有两种情况
<ul>
<li>分组在传输过程中出现误码，被结点丢弃（节点交换机）</li>
<li>分组到达一台队列已满的分组交换机时被丢弃，在通信量较大时就可能造成网络拥塞。路由器会根据自身拥塞控制方法，在输入未满时就选择丢弃分组</li>
<li>丢包率反映了网络的拥塞情况。无拥塞时路径丢包率为0，轻度拥塞时路径丢包率为1%～4%，严重拥塞时路径丢包率为5%～15%</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="16-计算机网络体系结构">1.6 计算机网络体系结构</h2>
<h3 id="常见的计算机网络体系结构">常见的计算机网络体系结构</h3>
<ul>
<li>
<p>OSI体系结构（开放系统互连参考模型）</p>
<ul>
<li>国际标准化组织提出，法律上的国际标准</li>
<li>七层协议的体系结构</li>
<li>从下往上依次是 物理层、数据链路层、网络层、运输层、会话层、表示层、应用层
<img src="/images/WechatIMG48.jpg" alt="各层的主要任务"></li>
<li>表示层的任务是实现与数据表示相关的功能，主要包括数据字符集的转换、数据格式化、文本压缩、数据加密以及解密等工作</li>
<li>路由器的最高层是网络层，交换机的最高层是数据链路层，集线器的最高层是物理层</li>
<li>运输层是自下而上第一个提供端到端服务(网络层仅提供主机到主机之间的通信)
<img src="/images/WechatIMG49.jpg" alt="题目解析"></li>
<li>失败的原因
<ul>
<li>OSI的专家们缺乏实际经验，没有商业驱动力</li>
<li>协议实现起来过分复杂，运行效率很低</li>
<li>OSI标准的制定周期过长，按OSI标准的设备无法及时进入市场</li>
<li>层次划分不太合理，有些功能在多个层次中重复出现</li>
</ul>
</li>
</ul>
</li>
<li>
<p>TCP/IP体系结构</p>
<ul>
<li>因特网使用，事实上的国际标准</li>
<li>四层协议的体系结构</li>
<li>从下往上依次是 网络接口层（物理层和数据链路层）、网际层（TCP/IP协议）、运输层、（去掉会话层、表示层）应用层</li>
<li>用户的主机若需要接入因特网，需要使用TCP/IP协议</li>
<li>用户主机的操作系统中，通常都带有符合TCP/IP体系结构标准的TCP/IP协议族</li>
<li>用于网络互联的路由器中，也带有符合TCP/IP体系结构标准的TCP/IP协议族</li>
<li>路由器中一般只包含网络接口层和网际层</li>
<li>网络层提供无连接不可靠的数据报服务</li>
<li>TCP/IP的网络接口层没有规定什么具体的内容，可以互连全世界各种不同的网络接口</li>
<li>IP协议是TCP/IP体系结构网络层的核心协议，将不同的网络接口进行互联(IP over everything)，并为其上的TCP协议和UDP协议提供网络互连服务，为各种网络应用提供服务(Everything over IP)</li>
<li>TCP和UDP是TCP/IP体系结构运输层的两个重要协议，TCP协议在接受IP协议提供的服务的同时，可向应用层的相应协议提供可靠传输的服务，UDP协议在享受IP协议的服务的同时，可向应用层的相应协议提供不可靠传输的服务</li>
<li>应用层包含了大量应用层协议，如HTTP, SMTP, DNS, RTP等</li>
<li>TCP/IP协议族表示整个协议大家族</li>
<li>在嵌入式系统开发领域，TCP/IP协议族也称为TCP/IP协议栈
<img src="/images/WechatIMG51.jpg" alt="各层协议"></li>
<li>ICMP是网际层中一个比较重要的协议，使用ICMP协议封装的数据单元，还需要使用IP协议封装成IP数据报，之后才能发送，IP协议直接为ICMP协议提供服务</li>
<li>PPP协议属于网络接口层，直接为IP协议提供服务</li>
<li>POP3是应用层的协议，需要享受运输层TCP协议（面向连接的、可靠的）提供的服务</li>
<li>DNS是域名解析协议</li>
</ul>
</li>
<li>
<p>原理体系结构</p>
<ul>
<li>五层协议的体系结构</li>
<li>从下往上依次为物理层、数据链路层、网络层、运输层、应用层</li>
</ul>
</li>
</ul>
<h3 id="计算机网络体系结构分层的必要性">计算机网络体系结构分层的必要性</h3>
<ul>
<li>计算机网络是个非常复杂的系统</li>
<li>将庞大而复杂的问题，转化为若干较小的局部问题</li>
<li>实现计算机网络面临的主要问题
<ul>
<li>两两相连：传输介质、物理接口、使用怎样的信号-&gt;物理层</li>
<li>总线型网：如何标识网络中的各主机（主机编址问题，例如MAC地址）、如何协调各主机征用总线（总线型网络早已淘汰，现在常用的是使用以太网交换机将多台主机互连形成的交换式以太网）-&gt;数据链路层</li>
<li>多个网络互连：如何标识各网络以及各网络中各主机，即网络和主机共同编址的问题（192.168.1.2，前三个十进制数用来标识网络，第四个十进制数用来标识主机），分组从源主机到目的主机可以走不同路径，路由器如何转发分组以及如何进行路由选择的问题-&gt;网络层</li>
<li>不同应用：收到的分组应该交给谁处理？如何标识与网络通信相关的应用进程，进而解决进程之间基于网络的通信问题。若出现传输错误，应该如何处理-&gt;运输层</li>
<li>制定各种应用层协议，按协议标准编写相应的应用程序，通过应用进程间的交互来完成特定的网络应用-&gt;应用层</li>
</ul>
</li>
</ul>
<h3 id="计算机网络体系结构分层思想举例">计算机网络体系结构分层思想举例</h3>
<ul>
<li>应用层按http协议规定，构建http报文，交付给运输层处理</li>
<li>运输层添加tcp首部，区分应用进程、实现可靠传输，交付给网络层处理</li>
<li>网络层给tcp报文添加ip首部，称为ip数据报，使ip数据包可以在互联网上传输，交付给数据链路层处理</li>
<li>数据链路层给ip数据报添加一个首部和一个尾部，使之成为帧，首部使帧能够在一段链路上或一段网络上传输，能够被相应的目的主机接受，尾部让目的主机检查接收到的帧是否有误码，交付给物理层</li>
<li>物理层将帧看作比特流，物理层给该比特流的前面添加前导码（对以太网），让目的主机做好接受帧的准备 <em>课上讲的是物理层不加任何冗余信息</em></li>
<li>传递给路由器，路由器中物理层将信号变换为比特流，去掉前导码，将帧交给数据链路层，数据链路层去掉首部和尾部后，将数据报交付给网络层，网络层解析数据报的首部，从中提取出目的网络地址，查找自身路由表，确定转发端口，进行转发，网络层将ip数据报交付给数据链路层，数据链路层给ip数据报添加首部和尾部，使之成为帧，交付给物理层，物理层将帧看作比特流，由于是以太网，需要添加前导码，再将比特流变换成相应的信号发送到传输媒体，信号通过传输媒体到达web服务器，物理层将信号变换为比特流，去掉前导码，变成帧……逐层往上，直至将http请求报文交付给应用层，应用层对http请求报文进行解析，给主机发回http响应报文</li>
</ul>
<h3 id="计算机网络体系结构中的专用术语">计算机网络体系结构中的专用术语</h3>
<ul>
<li>实体
<ul>
<li>任何可发送或接收信息的硬件或软件进程</li>
<li>对等实体：收发双方先同层次中的实体</li>
</ul>
</li>
<li>协议
<ul>
<li>控制两个对等实体进行逻辑通信的规则的集合</li>
<li>除物理层外，进行的都是逻辑通信</li>
<li>协议的三要素：语法、语义、同步
<ul>
<li>语法定义通信双方交换信息的格式，所交换信息由那些字段以及何种顺序构成</li>
<li>语义定义通信双方所要完成的操作</li>
<li>同步定义收发双方的时序关系
<img src="/images/WechatIMG24.jpg" alt="同步"></li>
</ul>
</li>
</ul>
</li>
<li>服务
<ul>
<li>在协议的控制下，两个对等实体间的逻辑通信使得本层能够向上一层提供服务</li>
<li>要实现本层协议，还需要使用下面一层所提供的服务，协议是水平的，服务是垂直的</li>
<li>实体看得见相邻下层所提供的服务，但并不知道实现该服务的具体协议</li>
<li>服务访问点：相邻两层的实体交换信息的逻辑接口，用于区分不同的服务类型
<ul>
<li>数据链路层：帧的类型字段</li>
<li>网络层：IP数据包首部中的协议字端</li>
<li>运输层：端口号</li>
</ul>
</li>
<li>服务原语：上下层之间交换的命令</li>
<li>协议数据单元PDU：对等层之间传送的数据包
<ul>
<li>物理层：比特流</li>
<li>数据链路层：帧</li>
<li>网络层：IP数据报或分组</li>
<li>运输层：TCP报文段或UDP用户数据报</li>
<li>应用层：报文</li>
</ul>
</li>
<li>服务数据单元SDU：同一系统内，层与层之间交换的数据包成为服务数据单元</li>
<li>多个SDU可以合成为一个PDU；一个SDU也可划分为几个PDU
<img src="/images/WechatIMG25.jpg" alt="SDU"></li>
</ul>
</li>
</ul>
<h2 id="17-第1章-概述-章节小结">1.7 第1章 概述 章节小结</h2>
<ul>
<li>1.1 计算机网络在信息时代的作用
<ul>
<li>信息服务基础设施</li>
<li>我国互联网发展状况</li>
</ul>
</li>
<li>1.2 因特网概述
<ul>
<li>网络、互联网、因特网的基本概念</li>
<li>因特网发展的第一个阶段</li>
<li>因特网的标准化工作</li>
</ul>
</li>
<li>1.3 三种交换方式
<ul>
<li>电路交换</li>
<li>分组交换</li>
<li>报文交换</li>
</ul>
</li>
<li>1.4 计算机网络的定义和分类
<ul>
<li>定义
<ul>
<li>没有精确统一的定义</li>
<li>最简单定义：互连、自治、计算机的集合</li>
<li>不同阶段定义不同</li>
</ul>
</li>
<li>分类
<ul>
<li>按交换技术</li>
<li>按使用者</li>
<li>按传输介质</li>
<li>按覆盖范围</li>
<li>按拓扑结构</li>
</ul>
</li>
</ul>
</li>
<li>1.5 计算机网络的性能指标
<ul>
<li>速率</li>
<li>带宽</li>
<li>吞吐量</li>
<li>时延带宽积</li>
<li>往返时间RTT</li>
<li>利用率</li>
<li>丢包率</li>
</ul>
</li>
<li>1.6 计算机网络的体系结构
<ul>
<li>常见计算机网络体系结构
<ul>
<li>OSI的七层体系结构：法律上的国际标准</li>
<li>TCP/IP的四层体系结构：事实上的国际标准</li>
<li>五层协议的原理体系结构：适用于教学</li>
</ul>
</li>
<li>分层的必要性</li>
<li>分层思想举例</li>
<li>专用术语
<ul>
<li>实体</li>
<li>协议 三要素：语法、语义、同步</li>
<li>服务 本层向上一层提供服务</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="p2-物理层">P2 物理层</h1>
<h2 id="21-物理层的基本概念">2.1 物理层的基本概念</h2>
<ul>
<li>考虑的是怎样才能在连接各种计算机的传输媒体上传输数据比特流</li>
<li>物理层为数据链路层屏蔽了各种传输媒体的差异，使数据链路层只需要考虑如何完成本层的协议和服务，而不必考虑网络具体的传输媒体是什么</li>
</ul>
<h3 id="物理层协议的主要任务">物理层协议的主要任务</h3>
<ul>
<li>机械特性：指明接口所用接线器的形状和尺寸，引脚数目和排列、固定和锁定装置 接口形状</li>
<li>电气特性：指明在接口电缆的各条线上出现的电压的范围 信号电平</li>
<li>功能特性：指明某条线上出现的某一电平的电压表示何种意义 引脚功能</li>
<li>过程特性：指明对于不同功能的各种可能事件的出现顺序</li>
</ul>
<h2 id="22-物理层下面的传输媒体">2.2 物理层下面的传输媒体</h2>
<ul>
<li>不属于计算机网络体系中的任何一层，在物理层之下</li>
</ul>
<h3 id="导引型传输媒体电磁波被导引沿着固体媒体传播">导引型传输媒体（电磁波被导引沿着固体媒体传播）</h3>
<ul>
<li>同轴电缆
<img src="/images/WechatIMG54.jpg" alt="同轴电缆">
<ul>
<li>基带同轴电缆(50欧姆) 数字传输，过去用于局域网</li>
<li>宽带同轴电缆(75欧姆) 模拟传输，过去主要用于有线电视</li>
<li>同轴电缆价格较贵且布线不够灵活和方便，随着集线器的出现，在局域网领域基本上都是采用双绞线作为传输媒体</li>
</ul>
</li>
<li>双绞线 <br>
<img src="/images/WechatIMG55.jpg" alt="双绞线">
<ul>
<li>把两根互相绝缘的铜导线按照一定规则绞合在一起</li>
<li>绞合的作用
<ul>
<li>抵御部分来自外界的电磁波干扰</li>
<li>减少相邻导线的电磁干扰</li>
</ul>
</li>
</ul>
</li>
<li>光纤
<img src="/images/WechatIMG56.jpg" alt="光纤">
<ul>
<li>纤芯直径很细</li>
<li>多模光纤：50微米，62.5微米 许多条入射角度不同的光线可以传播</li>
<li>单模光纤：9微米 光在纤芯中一直向前传播而不发生全反射</li>
<li>包层直径125微米</li>
<li>工作波长
<ul>
<li>0.85微米（衰减较大）</li>
<li>1.30微米（衰减较小）</li>
<li>1.55微米（衰减较小）</li>
</ul>
</li>
<li>光纤的优点
<ul>
<li>通信容量大(25000~30000GHz的带宽)</li>
<li>传输损耗小，远距离传输时更加经济</li>
<li>抗雷电和电磁干扰性能好。这在大电流脉冲干扰的环境下尤为重要</li>
<li>无串音干扰，保密性好，不易被窃听</li>
<li>体积小，重量轻</li>
</ul>
</li>
<li>光纤的缺点
<ul>
<li>割接需要专用设备</li>
<li>光电接口价格较贵</li>
</ul>
</li>
<li>基本原理
<ul>
<li>纤芯：非常透明的石英玻璃拉成的细丝，直径8～100微米</li>
<li>包层：折射率比纤芯低的玻璃封套</li>
<li>由于光的色散，光在多模光纤中传输一定距离后必然产生信号失真（脉冲展宽）-&gt;多模光纤只是适合近距离传输(建筑物内) 发送光源：发光二极管 接收检测：光电二极管</li>
<li>单模光纤：没有模式色散，在1.31微米波长附近材料色散和波导色散大小相等符号相反，两者正好抵消，没有脉冲展宽问题-&gt;适合长距离传输且衰减小，但其制造成本高，对光源要求高 发送光源：激光发生器 接收检测：激光检查器</li>
</ul>
</li>
</ul>
</li>
<li>电力线</li>
</ul>
<h3 id="非导引型传输媒体自由空间">非导引型传输媒体（自由空间）</h3>
<ul>
<li>无线电波
<ul>
<li>低频和中频：地面波</li>
<li>高频和甚高频：电离层的反射</li>
</ul>
</li>
<li>微波
<ul>
<li>在空间主要是直线传播</li>
<li>传播距离受到限制</li>
<li>两种通信方式
<ul>
<li>地面微波接力通信 中继站，放大前一个中继站放大，传往下一个中继站</li>
<li>卫星通信 通信距离远，传播时延大</li>
</ul>
</li>
</ul>
</li>
<li>红外线
<ul>
<li>点对点无线传输</li>
<li>直线传输，中间不能有障碍物，传输距离短</li>
<li>传输速率低</li>
</ul>
</li>
<li>可见光</li>
</ul>
<h3 id="无线电频谱管理机构">无线电频谱管理机构</h3>
<ul>
<li>中国：工业和信息化部无线电管理局（国家无线电办公室）</li>
<li>美国：联邦通信委员会FCC</li>
<li>ISM频段：可以自由使用 Industrial, Scientific, Medical</li>
</ul>
<h2 id="23-传输方式">2.3 传输方式</h2>
<h3 id="串行传输和并行传输">串行传输和并行传输</h3>
<ul>
<li>串行传输：数据是一个bit一个bit一次发送，发送端和接收端之间只需要一条数据线</li>
<li>并行传输：每次发送n比特的数据，发送端和姐手段之间需要n条数据线
<ul>
<li>发送速度快</li>
<li>成本高</li>
</ul>
</li>
<li>在远距离通信中，常采用串行传输</li>
<li>计算机内部，常采用并行传输</li>
</ul>
<h3 id="同步传输和异步传输">同步传输和异步传输</h3>
<ul>
<li>同步传输
<ul>
<li>数据块以稳定的比特流的形式传输，字节间没有间隔，接收端在每个比特信号的中间时刻进行检测，以鉴别是0或1</li>
<li>不同设备的时钟频率不可能完全相同，判别时刻时钟误差累积会导致接收端对比特信号的判别错位，采取方法使收发双方的时钟保持同步
<ul>
<li>外同步：在收发双方之间添加一条单独的时钟信号线</li>
<li>内同步：发送端将始终同步信号编码到发送数据中一起传输，如曼彻斯特编码</li>
</ul>
</li>
</ul>
</li>
<li>异步传输
<ul>
<li>以字节为独立的传输单位，字节之间的距离不是固定的</li>
<li>接收端仅在每个字节的起始处对字节内的比特实现同步</li>
<li>需要在每个字节前后加起始位和结束位</li>
<li>异步是指字节间的时间间隔不同，但自己内部的每bit仍然同步</li>
</ul>
</li>
</ul>
<h3 id="单工通信半双工通信全双工通信">单工通信、半双工通信、全双工通信</h3>
<ul>
<li>单工通信（单向通信）
<ul>
<li>通信双方只有一个数据传输方向</li>
<li>例如：无线电广播</li>
<li>只需要一条信道</li>
</ul>
</li>
<li>半双工通信（双向交替通信）
<ul>
<li>通信双方可以相互传输数据，但不能同时进行</li>
<li>例如：对讲机</li>
<li>需要两条信道</li>
</ul>
</li>
<li>全双工通信（双向同时通信）
<ul>
<li>通信双方可以同时发送和接收信息</li>
<li>例如：电话</li>
<li>需要两条信道</li>
</ul>
</li>
</ul>
<h2 id="24-编码与调制">2.4 编码与调制</h2>
<ul>
<li>消息：文字、图片、音频、视频</li>
<li>数据：运送消息的实体</li>
<li>信号：数据的电磁表现</li>
<li>基带信号：信源发出的原始电信号
<ul>
<li>数字基带信号 -&gt; 编码为数字信号(以太网的曼彻斯特编码，4B/5B, 8B/10B)，调制为模拟信号(WiFi CCK/DSSS/OFDM调制)</li>
<li>模拟基带信号 -&gt; 编码为数字信号(对音频信号进行编码的脉码调制PCM)数字信道，调制为模拟信道(语音数据加载到模拟的载波信号中传输，频分复用FDM技术，充分利用带宽资源)</li>
</ul>
</li>
<li>信道
<ul>
<li>数字信道</li>
<li>模拟信道</li>
</ul>
</li>
<li>码元
<ul>
<li>在使用时间域的波形表示数字信号时，代表不同离散数值的基本波形
<img src="/images/WechatIMG58.jpg" alt="编码与调制"></li>
</ul>
</li>
<li>传输媒体与信道的关系
<ul>
<li>单工传输中，传输媒体仅包含一个信道</li>
<li>半双工和双工传输中，传输媒体可包含两个信道</li>
<li>使用信道复用技术，一条传输媒体可包含多个信道</li>
</ul>
</li>
<li>常用编码
<ul>
<li>不归零编码
<ul>
<li>需要额外一根传输线来传输时钟信号，使发送方和接收方同步</li>
<li>对于计算机网络，宁愿用这根传输线传输数据信号而不是时钟信号</li>
<li>存在同步问题，不采用</li>
</ul>
</li>
<li>归零编码
<ul>
<li>每个码元结束后信号都要归零</li>
<li>接收方只要在信号归零后进行采样即可，不需要单独的时钟信号</li>
<li>将时钟信号用归零方式编码在了数据之内，称为自同步信号</li>
<li>归零编码中大部分数据带宽都用来传输归零而浪费掉了</li>
<li>自同步，编码效率低</li>
</ul>
</li>
<li>曼彻斯特编码
<ul>
<li>每个码元中间时刻都会发生跳变，负跳变表示1，正跳变表示0</li>
<li>码元中间时刻的跳变既表示时钟，又表示数据</li>
<li>传统以太网使用</li>
</ul>
</li>
<li>差分曼彻斯特编码
<ul>
<li>在每个码元的中间时刻信号发生跳变</li>
<li>跳变仅表示时钟</li>
<li>码元开始处电平是否发生变化表示数据</li>
<li>比曼彻斯特编码变化少，更适合较高的传输速率
<img src="/images/WechatIMG59.jpg" alt="常用编码示意图"></li>
</ul>
</li>
</ul>
</li>
<li>例题
<ul>
<li>10BaseT Base基带传输 T双绞线-&gt;以太网-&gt;曼彻斯特编码</li>
<li>正负跳变表示0/1都有可能</li>
</ul>
</li>
<li>基本调制方法
<ul>
<li>调幅AM：无载波输出表示0，有载波输出表示1</li>
<li>调频FM：频率f1表示0，频率f2表示1</li>
<li>调相PM：初相位0度表示0，初相位180度表示1</li>
<li>使用基本调制方式，一个码元只能包含一个比特信息</li>
<li>混合调制 频率、相位相关（一次只能调制其中之一），通常将相位和振幅一起调制，成为正交振幅调制QAM
<ul>
<li>QAM-16
<ul>
<li>12种相位</li>
<li>每种相位有1或2种振幅可选
<img src="/images/WechatIMG60.jpg" alt="QAM-16"></li>
<li>共16种码元，每个码元可包含四个比特</li>
<li>每个码元与四个比特的对应关系不能随便定义，应采用格雷码</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="25-信道的极限容量">2.5 信道的极限容量</h2>
<ul>
<li>码间串扰：信号失真严重，无法识别</li>
<li>产生失真的原因
<ul>
<li>码元传输速率</li>
<li>信号传输距离</li>
<li>噪声干扰</li>
<li>传输媒体质量</li>
</ul>
</li>
<li>奈式准则
<ul>
<li>在假定的理想条件下，为了避免码间串扰，码元传输速率是有上限的</li>
<li>理想低通信道的最高码元传输速率 = 2W Baud</li>
<li>理想带通信道的最高码元传输速率 = W Baud</li>
<li>W: 信道带宽(Hz), Baud: 波特，即码元/秒</li>
<li>如果题目不特别给出是带通信道，一律认为是低通信道</li>
<li>码元传输速率又称为波特率、调制速率、波形速率或符号速率。它与比特率有一定关系
<ul>
<li>当一个码元只携带1比特信息量时，则波特率(码元/秒)与比特率(比特/秒)在数值上是相等的</li>
<li>当一个码元携带n比特信息量时，则波特率转换成比特率时，数值要乘以n</li>
</ul>
</li>
<li>要提高信息传输速率，就必须设法使每一个码元能携带更多个比特的信息量。这需要多元制。</li>
<li>实际的信道所能传输的最高码元速率，要明显低于奈氏准则给出的这个上限数值(奈式准则是在假定的理想条件下推导的)</li>
<li>信道的极限传输速率还要受限于实际的信号在信道中传输时的信噪比</li>
</ul>
</li>
<li>香农公式
<ul>
<li>带宽受限且有高斯白噪声干扰的信道的极限信息传输速率
<img src="/images/WechatIMG62.jpg" alt="香农公式"></li>
<li>C：信道的极限信息传输速率(单位：b/s)</li>
<li>W：信道带宽(单位：Hz)</li>
<li>S：信道内所传信号的平均功率</li>
<li>N：信道内的高斯噪声功率</li>
<li>S/N：信噪比，使用dB作为度量单位
<img src="/images/WechatIMG63.jpg" alt="信噪比"></li>
<li>信道带宽或信道中信噪比越大，信息的极限传输速率越高</li>
<li>在实际信道上能够达到的信息传输速率要比该公式的极限传输速率低不少。在实际信道中，信号还要受到其他一些损伤，如各种脉冲干扰、信号在传输中的衰减和失真等，这些因素在香农公式中并未考虑</li>
</ul>
</li>
<li>提高信息的传输速率
<ul>
<li>采用多元制</li>
<li>提高信道中的信噪比</li>
<li>-&gt;接近香农公式所给出的传输速率极限</li>
</ul>
</li>
<li>例题
<ul>
<li>香农公式：信噪比和频率带宽会影响信道数据传输速率</li>
<li>奈式准则：调制速度会影响信道数据传输速率</li>
<li>信号传播速度不影响数据传输速率</li>
</ul>
</li>
</ul>
<h2 id="26-物理层-章节小结">2.6 物理层 章节小结</h2>
<ul>
<li>物理层基本概念
<ul>
<li>物理层所要解决的问题</li>
<li>物理层协议的主要任务
<ul>
<li>机械特性</li>
<li>电气特性</li>
<li>功能特性</li>
<li>过程特性</li>
</ul>
</li>
</ul>
</li>
<li>物理层下面的传输媒体
<ul>
<li>导引型传输媒体
<ul>
<li>同轴电缆</li>
<li>双绞线</li>
<li>光纤</li>
<li>电力线</li>
</ul>
</li>
<li>非导引型传输媒体
<ul>
<li>无线电波</li>
<li>微波</li>
<li>红外线</li>
<li>可见光</li>
</ul>
</li>
<li>无线电频谱管理结构
<ul>
<li>中国</li>
<li>美国</li>
<li>ISM频段</li>
</ul>
</li>
</ul>
</li>
<li>传输方式
<ul>
<li>串行传输和并行传输</li>
<li>同步传输和异步传输</li>
<li>单工传输和半双工传输和双工传输</li>
</ul>
</li>
<li>编码与调制
<ul>
<li>数据通信中的常用术语
<ul>
<li>消息</li>
<li>数据</li>
<li>信号</li>
</ul>
</li>
<li>编码</li>
<li>调制</li>
<li>码元</li>
</ul>
</li>
<li>信道的极限容量
<ul>
<li>造成信号失真的因素</li>
<li>奈式准则</li>
<li>香农公式</li>
<li>奈式准则和香农公式的意义</li>
</ul>
</li>
</ul>
<h1 id="p3-数据链路层">P3 数据链路层</h1>
<h2 id="31-数据链路层概述">3.1 数据链路层概述</h2>
<ul>
<li>数据链路层在网络体系中的地位
<img src="/images/WechatIMG64.jpg" alt=""></li>
<li>链路：从一个节点到相邻节点的一段物理线，而中间没有任何其他的交换节点</li>
<li>数据链路：是指把实现通信协议的硬件和软件加到连路上，就构成了数据链路</li>
<li>数据链路层以帧为单位处理和传输数据</li>
</ul>
<h3 id="数据链路层的三个重要问题">数据链路层的三个重要问题</h3>
<ul>
<li>封装成帧
<ul>
<li>应用层-&gt;协议数据单元</li>
<li>运输层+协议协议首部-&gt;运输层协议数据单元</li>
<li>网络层+网络层协议首部-&gt;网络层协议数据单元</li>
<li>数据链路层+数据链路层协议首部(帧头)+帧尾(此操作为封装成帧，为了在连路上以帧为单元传送数据)</li>
</ul>
</li>
<li>差错检测
<ul>
<li>发送方将封装好的帧通过物理层发送到传输媒体，帧在传输过程中遭遇干扰后可能会出现误码-&gt;通过封装在帧尾的检错码和检错算法判断</li>
</ul>
</li>
<li>可靠传输
<ul>
<li>接收方接收到含有误码的帧之后，将其丢弃</li>
<li>不可靠传输：没有其他措施</li>
<li>可靠传输(误码不能避免，但若能实现发送方发送什么，接收方就能收到什么，就称为可靠传输)：采取其他措施</li>
</ul>
</li>
</ul>
<h3 id="数据链路层的交换方式">数据链路层的交换方式</h3>
<ul>
<li>使用广播信道的数据链路层（共享式广域网）
<ul>
<li>编址MAC</li>
<li>碰撞
<ul>
<li>以太网的媒体接入控制协议CSMA/CD，载波监听多点接入/碰撞检测</li>
</ul>
</li>
</ul>
</li>
<li>交换式局域网
<ul>
<li>网桥和交换机的工作原理</li>
</ul>
</li>
<li>无线局域网
<ul>
<li>共享信道技术</li>
<li>802.11局域网采用的媒体接入控制协议是CSMA/CA，载波监听多点介入/碰撞检测</li>
</ul>
</li>
</ul>
<h2 id="32-封装成帧">3.2 封装成帧</h2>
<ul>
<li>数据链路层给上层交付的协议数据单元添加帧头和帧尾使之成为帧
<ul>
<li>帧头和帧尾中包含有重要的控制信息</li>
<li>帧头和帧尾的作用之一就是帧定界（但不是每一种数据链路层的帧都含有帧定界格式，如以太网就没有）</li>
<li>以太网的数据链路层封装好MAC帧后，将其交付给物理层，物理层添加8字节的前导码(前七个自己为前同步码，使接收方的时间同步，之后的一个字节为帧开始定界符)；以太网还规定了帧间间隔为96比特时间，因此并不需要帧结束符</li>
</ul>
</li>
<li>透明传输
<ul>
<li>数据链路层对上层交付的传输数据并没有任何限制，就好像数据链路层不存在一样(不会要求不能包含帧定界符)</li>
<li>字节填充：扫描帧的数据部分，在所有帧定界符前插入转义字符-&gt;还应在转义字符前也插入转义字符(面向字节的物理链路，使用字节填充的方法实现透明传输)</li>
<li>比特填充：零比特填充法(对于面向比特的物理链路采用比特填充的方法实现透明传输)
<ul>
<li>举例：高级数据链路控制协议HDLC采用帧头和帧尾中的标志字端作为帧定界符，其值为01111110，采用0比特填充法，每5个比特1之后插入一个比特零</li>
</ul>
</li>
</ul>
</li>
<li>为了提高帧的传输效率，应当使帧的数据部分的长度尽可能大些</li>
</ul>
<h2 id="33-差错检测">3.3 差错检测</h2>
<ul>
<li>实际的通信链路都不是理想的，比特在传输过程中可能会出现差错：比特差错/误码</li>
<li>在一段时间内，传输错误的比特占所传输比特总数的比率成为误码率BER(Bit Error Rate)</li>
<li>使用差错检测码来检测数据在传输过程中是否产生了比特差错，是数据链路层所要解决的重要问题之一</li>
</ul>
<h3 id="奇偶校验">奇偶校验</h3>
<ul>
<li>添加1位奇偶校验位</li>
<li>如果有奇数个位发生误码，则奇偶型发生变化，可以检查出误码</li>
<li>如果有偶数个位发生误码，则奇偶型不发生变化，不能检查出误码(漏检)</li>
<li>漏检率较高，数据链路层一般不采用</li>
</ul>
<h3 id="循环冗余校验crccyclic-redundancy-check">循环冗余校验CRC(Cyclic Redundancy Check)</h3>
<ul>
<li>收发双方约定好一个生成多项式G(x)</li>
<li>发送方基于待发送的数据和生成多项式计算出差错检测码(冗余码)，将其添加到待传输数据的后面一起传输</li>
<li>接收方通过生成多项式来计算收到的数据是否产生了误码</li>
<li>算法要求生成多项式必须包含最低次项
<img src="/images/WechatIMG65.jpg" alt="CRC">
<img src="/images/WechatIMG59.jpg" alt="举例"></li>
</ul>
<h3 id="差错检测的作用">差错检测的作用</h3>
<ul>
<li>检错码只能检测出出现了差错，但并不能定位错误，因此无法纠错</li>
<li>要纠正传输中的差错，可以使用冗余信息更多的纠错码进行前向纠错。但纠错码的开销比较大，在计算机网络中较少使用</li>
<li>循环冗余校验(CRC)有很好的检错能力(漏检率非常低)，虽然计算比较复杂，单非常易于用硬件实现，因此被广泛应用于数据链路层</li>
<li>在计算网络中通常采用检错重传方式来纠正传输中的差错，或者仅仅丢弃检测到差错的帧，这取决于数据链路层向其上层提供的是可靠传输服务还是不可靠传输服务</li>
</ul>
<h2 id="34-可靠传输">3.4 可靠传输</h2>
<h3 id="341-可靠传输的基本概念">3.4.1 可靠传输的基本概念</h3>
<ul>
<li>使用差错检测技术(例如循环冗余校验CRC)，接收方的数据链路层就可检测出帧在传输过程中是否出现了误码(比特错误)</li>
<li>数据链路层向其上层提供的服务类型
<ul>
<li>不可靠传输服务：仅仅丢弃有误码的帧，其他什么都不做</li>
<li>可靠传输服务：想办法实现发送端发送什么，接收端就收到什么</li>
</ul>
</li>
<li>有线链路的误码率比较低，为了减小开销，并不要求数据链路层向上提供可靠传输服务。即使出现了误码，可靠传输的问题由其上层处理</li>
<li>无线链路易受干扰，误码率比较高，因此要求数据链路层必须向上层提供可靠传输服务</li>
<li>比特差错只是传输差错中的一种</li>
<li>传输差错还包括：分组丢失、分组失序以及分组重复，一般不会出现在数据链路层，而会出现在其行层</li>
<li>可靠传输服务并不局限于数据链路层，其他各层均可实现可靠传输
<img src="/images/WechatIMG76.jpg" alt="各层的可靠传输"></li>
<li>可靠传输的实现比较复杂，开销也比较大，是否使用可靠传输取决于应用需求</li>
</ul>
<h3 id="342-可靠传输的实现机制">3.4.2 可靠传输的实现机制</h3>
<ul>
<li>
<p>这三种可靠传输实现机制并不仅限于数据链路层，可以应用到计算机网络体系结构的各层协议中</p>
</li>
<li>
<p>停止-等待协议SW (通过确认和重传机制实现的可靠传输协议，常称为ARQ, 自动请求重传)
<img src="/images/WechatIMG80.jpg" alt="SW"></p>
<ul>
<li>确认与否认</li>
<li>超时重传
<ul>
<li>发送方发送完一个数据分组时，启动超时计时器。若到了超市计时器所设置的重传时间，而发送方仍收不到接收方的任何ACK或NAK，则重传原来的数据分组，这就叫做超时重传</li>
<li>一般可将重传时间选为略大于“从发送方到接收方的平均往返时间”</li>
</ul>
</li>
<li>编号-&gt;确认丢失
<ul>
<li>为避免分组重复这种传输错误，必须给每个分组带上序号</li>
<li>每发送一个数据分组就停止等待-&gt;只要保证每发送一个新的数据分组，其发送序号与上次发送的数据分组的序号不同就可以了-&gt;用一个比特来编号就够了</li>
</ul>
</li>
<li>ACK编号-&gt;确认迟到
<ul>
<li>数据链路层的点对点信道，往返时间比较固定，不会出现确认迟到的情况-&gt;不会出现确认迟到的情况</li>
<li>如果只在数据链路层实现停止-等待协议，可以不用给确认分组编号</li>
</ul>
</li>
<li>注意事项
<ul>
<li>接收方检测到数据分组有误码时，将其丢弃等待发送方的超市重传。但对于误码率较高的点对点链路，为使发送方今早重传，可以给发送方发送NAK分组</li>
<li>为了让接收方能够判断所收到的数据分组是否是重复的，需要给数据分组编号。由于停止-等待协议的停等特性，只需1个比特编号就够了，即编号0和1</li>
<li>为了让发送方能够判断所收到的ACK分组是否是重复的，需要给ACK分组编号，所用比特数量与数据分组编号所用比特数量一样。数据链路层一般不会出现ACK分组迟到的情况，因此在数据链路层实现停止-等待协议可以不用给ACCK分组编号</li>
<li>超时计时器的重传时间应仔细选择，一般可将重传时间选为略大于“从发送方到接收方的平均往返时间”
<ul>
<li>数据链路层的点对点的往返时间比较确定，重传时间比较好设定</li>
<li>在运输层，由于端到端往返时间非常不确定，设置合适的重传时间有时并不容易</li>
</ul>
</li>
</ul>
</li>
<li>信道利用率
<img src="/images/WechatIMG81.jpg" alt="信道利用率">
<ul>
<li>当往返时间RTT远大于数据帧发送时延T<sub>D</sub>时(例如使用卫星链路)，信道利用率非常低</li>
<li>若出现重传，则对于传送有用的数据信息来说，信道利用率还要降低</li>
<li>为了克服停止-等待协议信道利用率很低的缺点，就产生了另外两种协议，即后退N帧协议GBN和选择重传协议SR</li>
</ul>
</li>
</ul>
</li>
<li>
<p>回退N帧协议GBN</p>
<ul>
<li>在流水线传输的基础上，利用发送窗口来限制发送方可连续发送数据分组的个数-&gt;是一种连续ARQ协议，在协议的工作过程中发送窗口和接收窗口不断向前滑动，因此这类协议又称为滑动窗口协议</li>
<li>发送方要维持一个发送窗口，序号落在发送窗口内的数据分组可被连续发送，而不必等收到接收方的确认窗口后再进行发送</li>
<li>举例
<ul>
<li>采用3个比特给分组编序号，即序号0～7</li>
<li>发送窗口的尺寸W<sub>T</sub>的取值：1 &lt; W<sub>T</sub> ≤ 2<sup>3</sup> - 1, 本例取W<sub>T</sub> = 5</li>
<li>接受窗口的尺寸W<sub>R</sub>的取值：W<sub>R</sub> = 1</li>
</ul>
</li>
<li>滑动窗口</li>
<li>累积确认  ACKn表示序号为n及以前的所有数据分组都已正确接收-&gt;即使确认分组丢失，发送方也可能不必重传；可以减小接收方的开销，减小对网络资源的占用；但不能及时反应正确接收的信息</li>
<li>有差错的情况：发送方收到重复的确认，就知道之前所发送的数据分组出现了差错，于是可以不等超时计时器超时就立刻重传；至于收到几个重复确认就立刻重传，由具体实现决定</li>
<li>当通信线路质量不好时，其信道利用率并不比停止-等待协议高
<img src="/images/WechatIMG85.jpg" alt="发送方和接收方"></li>
</ul>
</li>
<li>
<p>选择重传协议SR</p>
<ul>
<li>接收窗口的W<sub>R</sub>不应再大于等于1(而应大于1)，以便接收方先收下失序到达但无误码并且序号落在接收窗口内的那些数据分组，等到所缺分组收齐后再一并送交上层。这就是选择重传协议</li>
<li>为了使发送方仅重传出现差错的分组，接收方不能再采用累积确认，而需要对每个正确接受到的数据分组进行逐一确认</li>
<li>举例
<ul>
<li>采用3个比特给分组编号，即序号0～7</li>
<li>发送窗口的尺寸W<sub>T</sub>的取值：I &lt; W<sub>T</sub> ≤ 2<sup>3-1</sup>，本例取W<sub>T</sub> = 4</li>
<li>接收窗口的尺寸W<sub>R</sub>的取值：W<sub>R</sub> = W<sub>T</sub> = 4;</li>
</ul>
</li>
<li>发送方的发送窗口尺寸W<sub>T</sub>必须满足：1 &lt; W<sub>T</sub> ≤ 2<sub>n-1</sub>， 其中n是构成分组序号的比特数量。若W<sub>T</sub> = 1，与停止-等待协议相同，若W<sub>T</sub> &gt; 2<sub>n-1</sub>，会造成接收方无法分辨新旧分组的问题</li>
<li>接收方的发送穿够尺寸W<sub>R</sub>必须满足：1 &lt; W<sub>R</sub> ≤ W<sub>T</sub>，若W<sub>R</sub> = 1，与回退n帧协议相同，若W<sub>R</sub> &gt; W<sub>T</sub>，则没有意义</li>
<li><em>困惑：若接收方发送的确认丢失了该怎么办？重传吗？重传之后就匹配了吧……然后再进行处理吗？</em>
<img src="/images/WechatIMG86.jpg" alt="发送方与接收方"></li>
</ul>
</li>
</ul>
<h2 id="35-点对点协议ppppoint-to-point-protocol">3.5 点对点协议PPP(Point-to-Point Protocol)</h2>
<ul>
<li>
<p>是目前使用最广泛的点对点数据链路层协议</p>
</li>
<li>
<p>一般的因特网用户接入：通过连接到ISP(如中国联通、中国移动、中国电信)，ISP已经从因特网管理机构申请到一批IP地址，用户计算机只有获取合法的IP地址后，才能成为因特网上的主机</p>
</li>
<li>
<p>用户主机与ISP通信时，所使用的数据链路层协议通常就是PPP协议。1999年公布的在以太网上运行的PPP协议，即PPPoE，使得ISP可以通过DSL、电路调制解调器、以太网等宽带接入技术，以以太网接口的形式，为用户提供接入服务</p>
</li>
<li>
<p>PPP也广泛应用于广域网路由器之间的专用线</p>
</li>
<li>
<p>是因特网工程任务组IETF在1992年制定的。经过1993年和1994年的修订，现在的PPP协议已成为因特网的正式标准[RFC1661, RFC1662]</p>
</li>
<li>
<p>PPP协议为在点对点链路传输各种协议数据报提供了一个标准方法</p>
<ul>
<li>对各种协议数据报的封装方法(封装成帧)</li>
<li>链路控制协议LCP 用于建立、配置以及测试数据链路的协议</li>
<li>一套网络控制协议NCPs 其中的每一个协议支持不同的网络层协议
<img src="/images/WechatIMG87.jpg" alt="点对点协议PPP"></li>
</ul>
</li>
<li>
<p>帧格式</p>
<ul>
<li>标志flag字段：PPP帧的定界符，取值为0x7E</li>
<li>地址adress字段：取值为0xFF，预留(目前没什么用)</li>
<li>控制control字段：取值为0x02，预留(目前没有什么作用)</li>
<li>协议protocol字段：指明帧的数据分送到哪个协议处理
<ul>
<li>取值0x0021：帧的数据部分为IP数据报</li>
<li>取值0xC021：帧的数据部分为LCP分组</li>
<li>取值0x8021：帧的数据部分为NCP分组</li>
</ul>
</li>
<li>帧检验序列Frame Check Sequence字段：CRC计算出的校验位
<img src="/images/WechatIMG88.jpg" alt="帧格式"></li>
</ul>
</li>
<li>
<p>透明传输：当PPP帧的数据部分出现帧首和帧尾的标志字段时(F时PPP帧的定界符，0x7E即01111110)</p>
<ul>
<li>面向字节的异步链路：字节填充法，插入“转义字符”
<ul>
<li>发送方
<ul>
<li>出现的每一个7E字节转变为2字节序列(7D, 5E)</li>
<li>出现的每一个7D(转义字符)字节转变为2字节序列(7D, 5D)</li>
<li>出现的每一个ASCII码控制字符(数值小于0x20的字符)，则在该自古前面插入一个7D字节，同时将该字符的编码加上0x20</li>
</ul>
</li>
<li>接收方
<ul>
<li>进行反变换</li>
</ul>
</li>
</ul>
</li>
<li>面向比特的同步链路：比特填充法，插入比特0
<ul>
<li>发送方
<ul>
<li>对帧的数据部分进行扫描(一般由硬件实现)，只要发现5个连续的比特1，则立即填充1个比特零</li>
</ul>
</li>
<li>接收方
<ul>
<li>对帧的数据部分进行扫描，只要发现5个连续的比特1，就把其后的1个比特零删除</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>差错检测</p>
<ul>
<li>使用PPP的数据链路层向上提供不可靠传输服务
<img src="/images/WechatIMG89.jpg" alt="PPP差错检测"></li>
</ul>
</li>
<li>
<p>工作状态
<img src="/images/WechatIMG90.jpg" alt="工作状态"></p>
</li>
</ul>
<h2 id="36-媒体接入控制">3.6 媒体接入控制</h2>
<h3 id="361-媒体接入控制的基本概念">3.6.1 媒体接入控制的基本概念</h3>
<ul>
<li>共享信道要着重考虑的一个问题就是如何协调多个发送和接收站点对一个共享传输媒体的占用，即媒体接入控制MAC(Medium Access Control)
<img src="/images/WechatIMG94.jpg" alt="共享信道"></li>
<li>媒体接入控制分类
<ul>
<li>静态划分信道(预先固定分配好信道，这类方法非常不灵活，对于突发性数据传输信道利用率会很低。通常在无线网络的物理层中使用，而不是在数据链路层中使用)
<ul>
<li>频分多址</li>
<li>时分多址</li>
<li>码分多址</li>
</ul>
</li>
<li>动态接入控制
<ul>
<li>受控接入(由于市场竞争已逐步退出了历史舞台)
<ul>
<li>集中控制(在多点轮询协议中，有一个主站以循环方式轮询每个站点有无数据发送，只有被轮询到的站点才能发送数据。最大缺点是存在单点故障问题)</li>
<li>分散控制(在令牌传递协议中，各站点是平等的，并连接成一个环形网络。令牌(一个特殊的控制帧)沿环住站传递，接收到令牌的站点才有权发送数据，并在发送完数据后将令牌传递给下一个站点。典型网络：IEEE 802.5令牌环网，IEEE 802.4令牌总线网，光纤分布式数据接口FDDI)</li>
</ul>
</li>
<li>随机接入
<ul>
<li>特点：所有站点通过竞争，随机地在信道上发送数据，如果恰巧有多个或更多的站点在同一时刻发送数据，则信号在共享媒体上就要产生碰撞(即发生了冲突)。使得这些站点的发送都失败。因此，这类协议要解决的关键问题是如何尽量避免冲突以及发生冲突后如何尽快恢复通信。著名的共享式以太网采用的就是随机接入</li>
</ul>
</li>
</ul>
</li>
<li>随着技术的发展，交换技术的成熟和成本的降低，具有更高性能的使用点对点链路和链路层交换机的交换式局域网在有线领域已完全取代了共享式局域网，但由于无线通信的广播天性，无线局域网仍然使用的是共享媒体技术</li>
</ul>
</li>
</ul>
<h3 id="362-媒体接入控制静态划分信道">3.6.2 媒体接入控制——静态划分信道</h3>
<ul>
<li>信道复用
<ul>
<li>复用(Multiplexing)是通信技术中的一个重要概念。复用就是通过一条物理线路同时传输多路用户的信号。</li>
<li>当网络中的传输媒体的传输容量大于多条单一信道传输的总通信量时，可利用复用技术在一条物理线路上建立多条通信信道来充分利用传输媒体的带宽
<img src="/images/WechatIMG95.jpg" alt="信道复用"></li>
<li>常见的信道复用技术
<ul>
<li>频分复用FDM：所有用户同时占用不同的频带资源并行通信 可用于多址接入，频分多址FDMA
<img src="/images/WechatIMG96.jpg" alt="FDM"> 可用于多址接入，时分多址TDMA</li>
<li>时分复用TDM：将时间划分为一段段等长的时分复用帧，每一个时分复用的用户在每一个时分复用帧中占用固定序号的时隙，时分复用的所有用户在不同的时间占用同样的频带宽度
<img src="/images/WechatIMG97.jpg" alt="TDM"></li>
<li>波分复用WDM：光的频分复用，光在传输过程中会衰减，需要放大-&gt;掺饵光纤放大器
<img src="/images/WechatIMG98.jpg" alt="WDM"></li>
<li>码分复用CDM：常用于多址接入，码分多址CDMA
<ul>
<li>与FDM和TDM不同，CDM的每一个用户可以在同样的时间内使用同样的频带进行通信</li>
<li>由于各用户使用经过特殊挑选的不同码型，因此个用户之间不会造成干扰</li>
<li>CDM最初是用户军事通信的，因为这种系统所发送的信号有很强的抗干扰能力，其频谱类似于白噪声，不易被敌人发现</li>
<li>随着技术的进步，CDMA设备的价格和体积都大幅度下降，因而现在已广泛用于民用的移动通信中</li>
<li>码片：在CDMA中，每一个比特时间再划分为m个短的间隔，称为码片。通常m的值是64或128。</li>
<li>使用CDMA的每一个站被指派一个唯一的m bit码片序列 (直接序列扩频 DSSS)
<ul>
<li>一个站如果要发送比特1，则发送它自己的m bit码片序列</li>
<li>一个站如果要发送比特0，则发送它自己的m bit码片序列的二进制反码</li>
</ul>
</li>
<li>码片序列的挑选原则如下
<ul>
<li>分配给每个站的码片序列必须各不相同，实际常采用伪随机码序列</li>
<li>分配给每个站的码片序列必须相互正交(规格化内积为0) -&gt; 任何一个码片序列和自己的规格化内积都为1，任何一个码片序列和其他码片序列的反码的规格化内积也为0，任何一个码片序列和自己的反码的规格化内积为-1
<ul>
<li>用1表示1，用-1表示0</li>
<li>向量S表示站S的码片序列，向量T表示其他任何站的码片序列</li>
<li>两个不同站S和T的码片序列正交，就是向量S和T的规格化内积为0</li>
<li>S * T = (1/m) ∑ S<sub>i</sub> * T<sub>i</sub> = 0</li>
</ul>
</li>
</ul>
</li>
<li>应用举例
<img src="/images/WechatIMG99.jpg" alt="举例"></li>
</ul>
</li>
<li>复用和多址
<ul>
<li>复用是将单一媒体的频带资源划分成很多子信道，这些子信道之间相互独立，互不干扰。从媒体的整体频带资源上看，每个子信道只占用该媒体频带资源的一部分</li>
<li>多址(更确切地应该成为多点接入) 处理的是动态分配信道给用户。这在用户仅仅暂时性地占用信道的应用中是必须的，而所有的移动通信系统基本上都属于这种情况。相反，在信道永久性地分配给用户的应用中，多址是不需要的(对于无线广播或电视广播站就是这样)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="363-媒体接入控制-动态接入控制-随机接入">3.6.3 媒体接入控制-动态接入控制-随机接入</h3>
<p><img src="/images/WechatIMG100.jpg" alt="碰撞"></p>
<ul>
<li>载波监听多址接入/碰撞检测CSMA/CD(Carrier Sense Multiple Access/Collision Detection)</li>
<li>不适用于无线网络(无线网络可以使用CSMA/CA协议)，适用于总线局域网</li>
<li>多址接入
<ul>
<li>多个站连接在一条总线上，竞争使用总线</li>
</ul>
</li>
<li>载波监听CS
<ul>
<li>每一个站在发送帧之前先要检测一下总线上是否有其他站点在发送帧(&ldquo;先听后说&rdquo;)
<ul>
<li>若检测到总线空闲96比特时间，则发送这个帧</li>
<li>若检测到总线忙，则继续检测并等待总线转为空闲96比特时间，然后发送这个帧</li>
<li>96比特时间：发送96比特所耗费的时间，也称为帧间最小间隔，其作用是使接收方可以检测出一个帧的结束，同时也使所有其他站点都能有机会平等竞争信道并发送帧</li>
</ul>
</li>
</ul>
</li>
<li>碰撞检测
<ul>
<li>每一个正在发送帧的站边发送边检测碰撞(&ldquo;边说边听&rdquo;)
<ul>
<li>一旦发现总线上出现碰撞，则立即停止发送，退避一段随机时间后再次发送(&ldquo;一旦冲突，立即停说，等待时机，重新再说&rdquo;)</li>
</ul>
</li>
</ul>
</li>
<li>强化碰撞
<ul>
<li>以太网还采取一种叫做强化碰撞的措施。这就是当发送帧的站点一旦检测到碰撞，除了立即停止发送帧外，还要再继续发送32比特或48比特的人为干扰信号(Jamming Signal)，以便有足够多的碰撞信号使所有站点都能检测出碰撞</li>
</ul>
</li>
<li>争用期(碰撞窗口)
<img src="/images/WechatIMG101.jpg" alt="争用期">
<ul>
<li>主机最多经过2τ(即δ-&gt;0)的时长就可检测到本次发送是否遭受了碰撞 τ可由网络跨距和数据传输速率得出</li>
<li>以太网的端到端往返传播时延2τ称为争用期或碰撞窗口</li>
<li>经过争用期这段时间还没有检测到碰撞，才能肯定这次发送不会发生碰撞</li>
<li>每一个主机在自己发送帧之后的一小段时间内，存在着遭遇碰撞的可能性。这一小段时间是不确定的。它取决于另个发送帧的主机到本主机的距离，但不会超过总线的端到端的往返时延，即一个争用时间</li>
<li>显然，在以太网中发送帧的主机越多，端到端往返传播时延越大，发生碰撞的概率就越大。因此，共享式以太网不能连接太多的主机，使用的总线也不能太长
<ul>
<li>10Mb/s以太网把争用期定为512比特发送时间，即51.2μs, 因此其总线长度不能超过5120m，但考虑到其他一些因素，如信号衰减等，以太网规定总线长度不能超过2500m</li>
</ul>
</li>
</ul>
</li>
<li>最小帧长
<ul>
<li>帧长不能太短
<img src="/images/WechatIMG102.jpg" alt="帧长不能太短"></li>
<li>以太网规定最小帧长位64字节，即512比特(512比特时间即为争用期)
<ul>
<li>如果要发送的数据数目非常少，那么必须加入一些填充字节，使帧长不小于64字节</li>
</ul>
</li>
<li>以太网的最小帧长确保了主机可在帧发送完成之前就检测到该帧的发送过程中是否遭遇了碰撞
<ul>
<li>如果在争用期(共发送64字节)没有检测到碰撞，那么后续发送的数据就一定不会发生碰撞</li>
<li>如果在争用期检测到碰撞，就立即停止发送，这时已经发送出去的数据一定小于64字节，因此凡长度小于64字节的帧都是由于碰撞而异常中止的无效帧</li>
</ul>
</li>
<li>理解：在τ时间后，帧已占满信道，其他主机不会再发送信号，在τ时间前发生的碰撞可以在2τ时间内被检测到，立刻停止发送</li>
</ul>
</li>
<li>最大帧长
<ul>
<li>以太网的帧长应该有其上限
<img src="/images/WechatIMG103.jpg" alt="帧应该有上限"></li>
</ul>
</li>
<li>截断二进制指数退避算法
<ul>
<li>退避时间 = 基本退避时间(3τ) * 随机数r(从离散的整数集合{0, 1, &hellip;, (2<sup>k</sup>-1)}中随机选出一个整数k = Min[重传次数， 10])
<img src="/images/WechatIMG104.jpg" alt="例"></li>
<li>若连续多次发生碰撞，就表明可能有较多的主机参与竞争信道。但使用上述退避算法可使重传需要推迟的平均时间随重传次数而增大(这也称为动态退避)，因而减小发生碰撞的概率，有利于整个系统的稳定。</li>
<li>当重传达16次仍不能成功时，表明同时打算发送帧的主机太多，以至于连续发生碰撞，则丢弃该帧，并向高层报告</li>
</ul>
</li>
<li>信道利用率
<img src="/images/WechatIMG105.jpg" alt="信道利用率"></li>
<li>帧发送流程
<img src="/images/WechatIMG106.jpg" alt="帧发送"></li>
<li>帧接收流程
<img src="/images/WechatIMG106.jpg" alt="帧接收"></li>
</ul>
<h3 id="364-媒体接入控制-动态接入控制-随机接入">3.6.4 媒体接入控制-动态接入控制-随机接入</h3>
<ul>
<li>
<p>无线局域网使用的媒体接入控制协议CSMA/CA，也就是载波监听多址接入/碰撞避免</p>
</li>
<li>
<p>思考：既然使用CSMA/CD协议已经成功地应用于使用广播信道的有线局域网，那么同样使用广播信道的无线局域网能不能也使用CSMA/CD协议呢？</p>
<ul>
<li>在无线局域网中，仍然可以使用载波监听多址接入CSMA，即在发送帧之前先对传输媒体进行载波监听。若发现有其他站在发送帧，就推迟发送以免发生碰撞</li>
<li>在无线局域网中不能使用碰撞检测CD
<ul>
<li>由于无线信道的传输条件特殊，其信号强度的动态范围非常大，无线网卡上接收到的信号强度往往会远远小于发送信号的强度(可能相差百万倍)。如果要在无线网卡上实现碰撞检测CD，对硬件的要求非常高</li>
<li>即使能够在硬件上实现无线局域网的碰撞检测功能，但由于无线电波传播的特殊性(存在隐蔽站等问题)，进行碰撞检测的意义也不大</li>
</ul>
</li>
</ul>
</li>
<li>
<p>802.11无线局域网使用CSMA/CA协议，在CSMA的基础上增加了一个碰撞避免CA功能，而不再实现碰撞检测功能</p>
</li>
<li>
<p>由于不可能避免多有的碰撞，而且无线信道误码率较高，802.11标准还是用了数据链路层确认机制(停止-等待协议)来保证数据被正确接收</p>
</li>
<li>
<p>802.11的MAC层标准定义了两种不同的媒体接入控制方式</p>
<ul>
<li>分布式协调功能DCF。在DCF方式下，没有重心控制站点，每个站点使用CSMA/CA协议通过争用信道来获取发送权，这是802.11定义的默认方式</li>
<li>点协调功能PCF。PCF的方式使用集中控制的接入算法(一般在接入点AP实现集中控制)，是802.11定义的可选方式，在实际中较少使用。</li>
</ul>
</li>
<li>
<p>帧间间隔IFS</p>
<ul>
<li>802.11标准规定，所有的站点必须在持续监测到信道空闲一段指定时间后才能发送帧，这段时间称为帧间间隔IFS</li>
<li>帧间间隔的长短取决于该站点要发送的帧的类型
<ul>
<li>高优先级帧需要等待的时间较短，因此可优先获得发送权</li>
<li>低优先级帧需要等待的时间较长。若某个站的低优先级帧还没来得及发送，而其他站的高优先级帧已发送到信道上，则信道变为忙态，因而低优先级帧就只能再推迟发送了。这样就减少了发生碰撞的机会</li>
<li>常用帧间间隔
<ul>
<li>短帧间间隔SIFS(28μs)，是最短的帧间间隔，用来分隔开属于一次对话的各帧。一个站点应当能够在这段时间内从发送方式切换到接收方式。使用SIFS的帧类型有ACK帧、CTS帧、由过长的MAC帧分片后的数据帧、以及所有回答AP探询的帧和在PCF方式中接入点AP发送出的任何帧</li>
<li>DCF帧间间隔DIFS(128μs)，它比短帧间间隔SIFS要长得多，在DCF方式中用来发送数据帧和管理帧。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>CSMA/CA协议的工作原理</p>
<ul>
<li>源站为什么在检测到信道空闲后还要再等待一段时间DIFS
<ul>
<li>考虑到可能有其他的站有高优先级的帧要发送。若有，就要让高优先级帧先发送</li>
</ul>
</li>
<li>目的站为什么正确接受数据帧后还要等待一段时间SIFS才能发送ACK帧
<ul>
<li>SIFS是最短的帧间间隔，用来分隔开属于一次对话的各帧。在这段时间内，一个站点应该能从发送方式切换到接收方式</li>
</ul>
</li>
<li>信道由忙转为空闲且经过DIFS时间后，还要退避一段时间(随机时间)才能使用信道
<ul>
<li>防止多个站点同时发送数据而产生碰撞</li>
</ul>
</li>
<li>当检测到信道是空闲的，并且发送的数据帧不是成功发送完上一个数据帧之后立即连续发送的数据帧，则不使用退避算法。</li>
<li>以下情况必须使用退避算法
<ul>
<li>在发送数据帧之前检测到信道处于忙状态时</li>
<li>在每一次重传一个数据帧时</li>
<li>在每一次成功发送后要连续发送下一个帧时(这是为了避免一个站点长时间占用信道)
<img src="/images/WechatIMG121.jpg" alt="CSMA/CA协议的工作原理"></li>
</ul>
</li>
</ul>
</li>
<li>
<p>CSMA/CA协议的退避算法</p>
<ul>
<li>在执行退避算法时，站点为退避计时器设置一个随机的退避时间：
<ul>
<li>当退避计时器的时间减小到零时，就开始发送数据；</li>
<li>当退避计时器的时间还未减小到零时而信道又转变为忙状态，这时就冻结退避计时器的数值，重新等待信道变为空闲，再经过时间DIFS后，继续启动退避计时器</li>
</ul>
</li>
<li>在进行第i次退避时，退避时间在时隙编号{0, 1, &hellip;, 2<sup>2+i</sup>-1}中随机选择一个，然后乘以基本退避时间(也就是一个时隙的长度)就可以得到随机的退避时间。这样做是为了使不同站点选择相同退避时间的概率减小。当时隙编号达到255时(对应于第6次退避)就不再增加了。
<img src="/images/WechatIMG122.jpg" alt="CSMA/CA协议的退避算法"></li>
</ul>
</li>
<li>
<p>信道预约和虚拟载波监听</p>
<ul>
<li>为了尽可能减少碰撞的概率和降低碰撞的影响，802.11标准允许要发送数据的站点对信道进行预约
<ul>
<li>源站在发送数据帧之前先发送一个短的控制帧，成为请求发送RTS(Request To Send)，它包括源地址、目的地址以及这次通信(包括相应的确认帧)所需的持续时间</li>
<li>若目的站正确收到源站发来的RTS帧，且媒体空闲，就发送一个相应控制帧，称为允许发送CTS(Clear To Send)，它也包括这次通信所需的持续时间(从RTS帧中将此持续时间复制到CTS帧中)</li>
<li>源站收到CTS帧后，再等待一段时间SIFS后，就可以发送其数据帧</li>
<li>若目的站正确收到了源站发来的数据帧，再等待时间SIFS后，就向源站发送确认帧ACK。</li>
<li>除源站和目的站意外的其他各站，在收到CTS或数据帧后就推迟接入到无线局域网中。这样就保证了源站和目的站之间的通信不会受到其他站的干扰。</li>
<li>如果RTS帧发生碰撞，源站就收不到CTS帧，需执行退避算法重传RTS</li>
<li>由于RTS帧和CTS帧很短，发送碰撞的概率、碰撞产生的开销及本身的开销都很小。而对于一般的数据帧，其发送时延往往大雨传播时延(因为是局域网)，碰撞的概率很大，且一旦发生碰撞而导致数据帧重发，则浪费的时间就很多，因此用很小的代价对信道进行预约往往是值得的。802.11标准规定了3种情况供用户选择。
<ul>
<li>使用RTS帧和CTS帧</li>
<li>不使用RTS帧和CTS帧</li>
<li>只有当数据帧的长度超过某一数值时才使用RTS帧和CTS帧
<img src="/images/WechatIMG123.jpg" alt="信道预约"></li>
</ul>
</li>
<li>除RTS帧和CTS帧会携带通信需要持续的时间，数据帧也能携带通信需要持续的时间，这称为802.11的虚拟载波监听机制</li>
<li>由于利用虚拟载波监听机制，站点只要监听到RTS帧、CTS帧或数据帧中的任何一个，就能知道信道被占用的持续时间，而不需要真正监听到信道上的信号，因此虚拟载波监听机制能减少隐蔽站带来的碰撞问题。
<img src="/images/WechatIMG124.jpg" alt="虚拟载波监听机制"></li>
</ul>
</li>
</ul>
</li>
<li>
<p>例题解析</p>
<ul>
<li>CSMA是指载波监听多址接入，并不使用确认机制；争用型媒体接入控制协议，连接在同一媒体上的多个站点使用该协议以竞争方式发送数据帧，可能出现冲突(也称为碰撞)</li>
<li>CSMA/CD是指载波监听多址接入/碰撞检测，是对CSMA的改进，是早期共享信道以太网使用的信道访问控制协议，并不使用确认机制</li>
<li>CSMA/CA是指载波监听多址接入/碰撞避免，是802.11局域网采用的无线信道访问控制机制。802.11局域网在使用CSMA/CA的同时还使用停止-等待协议。</li>
<li>CDMA是指码分多址，属于静态划分信道，是物理层的信道复用技术，而不属于MAC协议，不会发生冲突</li>
<li>TDMA是指时分多址，同上</li>
<li>FDMA是指频分多址，同上</li>
</ul>
</li>
</ul>
<h2 id="37-mac地址ip地址以及arp协议">3.7 MAC地址、IP地址以及ARP协议</h2>
<ul>
<li>MAC地址是以太网的MAC子层所使用的地址(数据链路层)</li>
<li>IP地址是TCP/IP体系结构网际层所使用的地址(网际层)</li>
<li>ARP协议属于TCP/IP体系结构的网际层，其作用是已知设备所分配到的IP地址，使用ARP协议可以通过该IP地址获取到设备的MAC地址(网际层)</li>
<li>尽管IP地址和ARP协议属于TCP/IP体系结构的网际层(而不属于数据链路层)，但是它们与MAC地址存在的一定的关系，并且我们日常的网络应用都离不开MAC地址、IP地址以及ARP协议。因此，我们将这三者放在一起讨论</li>
</ul>
<h3 id="mac地址">MAC地址</h3>
<ul>
<li>属于数据链路层的范畴</li>
<li>点对点信道的数据链路层不需要地址</li>
<li>使用广播信道的数据链路层必须使用地址来区分各主机：当多各主机连接在同一个广播信道上，要想实现两个主机之间的通信，则每个主机都必须有一个唯一的标识，即一个数据链路层地址</li>
<li>在每个主机发送的帧中必须携带标识发送主机和接收主机的地址。由于这类地址是用于媒体接入控制MAC(Media Access Control)，因此这类地址被称为MAC地址
<ul>
<li>MAC地址一半被固化在网卡(网络适配器)的电可擦编程只读存储器EEPROM中，因此MAC地址也被称为硬件地址</li>
<li>MAC地址有时也被称为物理地址。例如在windows系统中。这并不意味着MAC地址属于网络体系结构中的物理层。</li>
</ul>
</li>
<li>一般情况下，用户主机会包含两个网络适配器：有线局域网适配器(有线网卡)和无线局域网适配器(无线网卡)。每个网络适配器都有一个全球唯一的MAC地址。而交换机和路由器往往拥有更多的网络接口，所以会拥有更多的MAC地址。综上所述，严格来说，MAC地址是对网络上各接口的唯一标识，而不是对网络上各设备的唯一标识。</li>
<li>IEEE 802局域网的MAC地址格式
<img src="/images/WechatIMG131.jpg" alt="MAC地址">
<img src="/images/WechatIMG132.jpg" alt="MAC地址格式"></li>
<li>台式机、笔记本电脑、平板电脑、智能手机上的以太网接口、WiFi接口、蓝牙接口都分布有全球单播的MAC地址，而每台交换机和路由器都拥有多个网络接口，也就拥有多个全球单播的MAC地址</li>
<li>MAC地址的发送顺序
<ul>
<li>字节发送顺序：第一字节-&gt;第六字节</li>
<li>字节内比特发送顺序：b<sub>0</sub> -&gt; b<sub>7</sub></li>
</ul>
</li>
<li>单播MAC地址举例
<img src="/images/WechatIMG133.jpg" alt="单播MAC地址"></li>
<li>广播MAC地址的举例
<img src="/images/WechatIMG134.jpg" alt="广播MAC地址">
<ul>
<li>判断MAC地址是否是多播：看第一字节第二位十六进制数能不能整除2，不能整除2即多播地址</li>
</ul>
</li>
<li>多播MAC地址举例
<img src="/images/WechatIMG135.jpg" alt="多播MAC地址">
<ul>
<li>给主机配置多播组列表进行私有应用时，不得使用共有的标准多播地址</li>
</ul>
</li>
<li>随机MAC地址
<ul>
<li>ios系列设备</li>
<li>windows 10</li>
<li>安卓6.0</li>
<li>内核版本3.18的linux系统</li>
<li>目前大多数移动设备已经采用了随机mac地址</li>
</ul>
</li>
</ul>
<h3 id="ip地址">IP地址</h3>
<ul>
<li>属于网络层的范畴</li>
<li>IP地址是因特网上的主机和路由器所使用的地址，用于标识两部分信息
<ul>
<li>网络编号：标识因特网上数以百计的网络</li>
<li>主机编号：标识同一网络上不同主机(或路由器各接口)
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-06%2016.06.23.png" alt="IP地址"></li>
</ul>
</li>
<li>MAC地址不具备区分不同网络的功能 但IP地址具备
<ul>
<li>如果只是一个单独的网络，不接入因特网，可以只使用MAC地址(这不是一般用户的应用方式)</li>
<li>如果主机所在的网络要接入因特网，则IP地址和MAC地址都需要使用</li>
</ul>
</li>
<li>从网络体系结构看IP地址与MAC地址
<img src="/images/WechatIMG423.jpg" alt="网络体系结构"></li>
<li>数据包转发过程中IP地址与MAC地址的变化情况
<img src="/images/WechatIMG425.jpg" alt="数据包转发">
<ul>
<li>数据包转发过程中源IP地址和目的IP地址保持不变</li>
<li>数据包转发过程中源MAC地址和目的MAC地址逐个链路(或逐个网络)改变
<img src="/images/WechatIMG426.jpg" alt="数据包转发过程中IP地址与MAC地址的变化情况"></li>
</ul>
</li>
</ul>
<h3 id="arp协议">ARP协议</h3>
<ul>
<li>地址解析协议</li>
<li>ARP请求报文
<ul>
<li>广播</li>
<li>大致内容
<ul>
<li>我的IP地址为&hellip;</li>
<li>我的MAC地址为&hellip;</li>
<li>我想知道IP地址为&hellip;的主机MAC地址</li>
</ul>
</li>
<li>封装在MAC帧中</li>
<li>网卡将收到的MAC帧交付上层处理，请求的主机进行响应
<ul>
<li>将收到的IP地址与MAC地址记录到自己的ARP高速缓存表中</li>
<li>给ARP发送方发送ARP响应，以告知自己的MAC地址</li>
</ul>
</li>
</ul>
</li>
<li>ARP响应报文
<ul>
<li>单播</li>
<li>我的IP地址为&hellip;</li>
<li>我的MAC地址为&hellip;</li>
<li>目的MAC地址匹配时网卡交付上层处理
<ul>
<li>将IP地址与MAC地址记录到自己的ARP高速缓存表中</li>
</ul>
</li>
</ul>
</li>
<li>ARP缓存
<ul>
<li>类型
<ul>
<li>动态：自动获取，生命周期默认为两分钟，之后自动删除-&gt;IP地址与MAC地址的对应关系并不是永久性的(网卡更换后，主机IP地址没有改变，但主机MAC地址改变)</li>
<li>静态：用户或网络维护人员手工设置，不同操作系统下的生命周期不同，例如系统重启后不存在或重启系统后依然有效</li>
</ul>
</li>
</ul>
</li>
<li>ARP协议只能在一段链路或一个网络上使用，而不能跨网络使用
<img src="/images/WechatIMG427.jpg" alt="ARP协议"></li>
<li>ARP还有其他类型的报文
<ul>
<li>用于检查IP地址冲突的无故ARP或称免费ARP</li>
</ul>
</li>
<li>ARP没有安全验证机制，存在ARP欺骗(攻击)问题</li>
</ul>
<h2 id="38-集线器与交换机的区别">3.8 集线器与交换机的区别</h2>
<ul>
<li>早期总线型以太网
<ul>
<li>粗同轴电缆-&gt;细同轴电缆
<img src="/images/WechatIMG428.jpg" alt="早期总线型以太网"></li>
</ul>
</li>
<li>使用双绞线和集线器HUB的星型以太网
<ul>
<li>使用集线器的以太网在逻辑上仍是一个总线网，各站共享总线资源，使用的还是CSMA/CD协议</li>
<li>集线器只工作在物理层，它的每个接口仅简单地转发比特，不进行碰撞检测(由各站的网卡检测)；</li>
<li>集线器一般都有少量的容错能力和网络管理功能。例如，若网络中某个网卡出了故障，1不停地发送帧。此时，集线器可以检测到这个问题，在内部断开与出故障网卡的连线，使整个以太网仍然能正常工作</li>
</ul>
</li>
<li>使用集线器HUB在物理层扩展以太网
<img src="/images/WechatIMG429.jpg" alt="独立的碰撞域">
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-06%2017.32.32.png" alt="更大的碰撞域"></li>
<li>以太网交换机
<ul>
<li>集线器与交换机的区别
<ul>
<li>集线器收到数据后会转发给其他所有设备</li>
<li>交换机收到数据后只会转发给目标设备
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-06%2017.34.46.png" alt="集线器与交换机的区别"></li>
</ul>
</li>
<li>以太网交换机通常有多个接口，每个接口都可以直接与一台主机或另一个以太网交换机相连。一般都工作在全双工方式</li>
<li>使用集线器的以太网在逻辑上共用总线，需要使用CSMA/CD协议来协调各主机争用总线，只能工作在办啥UN故宫模式</li>
<li>以太网交换机还具有并行性，能同时连接多对接口，使多对主机能同时通信，无碰撞(不实用CSMA/CD协议)</li>
<li>以太网交换机一般都具有多种速率的接口，例如10Mb/s、100Mb/s、1Gb/s、10Gb/s接口的多种组合</li>
<li>以太网交换机工作在数据链路层(也包括物理层)，它收到帧后，在帧交换表中查找帧的目的MAC地址所对应的接口号，然后通过该接口转发帧</li>
<li>以太网交换机是一种即插即用的设备，其内部的帧交换表是通过自学习算法自动地逐渐建立起来的</li>
<li>帧的两种转发方式
<ul>
<li>存储转发</li>
<li>直通交换：采用基于硬件的交叉矩阵(交换时延非常小，但不检查帧是否出错)
<ul>
<li>不必把整个帧缓存后再进行处理</li>
<li>在接收帧的同时，立刻按帧的目的MAC地址，决定该帧的转发接口，因而提高了帧的转发速率
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-06%2017.47.02.png" alt="以太网交换机"></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>对比集线器和交换机
<ul>
<li>单播与广播
<ul>
<li>集线器单播会发送给其他所有主机再进行判断</li>
<li>交换机单播仅会传播给目的主机</li>
<li>广播中集线器与交换机区别不大</li>
</ul>
</li>
<li>多台主机对同一台主机单播
<ul>
<li>集线器HUB会遭遇碰撞</li>
<li>交换机SWITCH不会遭遇碰撞</li>
</ul>
</li>
<li>扩展以太网
<ul>
<li>单播
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-06%2017.54.10.png" alt="单播"></li>
<li>广播
<ul>
<li>效果差不多
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-06%2017.56.36.png" alt="碰撞"></li>
</ul>
</li>
</ul>
</li>
<li>集线器扩大了广播域、扩大了碰撞域(冲突域)，交换机扩大了广播域、隔离碰撞域(冲突域)
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-06%2017.59.11.png" alt="对比"></li>
</ul>
</li>
</ul>
<h2 id="39-以太网交换机自学习和转发帧的流程">3.9 以太网交换机自学习和转发帧的流程</h2>
<ul>
<li>以太网交换机工作在数据链路层(也包括物理层)
<ul>
<li>目前市场上也有包含网络层的交换机-&gt;三层交换机</li>
</ul>
</li>
<li>以太网交换机收到帧后，在帧交换表中查找帧的目的MAC地址所对应的借口号，然后通过该接口转发帧</li>
<li>以太网交换机是一种即插即用的设备，刚上电启动时其内部的帧交换表是空的。随着网络中各主机间的通信，以太网交换机通过自学习算法自动建立起帧交换表</li>
<li>例
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-11%2010.55.48.png" alt="例"></li>
<li>以太网自学习和转发帧的流程
<ul>
<li>收到帧后进行登记。登记的内容为帧的源MAC地址及进入交换机的接口号</li>
<li>根据帧的目的MAC地址和交换机的帧转换表对帧进行转发，有以下三种情况
<ul>
<li>明确转发：交换机知道应当从哪个(或哪些)接口转发该帧(单播，多播，广播)</li>
<li>盲目转发：交换机不知道应当从哪个端口转发帧，只能将其通过除进入交换机的借口外的其他所有接口转发(也称为泛洪)</li>
<li>明确丢弃：交换机知道不应该转发该帧，将其丢弃</li>
</ul>
</li>
<li>帧交换表中每条记录都有自己的有效时间，到期删除
<ul>
<li>交换机的接口该接了另一台主机</li>
<li>主机更换了网卡</li>
</ul>
</li>
</ul>
</li>
<li>例
<ul>
<li>以太网交换机进行转发决策时使用的PDU地址是：目的物理地址
<ul>
<li>PDU的意思是协议数据单元，它是计算机网络体系结构中对等实体间逻辑通信的对象</li>
<li>以太网交换机工作在数据链路层(也包括物理层)，它接受并转发的PDU通常称为帧</li>
<li>以太网交换机收到帧后，在帧交换表中查找帧的目的MAC地址对应的接口号，然后通过该接口转发帧</li>
<li>MAC地址又称为硬件地址或物理地址。物理地址属于数据链路层范畴</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="310-以太网交换机的生成树协议stp">3.10 以太网交换机的生成树协议STP</h2>
<ul>
<li>如何提高以太网可靠性
<ul>
<li>添加冗余链路
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-11%2011.08.50.png" alt="">
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-11%2011.10.17.png" alt="">
<ul>
<li>负面效应：形成网络环路
<ul>
<li>广播风暴
<ul>
<li>广播帧在各交换机之间反复转发，分别按顺时针和逆时针方向同时兜圈</li>
<li>大量消耗网络资源，使网络无转发其他数据帧</li>
</ul>
</li>
<li>主机收到重复的广播帧
<ul>
<li>大量消耗主机资源</li>
</ul>
</li>
<li>交换机的帧交换表震荡(漂移)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>生成树协议 STP
<ul>
<li>可以在增加冗余链路来提高网络可靠性同时又避免网络环路带来的各种问题
<ul>
<li>自动计算并构建一个逻辑上没有环路的网络，其逻辑拓扑结构必须是树型的(无逻辑环路)</li>
<li>最终生成的树型拓扑要确保连通整个网络</li>
<li>当首次连接交换机或网络物理拓扑发生变化时(有可能是人为改变或故障)，交换机都将进行生成树的重新计算
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-11%2011.19.11.png" alt=""></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="311-虚拟局域网vlan">3.11 虚拟局域网VLAN</h2>
<h3 id="概述">概述</h3>
<ul>
<li>以太网交换机工作在数据链路层(也包括物理层)</li>
<li>使用一个或多个以太网交换机互连起来的交换式以太网，其所有站点都属于同一个广播域</li>
<li>随着交换式以太网规模的扩大，广播域相应扩大</li>
<li>巨大的广播域会带来很多弊端
<ul>
<li>广播风暴
<ul>
<li>浪费网络资源和各主机的CPU资源</li>
<li>网络中的主机应尽量不使用广播
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-11%2011.25.40.png" alt=""></li>
</ul>
</li>
<li>难以管理和维护</li>
<li>潜在的安全问题</li>
</ul>
</li>
<li>网络中会频繁出现广播协议
<ul>
<li>TCP/IP协议栈中的很多协议都会使用广播
<ul>
<li>地址解析协议ARP(已知IP地址，找出其相应的MAC地址)</li>
<li>路由信息协议RIP(一种小型的内部路由协议)</li>
<li>动态主机配置协议DHCP(用于自动配置IP地址)</li>
</ul>
</li>
<li>NetBEUI: Windows下使用的广播型协议</li>
<li>IPX/SPX: Novell网络的协议栈</li>
<li>Apple Talk: Apple公司的网络栈协议</li>
</ul>
</li>
<li>分割广播域的方法
<ul>
<li>使用路由器就可以隔离广播域</li>
<li>路由器工作在网络层</li>
<li>路由器默认情况下不对广播数据包进行转发</li>
<li>成本较高</li>
<li>-&gt;虚拟局域网</li>
</ul>
</li>
<li>虚拟局域网VLAN
<ul>
<li>一种将局域网内的设备划分成与物理位置无关的逻辑组的技术，这些逻辑组具有某些共同的需求</li>
<li>同一个VLAN内部可以广播通信，不同VLAN内部不能广播通信
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-11%2011.32.19.png" alt=""></li>
</ul>
</li>
</ul>
<h3 id="实现机制">实现机制</h3>
<ul>
<li>在交换机上实现
<ul>
<li>能够处理带有VLAN标记的帧 IEEE 802.1Q帧</li>
<li>交换机的各端口可以支持不同的端口类型</li>
</ul>
</li>
<li>IEEE 802.1Q帧(也称Dot One Q帧)对以太网的MAC帧格式进行了扩展，插入了4字节的VLAN标记
<ul>
<li>VLAN标记的最后12比特称为VLAN标识符VID，它唯一地标志了以太网帧属于哪一个VLAN
<ul>
<li>VID的取值范围是 0～4095(0～2<sup>12</sup> - 1)</li>
<li>0和4095都不用来表示VLAN，因此用于表示VLAN的VID的有效取值范围是1～4094
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-11%2011.38.20.png" alt=""></li>
</ul>
</li>
<li>802.1Q帧是由交换机来处理的，而不是用户主机来处理的
<ul>
<li>当交换机收到普通的以太帧时，会将其插入4字节的VLAN标记转变为802.1Q帧，简称&quot;打标签&quot;</li>
<li>当交换机转发802.1Q帧时，可能会删除其4字节VLAN标记转变为普通以太网帧，简称&quot;去标签&quot;</li>
</ul>
</li>
</ul>
</li>
<li>交换机的端口类型
<ul>
<li>Access
<ul>
<li>Access端口一般用于连接用户计算机</li>
<li>Access端口只能属于一个VLAN</li>
<li>Access端口的PVID值与端口所属VLAN的ID相同(默认为1)</li>
<li>接收处理方法
<ul>
<li>一般指接受“未打标签”的普通以太网MAC帧。根据接受端口的PVID给帧“打标签”，即插入4字节VLAN标记字段，字段中的VID取值与端口的PVID取值相等</li>
</ul>
</li>
<li>发送处理方法
<ul>
<li>若帧中的VID与端口的PVID相等，则“去标签”并转发该帧，否则不转发
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-11%2011.48.39.png" alt=""></li>
</ul>
</li>
</ul>
</li>
<li>Trunk
<ul>
<li>用于交换机之间/交换机与路由器之间的互连</li>
<li>可以属于多个VLAN</li>
<li>用户可以设置Trunk端口的PVID值。默认情况下，Trunk端口的PVID值为1</li>
<li>发送处理方法
<ul>
<li>对VID等于PVID的帧，“去标签”再转发</li>
<li>对VID不等于PVID的帧，直接转发</li>
</ul>
</li>
<li>接收处理方法
<ul>
<li>接收“未打标签”的帧，根据接受帧的端口的PVID给帧“打标签”，即插入4字节VLAN标记字段，字段中的VID取值与端口的PVID取值相等</li>
<li>接收“已打标签的帧”
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-11%2011.55.14.png" alt="">
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-11%2011.57.49.png" alt=""></li>
</ul>
</li>
<li>例
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-11%2012.01.18.png" alt=""></li>
</ul>
</li>
<li>Hybrid
<ul>
<li>交换机之间/交换机与路由器之间或交换机与用户计算机之间</li>
<li>可以属于多个VLAN</li>
<li>用户可以设置Hybrid端口的PVID值。默认情况下Hybrid端口的PVID值为1</li>
<li>发送处理方法
<ul>
<li>查看帧的VID是否在端口的“去标签列表中”</li>
<li>若存在，则“去标签”后再转发</li>
<li>若不存在，则直接转发</li>
</ul>
</li>
<li>接收处理方法
<ul>
<li>接收“未打标签”的帧，根据接受帧的端口的PVID给帧“打标签”，即插入4字节VLAN标记字段，字段中的VID取值与端口的PVID取值相等</li>
<li>接收“已打标签的帧”
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-11%2012.08.38.png" alt="">
<ul>
<li>主机无法处理802.1Q帧</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>交换机各端口的缺省VLAN ID
<ul>
<li>在思科交换机上称为Native VLAN，即本征VLAN</li>
<li>在华为交换机上称为Port VLAN ID，即端口VLAN ID，简记为PVID</li>
<li>交换机的每个端口有且仅有一个PVID</li>
</ul>
</li>
</ul>
<h1 id="p4-网络层">P4 网络层</h1>
<h2 id="41-网络层概述">4.1 网络层概述</h2>
<ul>
<li>网络层的主要任务是实现网络互连，进而实现数据包在个网络之间的传输</li>
<li>要实现网络层任务，需要解决一下主要问题
<ul>
<li>网络层向运输层提供怎样的服务(&ldquo;可靠传输&quot;还是&quot;不可靠传输&rdquo;)
<ul>
<li>因特网使用的TCP/IP协议的网际层，提供的是无连接的、不可靠的数据报服务</li>
<li>ATM、帧中继和X.25的网络层提供的是面向连接的、可靠的虚电路服务</li>
</ul>
</li>
<li>网络寻址问题
<ul>
<li>TCP/IP协议中的网际层使用IP地址
<ul>
<li>网络编号+路由器借口</li>
</ul>
</li>
</ul>
</li>
<li>路由选择问题
<ul>
<li>依据目的地址和路由表(目的网络、下一跳路由器)</li>
<li>由用户/网络管理人员人工配置：适用于规模较小，且网络拓扑不改变的小型互联网</li>
<li>实现各种路由选择协议，由路由器执行路由选择协议中所规定的路由选择算法自动得出路由表中的路由记录：适用于规模较大，且网络拓扑经常改变的大型互联网</li>
</ul>
</li>
</ul>
</li>
<li>因特网
<ul>
<li>因特网是目前全世界用户数量最多的互联网，它使用TCP/IP协议栈</li>
<li>由于TCP/IP协议栈的网络层使用网际协议IP，它是整个协议栈的核心协议，因此在TCP/IP协议栈中网络层常称为网际层</li>
<li>基于TCP/IP协议栈的网络层来学习网络层的理论知识和实践技术
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-12%2020.33.19.png" alt=""></li>
</ul>
</li>
</ul>
<h2 id="42-网络层提供的两种服务">4.2 网络层提供的两种服务</h2>
<h3 id="面向连接的虚电路服务">面向连接的虚电路服务</h3>
<ul>
<li>可靠通信由网络来保证</li>
<li>必须建立网络层的连接——虚电路VC</li>
<li>通信双方沿着已建立的虚电路发送分组</li>
<li>目的主机的地址仅在连接建立阶段使用，之后每个分组的首部只需携带一条虚电路的编号(构成虚电路的每一段链路都有一个虚电路编号)</li>
<li>这种通信方式如果在使用可靠传输的网络协议，就可使所发送的分组最终正确到达接收方(无差错按需到达、不丢失、不重复)</li>
<li>通信结束后，需要释放之前所建立的虚电路</li>
<li>很多广域分组交换网都适用面向连接的虚电路服务。例如：曾经的X.25和逐渐过时的帧中继FR、异步传输模式ATM等</li>
</ul>
<h3 id="无连接的数据报服务">无连接的数据报服务</h3>
<ul>
<li>可靠通信应当由用户主机来保证</li>
<li>不需要建立网络层连接</li>
<li>每个分组可走不同的路径</li>
<li>每个分组的首部必须携带目的主机的完整地址</li>
<li>这种通信方式所传送的分组可能误码、丢失、重复和失序</li>
<li>由于网络本身不提供端到端的可靠传输服务，这就使网络中的路由器可以做得比较简单，而且价格低廉(与电信网的交换机相比较)</li>
<li>因特网采用了这中设计思想，也就是将复杂的网络处理功能置于因特网的边缘(用户主机和其内部的运输层)，而将相对简单的尽最大努力的分组交付功能置于因特网核心</li>
</ul>
<h2 id="43-ipv4地址">4.3 IPv4地址</h2>
<h3 id="431-ipv4地址概述">4.3.1 IPv4地址概述</h3>
<ul>
<li>在TCP/IP体系中，IP地址是一个最基本的概念，我们必须把它弄清楚</li>
<li>IPv4地址就是给因特网(Internet)上的每一台主机(或路由器)的每一个接口分配一个在全世界范围内是唯一的32比特的标识符</li>
<li>IP地址由因特网名字和数字分配机构ICANN(Internet Corporation for Assigned Names and Numbers)进行分配
<ul>
<li>我国用户可向亚太网络中心ACPNIC申请IP地址，需要缴费</li>
<li>2011年2月3日，互联网号码分配管理局IANA(由ICANN行使职能)宣布，IPv4地址已经分配完毕</li>
<li>我国在2014至2015年也逐步停止了向新用户和应用分配IPv4地址。同时全面开展商用部署IPv6</li>
</ul>
</li>
<li>IPv4地址的编址方法经历了如下三个历史阶段
<ul>
<li>1981 分类编址</li>
<li>1985 划分子网</li>
<li>1993 无分类编址</li>
</ul>
</li>
<li>点分十进制表示方法
<ul>
<li>32bitIP地址，每8bit一组，共四组</li>
<li>写出每组的十进制数</li>
<li>每组之间用点分隔</li>
</ul>
</li>
</ul>
<h3 id="432-分类编址的ipv4地址">4.3.2 分类编址的IPv4地址</h3>
<p><img src="/images/%E6%88%AA%E5%B1%8F2024-04-13%2012.02.58.png" alt=""></p>
<ul>
<li>A类地址
<ul>
<li>最小网络号0，保留不指派</li>
<li>第一个克制拍的网络号为1:1.0.0.0</li>
<li>最大网络号127，作为本地环回测试地址，不指派
<ul>
<li>最小的本地环回测试地址为127.0.0.1</li>
<li>最大的本地环回测试地址为127.255.255.254</li>
</ul>
</li>
<li>最后一个可指派的网络号为126，网络地址为126.0.0.0</li>
<li>可指派的网络数量为 2<sup>(8-1)</sup> - 2 = 126(减2的原因是除去最小网络号0和最大网络号127)</li>
<li>每个网络中可分配的IP地址数量为 2<sup>24</sup> - 2 = 16777214(减2的原因是去掉主机号为全0的网络地址和全1的广播地址)
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-13%2011.38.46.png" alt="A类地址"></li>
</ul>
</li>
<li>B类地址
<ul>
<li>最小网络号也是第一个可指派的网络号128.0
<ul>
<li>网络地址为128.0.0.0</li>
</ul>
</li>
<li>最大网络好也是最后一个可指派的网络号191.255
<ul>
<li>网络地址为191.255.0.0</li>
</ul>
</li>
<li>可指派的网络数量 2<sup>(16-2)</sup> = 16384</li>
<li>每个网络中可分配的IP地址数量为2<sup>16</sup> - 2 = 65534(减2的原因是除去主机号为全0的网络地址和全1的广播地址)
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-13%2011.43.14.png" alt=""></li>
</ul>
</li>
<li>C类地址
<ul>
<li>最小网络号也是第一个可指派的网络号192.0.0
<ul>
<li>网络地址为192.0.0.0</li>
</ul>
</li>
<li>最大网络号也是最后一个可指派的网络号223.255.255
<ul>
<li>网络地址为223.255.255.0</li>
</ul>
</li>
<li>可指派的网络数量 2<sup>(24-3)</sup> = 2097152</li>
<li>每个网络中可分配的IP地址数量为
<ul>
<li>2<sup>8</sup> - 2 = 254(减2的原因是除去主机号为全0的网络地址和全1的广播地址)
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-13%2011.48.30.png" alt=""></li>
</ul>
</li>
</ul>
</li>
<li>D类地址</li>
<li>E类地址</li>
<li>注意事项
<ul>
<li>只有A类、B类和C类地址可分配给网络中的主机或路由器的各接口</li>
<li>主机号为“全0”的地址是网络地址，不能分配给主机或路由器的各接口</li>
<li>主机号为“全1”的地址是广播地址，不能分配给主机或路由器的各接口</li>
</ul>
</li>
<li>例：由IP地址判断类别和是否可以指派给主机
<ul>
<li>根据地址左起第一个十进制数中的值，可以判断出网络类别(小于127的为A类，128～191的为B类，192～223的为C类)</li>
<li>根据网络类别，就可以找出地址中的网络号部分和主机号部分(A类地址网络号为左起第一个字节，B类地址网络号为左起前两个字节，C类地址网络号为左起前三个字节)</li>
<li>以下三种情况的地址不能指派给主机或路由器接口
<ul>
<li>A类网络号0和127</li>
<li>主机号为“全0”，这是网络地址</li>
<li>主机号为“全1”，这是广播地址</li>
</ul>
</li>
</ul>
</li>
<li>例
<ul>
<li>地址0.0.0.0是一个特殊的IPv4地址，只能作为源地址使用(不能作为目的地址使用)，表示“在本网络上的本主机”。封装有DHCP Discovery报文的IP分组的源地址使用0.0.0.0；</li>
<li>以127开头且后面三个字节非“全0”或“全1”的IP地址是一类特殊的IPv4地址，既可以作为源地址使用，也可以作为目的地址使用，用于本地软件环回测试，例如常用的环回测试地址127.0.0.1</li>
<li>地址255.255.255.255是一个特殊的IPv4地址，只能作为目的地址使用，表示“只在本网络上进行广播”(各路由器均不转发)
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-13%2012.00.41.png" alt=""></li>
</ul>
</li>
<li>例
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-13%2012.08.19.png" alt=""></li>
</ul>
<h3 id="433-划分子网的ipv4地址">4.3.3 划分子网的IPv4地址</h3>
<ul>
<li>分类编址中，为新增网络申请新的网络号会带来以下弊端
<ul>
<li>需要等待时间和花费更多的费用</li>
<li>会增加其他路由器中路由表记录的数量</li>
<li>浪费原有网络中剩余的大量IP地址</li>
<li>-&gt;从IP地址的主机号中借用一部分作为子网号</li>
</ul>
</li>
<li>32比特的子网掩码
<ul>
<li>表明分类IP地址的主机号部分被借用了几个比特作为子网号</li>
<li>子网掩码使用连续的比特1来对应网络号和子网号</li>
<li>子网掩码使用连续的比特0来对应主机号</li>
<li>将划分子网的IPv4地址与其相应的子网掩码进行逻辑与运算就可以得到IPv4地址所在子网的网络地址</li>
</ul>
</li>
<li>例
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-14%2009.50.40.png" alt=""></li>
<li>默认的子网掩码
<ul>
<li>未划分子网的情况下使用的子网掩码</li>
<li>没有额外的子网号，网络号对应1，主机号对应0</li>
</ul>
</li>
</ul>
<h3 id="434-无分类编址的ipv4地址">4.3.4 无分类编址的IPv4地址</h3>
<ul>
<li>划分子网在一定程度上缓解了因特网在发展中遇到的困难，但数量巨大的C类网因为其地址空间太小并没有得到充分使用，而因特网的IP地址仍在加速消耗，整个IPv4地址空间面临全部耗尽的威胁</li>
<li>为此，因特网工程任务组IRTF又提出了采用无分类编址的方法来解决IP地址紧张的问题，同时还专门成立IPv6工作组负责研究新版本IP以彻底解决IP地址耗尽问题</li>
<li>1993年，IETF发布了无分类域间路由选择CIDR的RFC文档：RFC1517～1519和1520
<ul>
<li>CIDR消除了传统的A类、B类和C类地址，以及划分子网的概念</li>
<li>CIDR可以更加有效地分配IPv4的地址空间，并且可以在新的IPv6使用之前允许因特网的规模继续增长</li>
</ul>
</li>
<li>CIDR使用“斜线记法“，或称CIDR记法。鸡仔IPv4地址后面加上了斜线”/“，在斜线后面写上网络前缀所占的比特数量
<ul>
<li>例：128.14.35.7/20 网络前缀占用的比特数量：20；主机编号占用的比特数量：32-20=12</li>
</ul>
</li>
<li>CIDR实际上是将网络前缀都相同的连续IP地址组成一个“CIDR地址块”</li>
<li>我们只要知道CIDR地址快肿的任何一个地址，就可以知道地址块的全部细节
<ul>
<li>地址块的最小地址</li>
<li>地址块的最大地址</li>
<li>地址块中的地址数量</li>
<li>地址块聚合某类网络(A类、B类或C类)的数量</li>
<li>地址掩码(也可继续成为子网掩码)</li>
</ul>
</li>
<li>路由聚合(构造超网)
<ul>
<li>将来自同一个路由器的几条路由记录聚合为一条</li>
<li>找到最长的共同前缀-&gt;聚合地址块，斜杠后标注共同前缀长度</li>
<li>网络前缀越长，地址块越小，路由越具体</li>
<li>若路由器查表转发分组时发现有多条路由可选，则选择网络前缀最长的那条，这称为最长前缀匹配，因为这样的路由更具体
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-14%2010.21.05.png" alt=""></li>
</ul>
</li>
</ul>
<h3 id="435-ipv4地址的应用规划">4.3.5 IPv4地址的应用规划</h3>
<ul>
<li>给定一个IPv4地址块，如何将其划分成更小的地址块，并将这些地址块分配给互联网中的不同网络，进而可以给个网络中的主机和路由器接口分配IPv4地址</li>
<li>定长的子网掩码FLSM
<ul>
<li>使用同一个子网掩码来划分子网</li>
<li>每个子网所分配的IP地址数量相同，造成IP地址的浪费
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-15%2020.29.49.png" alt="">
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-15%2020.35.37.png" alt="">
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-15%2020.37.00.png" alt=""></li>
<li>容易造成IP地址的浪费</li>
</ul>
</li>
<li>变长的子网掩码VLSM
<ul>
<li>使用不同的子网掩码来划分子网</li>
<li>每个子网所分配的IP地址数量可以不同，尽可能减少对IP地址的浪费
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-15%2020.43.26.png" alt=""></li>
</ul>
</li>
</ul>
<h2 id="44-ip数据报的发送和转发过程">4.4 IP数据报的发送和转发过程</h2>
<ul>
<li>IP数据报的发送和转发过程包含以下两部分
<ul>
<li>主机发送IP数据报</li>
<li>路由器转发IP数据报</li>
</ul>
</li>
<li>通信
<ul>
<li>同一个网络中的主机之间可以直接通信：直接交付</li>
<li>不同网络中的主机之间的通信，需要通过路由器中转：间接交付</li>
</ul>
</li>
<li>源主机如何知道目的主机是否与自己在同一个网络中
<ul>
<li>源主机将目的主机的IP地址与自己主机的子网掩码相与</li>
<li>源主机将自己的IP地址与自己的子网掩码相与</li>
<li>二者不相等-&gt;不在同一网络(间接交付)；二者相等-&gt;在同一网络</li>
</ul>
</li>
<li>源主机如何知道将数据交付给哪个主机
<ul>
<li>用户为了让本网络中的主机能和其他网络中的主机进行通信，必须给其指定本网络中的一个路由器，由该路由器帮忙进行转发</li>
<li>所指定的路由器称为默认网关</li>
<li>将路由器接口的IP地址指定给该接口所直连网络中的各个主机作为默认网关</li>
</ul>
</li>
<li>路由器收到IP数据包之后如何转发
<ul>
<li>检查IP数据报首部是否出错
<ul>
<li>若出错，则直接丢弃该IP数据报并通告源主机</li>
<li>若没有出错，则进行转发
<ul>
<li>取出IP数据报首部中的地址
<ul>
<li>源地址</li>
<li>目的地址</li>
</ul>
</li>
<li>查表转发</li>
</ul>
</li>
</ul>
</li>
<li>根据IP数据报的目的地址在路由表中查找匹配的条目
<ul>
<li>若找到匹配的条目，则转发给条目中指示的吓一跳</li>
<li>若找不到，则丢弃该IP数据报并通告源主机</li>
</ul>
</li>
</ul>
</li>
<li>广播
<ul>
<li>路由器隔离广播域</li>
<li>对于子网广播，路由器不会转发</li>
<li>中继器、集线器工作在物理层，既不隔离冲突域也不隔离广播域</li>
<li>网桥和交换机工作在数据链路层，可以隔离冲突域，不能隔离广播域</li>
<li>路由器工作在网络层，既隔离冲突域，也隔离广播域</li>
</ul>
</li>
<li>IP路由器
<ul>
<li>工作在TCP/IP体系结构的网际层(或称IP层)，TCP/IP体系结构的网际层并不负责可靠传输，也就是不能确保传输的IP分组不丢失</li>
<li>IP路由器对收到的IP分组头进行差错校验，当发现错误时会丢弃该IP分组并向源主机发送ICMP差错报告报文(类行为参数错误)</li>
<li>运行路由协议，设置路由表</li>
<li>检测到拥塞时，合理丢弃IP分组</li>
<li>根据收到的IP分组的目的IP地址，将其转发到合适的输出线路上
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-15%2021.17.38.png" alt=""></li>
</ul>
</li>
</ul>
<h2 id="45-静态路由配置及其可能产生的路由环路问题">4.5 静态路由配置及其可能产生的路由环路问题</h2>
<ul>
<li>静态路由配置
<ul>
<li>用户或网络管理员使用路由器的相关命令给路由器人工配置路由表</li>
<li>这种人工配置方式简单、开销小。但不能及时适应网络状态(流量、拓扑等)的变化</li>
<li>一般只在小规模网络中采用
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-16%2019.33.30.png" alt=""></li>
</ul>
</li>
<li>使用静态路由配置可能出现以下导致产生路由环路的错误
<ul>
<li>配置错误
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-16%2019.43.53.png" alt="正常配置">
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-16%2019.48.32.png" alt="配置错误">
<ul>
<li>为了防止IP数据报在路由环路中永久兜圈，在IP数据报首部设有生存时间TTL字段</li>
<li>IP数据报进入路由器后，TTL字段的值减1。脱TTL的值不等于0，则被路由器转发，否则被丢弃</li>
</ul>
</li>
<li>聚合了不存在的网络而导致路由环路
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-16%2019.51.38.png" alt="">
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-16%2019.54.01.png" alt="">
<ul>
<li>解决方法，添加黑洞路由
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-16%2019.55.29.png" alt=""></li>
</ul>
</li>
<li>网络故障
<ul>
<li>故障-&gt;删除路由条目
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-16%2019.58.50.png" alt="网络故障"></li>
<li>添加黑洞路由
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-16%2020.02.56.png" alt=""></li>
<li>故障消失-&gt;添加路由条目，对应的黑洞路由失效</li>
<li>再次出现故障-&gt;删除路由条目，对应的黑洞路由生效</li>
</ul>
</li>
</ul>
</li>
<li>默认路由
<ul>
<li>网络前缀最长，路由最具体</li>
</ul>
</li>
<li>特定主机路由
<ul>
<li>网络前缀最短，路由最模糊</li>
</ul>
</li>
<li>多条路由可选时，最长前缀匹配
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-16%2019.41.27.png" alt=""></li>
</ul>
<h2 id="46-路由器">4.6 路由器</h2>
<h3 id="461-路由选择协议概述">4.6.1 路由选择协议概述</h3>
<ul>
<li>静态路由选择
<ul>
<li>由人工配置的网络路由、默认路由、特定主机路由、黑洞路由等都属于静态路由</li>
<li>人工配置方式简单、开销小，但不能及时适应网络状态(流量、拓扑等)的变化</li>
<li>一般只在小规模网络中采用</li>
</ul>
</li>
<li>动态路由选择
<ul>
<li>路由器通过路由选择协议自动获取路由信息</li>
<li>比较复杂、开销比较大。但能较好地适应网络状态的变化</li>
<li>适用于大规模网络</li>
</ul>
</li>
<li>因特网所采用的路由选择协议的主要特点
<ul>
<li>自适应
<ul>
<li>动态路由选择，能较好地适应网络状态的变化</li>
</ul>
</li>
<li>分布式
<ul>
<li>路由器之间交换路由信息</li>
</ul>
</li>
<li>分层次
<ul>
<li>将整个因特网划分为许多较小的自治系统AS
<ul>
<li>自治系统之间：域间路由选择 外部网关协议EGP，即外部路由协议ERP</li>
<li>自治系统之内：域内路由选择 内部网关协议IGP(分类名称而非具体协议)，即内部路由协议IRP，各路由器选择的IRP无关</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>常见的路由选择协议
<ul>
<li>内部网关协议IGP
<ul>
<li>路由信息协议RIP
<ul>
<li>基于距离向量</li>
<li>RIP在因特网上最早使用</li>
</ul>
</li>
<li>内部网关路由协议IGRP
<ul>
<li>基于距离向量</li>
<li>IGRP是思科早期私有的协议，现在已被EIGRP取代</li>
</ul>
</li>
<li>增强型内部网关路由协议EIGRP
<ul>
<li>思科私有的，用来取代IGRP的混合型路由协议(结合距离向量和链路状态)</li>
</ul>
</li>
<li>开放式最短路径优先OSPF
<ul>
<li>基于链路状态</li>
<li>OSPF在各种网络中广泛使用</li>
</ul>
</li>
<li>中间系统到中间系统IS-IS
<ul>
<li>基于链路状态</li>
<li>集成化IS-IS是ISP骨干网上最常用的IGP协议</li>
</ul>
</li>
</ul>
</li>
<li>外部网关协议EGP
<ul>
<li>边界网关协议BGP</li>
</ul>
</li>
</ul>
</li>
<li>路由器的基本结构
<ul>
<li>路由选择部分
<ul>
<li>核心构件：路由选择处理机
<ul>
<li>根据路由选择协议，周期性的与其他路由器进行路由信息交互，来更新路由表</li>
<li>处理收到的路由报文</li>
<li>周期性的给其他路由器发送自己所知道的路由信息</li>
</ul>
</li>
<li>路由表
<ul>
<li>一半仅包含从目的网络到下一跳的映射</li>
<li>路由表需要对网络拓扑变化的计算最优化</li>
<li>转发表是从路由表得出的</li>
<li>转发表的接哦股应当使查找过程最优化</li>
</ul>
</li>
</ul>
</li>
<li>分组转发部分
<ul>
<li>交换结构
<ul>
<li>输入端口
<ul>
<li>物理层-&gt;数据链路层(去掉帧头和帧尾)-&gt;网络层
<ul>
<li>普通待转发的目的分组-&gt;查找匹配条目转发/丢弃</li>
<li>路由报文-&gt;路由选择处理机-&gt;更新路由表</li>
</ul>
</li>
</ul>
</li>
<li>输出端口
<ul>
<li>网络岑更新数据分组中某些字段的值，将数据分组的生存时间减1，送交数据链路层进行封装</li>
<li>数据链路层将数据分组封装成帧，送交物理层处理</li>
<li>物理层将帧看作比特流，变换成电信号进行发送</li>
</ul>
</li>
<li>路由器的端口一般都具有输入和输出的功能</li>
<li>转发表</li>
<li>输入缓冲区
<ul>
<li>暂存新进入路由器但还来不及处理的分组</li>
</ul>
</li>
<li>输出缓冲区
<ul>
<li>暂存已经处理完毕但还来不及发送的分组</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="462-路由信息协议rip的基本工作原理">4.6.2 路由信息协议RIP的基本工作原理</h3>
<ul>
<li>路由信息协议RIP是内部网关协议IGP中最先得到广泛使用的协议之一，其相关标准文档为RFC 1058</li>
<li>RIP要自治系统AS内的每一个路由器都要维护从它自己到AS内其他每一个网络的距离记录。这是一组距离，称为“距离向量D-V(Distance-Vector)“。</li>
<li>RIP使用跳数作为度量来衡量到达目的网络的距离
<ul>
<li>路由器到直连网络的距离定义为1</li>
<li>路由器到非直连网络的距离定义为所经过的路由器数加1</li>
<li>允许一条路径最多只能包含15个路由器。“距离”等于16时相当于不可达。因此，RIP只适用于小型互联网</li>
</ul>
</li>
<li>RIP认为好的路由就是“距离短”的路由，也就是所通过路由器数量最少的路由</li>
<li>当到达同一目的网络有多条“距离相等”的路由时，可以进行等价负载均衡-&gt;将通信量均衡地分布到多条等价的路由上</li>
<li>RIP包含以下三个要点
<ul>
<li>仅和相邻路由器交换信息</li>
<li>交换路由器自己的路由表</li>
<li>周期性交换(例如每30s)</li>
</ul>
</li>
<li>存在问题：坏消息传的慢
<ul>
<li>被谣言误导</li>
<li>路由环路，时间长达数分钟</li>
<li>路由环路/距离无穷计数问题</li>
<li>解决
<ul>
<li>限制最大路径距离为15</li>
<li>当路由表发生变化时就立即发送更新报文(即“触发更新”)，而不仅是周期性发送</li>
<li>让路由器记录收到某特定路由信息的接口，而不让统一路由信息再通过此接口向反方向传送(即“水平分割”)</li>
<li>不能彻底避免路由环路问题</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="463-开放最短路径优先ospf的基本工作原理">4.6.3 开放最短路径优先OSPF的基本工作原理</h3>
<ul>
<li>开放最短路径优先OSPF，是为克服RIP的缺点在1989年开发出来的
<ul>
<li>“开放”表明OSPF协议不是受某一家厂商控制，而是公开发表的</li>
<li>“最短路径优先”是因为使用了Dijkstra提出的最短路径算法SPF</li>
</ul>
</li>
<li>OSPF是基于链路状态的，而不像RIP那样是基于距离向量的</li>
<li>OSPF采用SPF算法计算路由，从算法上保证了不会产生路由环路</li>
<li>OSPF不限制网络规模，更新效率高，收敛速度快</li>
<li>链路状态是指本路由器都和哪些路由器相邻，以及相应链路的“代价”
<ul>
<li>“代价”用来表示费用、距离、时延、带宽，等等。这些都由网络管理人员来决定</li>
<li>举例：思科路由器中OSPF计算代价的方法
<ul>
<li>100Mbps/链路带宽</li>
<li>计算结果小于1的值记为1；大于1且有小数的，舍去小数</li>
</ul>
</li>
</ul>
</li>
<li>OSPF相邻路由器之间通过交互问候分组，建立和维护邻居关系
<ul>
<li>Hello分组封装在IP数据报中，发往组播地址224.0.0.5</li>
<li>发送周期为10s</li>
<li>40s未收到来自邻居路由器的Hello分组，则认为该邻居路由器不可达</li>
<li>每个路由器都会建立一个邻居表
<ul>
<li>邻居ID</li>
<li>接口</li>
<li>“死亡“倒计时</li>
</ul>
</li>
</ul>
</li>
<li>使用OSPF的每个路由器都会产生链路状态通告LSA
<ul>
<li>直连网络的链路状态信息</li>
<li>邻居路由器的链路状态信息</li>
</ul>
</li>
<li>LSA被封装在链路状态更新分组LSU中，采用洪泛法发送</li>
<li>使用OSPF的每个路由器都有一个链路状态数据库LSDB，用于存储LSA</li>
<li>通过各路由器洪法发送封装有自己LSA的LSU分组，各路由器的LSDB最终将达到一致</li>
<li>使用OSPF的各路由器基于LSDB进行最短路径优先SPF计算，构建出各自到达其他各路由器的最短路径，即构建各自的路由表</li>
<li>OSPF有以下五种分组类型
<ul>
<li>类型1，问候(Hello)分组：用来发现和维护邻居路由器的可达性</li>
<li>类型2，数据库描述(Database Description)分组：向邻居路由器给出自己的链路状态数据库中的所有链路状态项目的摘要信息</li>
<li>类型3，链路状态请求(Link State Request)分组：向邻居路由器请求发送某些链路状态项目的详细信息</li>
<li>类型4，链路状态更新(Link State Update)分组：路由器使用这种分组将其链路状态进行洪泛发送，即用洪泛法对全网更新链路状态 30s或链路状态发生变化时</li>
<li>类型5，链路状态确认(Link State Acknowledgment)分组：这是对链路状态更新分组的确认分组</li>
</ul>
</li>
<li>OSPF在多点接入网络中路由器邻居关系的建立
<ul>
<li>会产生大量多播分组</li>
<li>-&gt;选举指令路由器DR和备用的指定路由器BDR</li>
<li>所有的DR/BDR只与DR/BDR建立邻居关系</li>
<li>非DR/BDR之间通过DR/BDR交换信息，若DR出现问题，则BDR顶替DR的位置</li>
</ul>
</li>
<li>为了使OSPF能够用于规模很大的网络，OSPF把一个自治系统再划分为若干个更小的范围，叫做区域(Area)
<ul>
<li>把利用洪泛法交换链路状态信息的范围，局限于每一个区域而不是整个自治系统，减少了整个网络上的通信量</li>
<li>区域内路由器：如果路由器上的所有接口都在同一个区域内</li>
<li>区域边界路由器：一个接口用于连接自身所在区域，另一个接口用来连接主干区域</li>
<li>主干路由器：主干区域内的路由器，也可以把区域边界路由器看作主干路由器</li>
<li>自治系统边界路由器ASBR：专门和本自治系统外的其他自治系统交换路由信息</li>
</ul>
</li>
</ul>
<h3 id="464-边界网关协议bgp的基本工作原理">4.6.4 边界网关协议BGP的基本工作原理</h3>
<ul>
<li>因特网采用分层次的路由选择协议</li>
<li>内部网关协议IGP(例如路由信息协议RIP或开放最短路径优先OSPF)
<ul>
<li>设法使分组在一个自治系统内尽可能有效地从源网络传输到目的网络</li>
<li>无需考虑自治系统外部其他方面的策略</li>
</ul>
</li>
<li>外部网关协议EGP(例如边界网关协议BGP)
<ul>
<li>在不同自治系统内，度量路由的“代价”可能不同-&gt;对于自治系统之间的路由选择，使用“代价”作为度量来寻找最佳路由是不行的</li>
<li>自治系统之间的路由选择必须考虑相关策略(政治，经济，安全等)</li>
<li>BGP只能是力求寻找一条能够到达目的网络且比较好的路由(不能兜圈子)，而并非要寻找一条最佳路由</li>
</ul>
</li>
<li>在配置BGP时，每个自治系统的管理员要选择至少一个路由器作为该自治系统的&quot;BGP发言人&quot;(往往就是BGP边界路由器)</li>
<li>不同自治系统的BGP发言人要交换路由信息，首先必须建立TCP连接，端口号为179
<ul>
<li>在此TCP连接上交换BGP报文以建立BGP会话</li>
<li>利用BGP会话交换路由信息(例如，增加新的路由，或撤销过时的路由，以及报告出错的情况等)</li>
<li>使用TCP链接交换路由信息的两个BGP发言人，彼此称为对方的邻站或对等站</li>
</ul>
</li>
<li>BGP发言人除了运行BGP外，还必须运行自己锁在自治系统所使用的内部网关协议IGP，例如OSPF或RIP</li>
<li>BGP发言人交换网络可达性的信息(要到达某个网络所要经过的一系列自治系统)</li>
<li>当BGP发言人互相交换了网络可达性的信息后，各BGP发言人就根据所采用的策略从收到的路由信息中找出到达各自治系统的较好的路由。也就是构造出树形结构、不存在回路的自治系统连通图</li>
<li>BGP适用于多级结构的因特网
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-27%2020.53.03.png" alt=""></li>
<li>BGP版本4中规定的四种报文
<ul>
<li>OPEN打开报文：用来与相邻的另一个BGP发言人建立关系，使通信初始化</li>
<li>UPDATE更新报文：用来通告某一路由的信息，以及列出要撤销的多条路由</li>
<li>KEEPALIVE保活报文：用来周期性的证明邻站的相通性</li>
<li>NOTIFICATION通知报文：用来发送检测到的差错</li>
</ul>
</li>
<li>例
<ul>
<li>直接封装RIP, OSPF, BGP报文的协议分别是：UDP, IP, TCP
<img src="/images/%E6%88%AA%E5%B1%8F2024-04-27%2020.59.11.png" alt=""></li>
</ul>
</li>
</ul>
<h2 id="47-ipv4数据报的首部格式">4.7 IPv4数据报的首部格式</h2>
<p><img src="/images/%E6%88%AA%E5%B1%8F2024-05-02%2011.22.27.png" alt="IP数据报首部格式"></p>
<ul>
<li>版本
<ul>
<li>4bit，用来表示IP协议的版本</li>
<li>通信双方使用的IP协议版本必须一致，目前广泛使用的版本号为4，即IPv4</li>
</ul>
</li>
<li>首部长度
<ul>
<li>4bit，用来表示IP数据报首部长度。该字段的取值以4字节为单位</li>
<li>最小十进制取值为5，表示IP数据报首部只有20字节固定部分</li>
<li>最大十进制取值为15，表示IP数据报首部包含20字节固定部分和最大40字节可变部分</li>
</ul>
</li>
<li>可选字段
<ul>
<li>长度从1字节到40字节不等。用来支持排错、测量及安全等措施</li>
<li>可选字段增加了IP数据报的功能，但这同时也使得IP数据报的首部长度成为可变的。这就增加了每一个路由器处理IP数据报的开销。实际上可选字段很少被使用</li>
</ul>
</li>
<li>填充字段
<ul>
<li>用来确保首部长度为4字节的整数倍，使用全0来进行填充</li>
</ul>
</li>
<li>区分服务字段
<ul>
<li>占8bit，用来获得更好的服务</li>
<li>该字段在旧标准中叫做服务类型，但实际上一直没有被使用过</li>
<li>1998年，因特网工程任务组IETF把这个字段改名为区分服务</li>
<li>利用该字段的不同数值可以提供不同等级的服务质量</li>
<li>只有在使用区分服务时，该字段才起作用。一般情况下都不使用该字段</li>
</ul>
</li>
<li>总长度字段
<ul>
<li>占16bit，用来表示IP数据报的总长度(首部+数据载荷)</li>
<li>最大取值为十进制的65535，以字节为单位
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-02%2011.34.58.png" alt=""></li>
</ul>
</li>
<li>标识、标志、片偏移
<ul>
<li>这三个字段共同用于IP数据报分片
<ul>
<li>IPv4数据报
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-03%2009.25.30.png" alt="IPv4数据报"></li>
</ul>
</li>
<li>标识
<ul>
<li>占16比特，属于同一个数据报的各分片数据报因该具有相同的标识</li>
<li>IP软件维持一个计数器，每产生一个数据报，计数器值加1，并将此值赋给标识字段</li>
</ul>
</li>
<li>标志
<ul>
<li>占3bit
<ul>
<li>DF位：1表示不允许分片；0表示允许分片</li>
<li>MF位：1表示“后面还有分片”；0表示“这是最后一个分片”</li>
<li>保留位：必须设置为0</li>
</ul>
</li>
</ul>
</li>
<li>片偏移
<ul>
<li>占13bit，指出分片数据报的数据载荷部分偏移其在原数据报的位置有多少个单位</li>
<li>片偏移以8个字节为单位</li>
<li>片偏移量必须是整数
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-03%2010.05.59.png" alt="例">
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-03%2010.08.30.png" alt="例"></li>
</ul>
</li>
</ul>
</li>
<li>生存时间TTL
<ul>
<li>占8bit，最初以秒为单位，最大生存周期为255秒</li>
<li>路由器转发IP数据报时，将IP数据报首部中的该字段的值减去IP数据报在本路由器上所耗费的时间，若不为0就转发，否则就丢弃</li>
<li>现在以“跳数”为单位，路由器转发IP数据报时，将IP数据报首部中的该字段的值减1，若不为0就转发，否则就丢弃</li>
<li>作用
<ul>
<li>防止IP数据报在网络中永久兜圈</li>
</ul>
</li>
</ul>
</li>
<li>协议
<ul>
<li>占8bit，指明IPv4数据报的数据部分是何种协议数据单元
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-03%2010.16.35.png" alt="协议"></li>
</ul>
</li>
<li>首部检验和
<ul>
<li>占16bit，用来检测首部在传输过程中是否出现差错</li>
<li>比CRC检验码简单，称为因特网校验和</li>
<li>IP数据报每经过一个路由器，路由器都要重新计算首部检验和，因为某些字段(生存时间、标志、片偏移等)的取值可能发生变化</li>
<li>由于IP层本身并不提供可靠传输服务，并且计算首部校验和是一项耗时的操作，因此在IPv6中，路由器不再计算首部校验和，从而更快转发IP数据报</li>
</ul>
</li>
<li>源IP地址和目的IP地址
<ul>
<li>各占32bit，用来填写发送该IP数据报的源主机的IP地址和接收该IP数据报的目的主机的IP地址
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-03%2010.25.55.png" alt="例">
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-03%2010.30.51.png" alt="例">
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-03%2010.32.56.png" alt="例">
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-03%2010.34.17.png" alt="例"></li>
</ul>
</li>
</ul>
<h2 id="48-网际控制报文协议icmp">4.8 网际控制报文协议ICMP</h2>
<ul>
<li>为了更有效的转发IP数据报和提高交付成功的机会，在网际层使用了网际控制报文协议ICMP(Internet Control Message Protocol)</li>
<li>主机或路由器使用ICMP来发送差错报告报文和询问报文</li>
<li>ICMP报文被封装在IP数据报中</li>
<li>ICMP差错报告报文主要由以下五种
<ul>
<li>终点不可达
<ul>
<li>当路由器或主机不能交付数据报时，就向源点发送不可达报文</li>
<li>具体可再根据ICMP的代码字段细分为
<ul>
<li>目的网路不可达</li>
<li>目的主机不可达</li>
<li>目的协议不可达</li>
<li>目的端口不可达</li>
<li>目的网络未知</li>
<li>目的主机未知等13种错误</li>
</ul>
</li>
</ul>
</li>
<li>源点抑制
<ul>
<li>当路由器或主机由于拥塞而丢弃数据报时，就向源点发送源点抑制报文，使原点知道应当把数据报的发送速率放慢</li>
</ul>
</li>
<li>时间超过
<ul>
<li>当路由器收到一个目的IP地址不是自己的IP数据报，会将其生存时间TTL字段的值减1</li>
<li>(减1后再进行判断)若结果不为0，则将该IP数据报转发出去</li>
<li>若结果为0，除丢弃该IP数据报外，还要向源点发送时间超过报文</li>
<li>另外，当终点在预先规定的时间内不能收到一个数据报的全部数据报片时，就把已收到的数据报片都丢弃，也会向源点发送时间超过报文</li>
</ul>
</li>
<li>参数问题
<ul>
<li>当路由器或目的主机收到IP数据报后，根据首部中的检验和字段发现首部在传输过程中出现了误码，就丢弃该数据报，并向源点发送参数问题报文</li>
</ul>
</li>
<li>改变路由(重定向)
<ul>
<li>路由器把改变路由报文发送给主机，让主机知道下次应将数据报发送给另外的路由器(可通过更好的路由)</li>
</ul>
</li>
</ul>
</li>
<li>以下情况不应发送ICMP差错报告报文
<ul>
<li>对ICMP差错报告不再发送ICMP差错报告报文</li>
<li>对第一个分片的数据报片的后续所有数据报片都不发送ICMP差错报告报文</li>
<li>对具有多播地址的数据报都不发送ICMP差错报告报文</li>
<li>对具有特殊地址(如127.0.0.0或0.0.0.0)的数据报不发送ICMP差错报告报文</li>
</ul>
</li>
<li>常用的ICMP询问报文有以下两种
<ul>
<li>回送请求和回答
<ul>
<li>ICMP回送请求报文是由主机或路由器向一个特定的目的主机发出的询问</li>
<li>收到此报文的主机必须给源主机或路由器发送ICMP回送回答报文</li>
<li>这种询问报文用来测试目的站是否可达以及了解其有关状态</li>
</ul>
</li>
<li>时间戳请求和回答
<ul>
<li>ICMP时间戳请求报文是请某个主机或路由器回答当前的日期和时间</li>
<li>在ICMP时间戳回答报文中有一个32位的字段，其实写入的整数代表从1900年1月1日起到当前时刻一共有多少秒</li>
<li>这种询问报文用来进行时钟同步和测量时间</li>
</ul>
</li>
</ul>
</li>
<li>ICMP应用举例
<ul>
<li>分组网间探测PING(Packet InterNet Groper)
<ul>
<li>用来测试主机或路由器间的连通性</li>
<li>应用层直接使用网际层的ICMP(没有通过运输层的TCP或UDP)</li>
<li>使用ICMP回送请求和回答报文</li>
</ul>
</li>
<li>跟踪路由(traceroute)
<ul>
<li>用来测试IP数据报从源主机到达目的主机要经过哪些路由器</li>
<li>Windows版本
<ul>
<li>tracert命令</li>
<li>应用层直接使用网际层ICMP</li>
<li>使用了ICMP回送请求和回答报文以及差错报告报文</li>
<li>实现原理
<ul>
<li>TTL设置为1-&gt;差错报告(时间超过)-&gt;知道第一个路由器</li>
<li>TTL设置为2-&gt;知道第二个路由器</li>
<li>-&gt;依次增加</li>
<li>ICMP会送请求报文的回答报文</li>
</ul>
</li>
</ul>
</li>
<li>Unix版本
<ul>
<li>traceroute命令</li>
<li>在运输层使用UDP协议</li>
<li>仅使用ICMP差错报告报文</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="49-虚拟专用网vpn与网络地址转换nat">4.9 虚拟专用网VPN与网络地址转换NAT</h2>
<ul>
<li>虚拟专用网VPN(Virtual Private Network)
<ul>
<li>利用公用的因特网作为本机构各专用网之间的通信载体，这样的专用网又称为虚拟专用网</li>
<li>由于IPv4地址的紧缺，一个机构能够申请到的IPv4地址数量往往远小于本机构所拥有的主机数量</li>
<li>因此，虚拟专用网中的各主机所分配的地址应该是本机构可自由分配的专用地址，而不是需要申请的、在因特网上使用的公有地址</li>
<li>专用(私有)地址
<ul>
<li>10.0.0.0~10.255.255.255(10/8地址块)</li>
<li>172.16.0.0~172.31.255.255(172.16/12地址块)</li>
<li>192.168.0.0~192.168.255.255(192.168/16地址块)</li>
<li>私有地址只能用于一个机构的内部通信，而不能用于和因特网上的主机通信</li>
<li>私有地址只能用作本地地址，而不能用作全球地址</li>
<li>在因特网中的所有路由器，对目的地址是私有地址的IP数据包一律不进行转发</li>
<li>只有各自的专用网，才能利用因特网进行通信</li>
</ul>
</li>
<li>也被称为IP隧道技术</li>
<li>同一机构内不同部门的内部网络所构成的虚拟专用网VPN又称为内联网VPN</li>
<li>又是一个机构的VPN需要有某些外部机构(通常就是合作伙伴参加进来，这样的VPN就称为外联网VPN)</li>
<li>在外地工作的员工需要访问公司内部的专用网络时，只要在任何地点接入到因特网，运行驻留在员工PC中的VPN软件，在员工的PC和公司的主机之间建立VPN隧道，即可访问专用网络中的资源。这种VPN称为远程接入VPN</li>
</ul>
</li>
<li>网络地址转换NAT(Network Address Translation)
<ul>
<li>虽然因特网采用了无分类编址方式来缓解IPv4地址空间耗尽的速度，但由于因特网用户数目的激增，特别是大量小型办公室网络和家庭网络接入因特网的需求不断增加，IPv4地址空间即将面临耗尽的危险仍然没有被解除</li>
<li>1994年提出了一种网络地址转换NAT的方法再次缓解了IPv4地址空间即将耗尽的问题</li>
<li>NAT能使大量使用内部专用地址的专用网络用户共享少量外部全球地址来访问因特网上的主机资源
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-21%2019.13.38.png" alt=""></li>
<li>该转换方法存在一个问题
<ul>
<li>如果NAT路由器具有N个全球IP地址，那么至多只能有N个内网主机能够同时和因特网上的主机通信</li>
</ul>
</li>
<li>由于绝大多数的网络应用都是使用运输层协议TCP或UDP来传送数据，因此可以利用运输层的端口号和IP地址一起进行转换</li>
<li>这样，用一个全球IP地址就可以使多个拥有本地地址的主机同时和因特网上的主机进行通信。这种将端口号和IP地址一起进行转换的技术叫作网络地址与端口号转换NAPT(Network Address and Port Translation)
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-21%2019.19.26.png" alt=""></li>
<li>外网主机不可以首先发起通信</li>
<li>使用私有地址的主机不能直接充当因特网服务器</li>
<li>对于一些P2P网络应用，需要外网主机主动与内网主机进行通信，在通过NAT时会遇到问题，需要网络应用自己使用一些特殊的NAT穿越技术来解决问题</li>
<li>由于NAT对外网屏蔽了内网主机的网络地址，能为内网的主机提供一定的安全保护</li>
</ul>
</li>
</ul>
<h1 id="p5-运输层">P5 运输层</h1>
<h2 id="51-运输层概述">5.1 运输层概述</h2>
<ul>
<li>物理层、数据链路层、网络层共同解决了将主机通过异构网络互联起来所面临的问题，实现了主机到主机的通信</li>
<li>实际上在计算机网络中进行通信的真正实体是位于通信两端主机中的进程</li>
<li>如何为运行在不同主机上的应用进程提供直接的通信服务是运输层的任务，运输层协议又称为端到端协议</li>
<li>运输层直接为应用进程间的逻辑通信提供服务
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-21%2019.31.06.png" alt="">
<ul>
<li>运输层向高层用户屏蔽了下面网络核心的细节(如网络拓扑、所采用的路由选择协议等)，它使应用进程看见的就好像是两个运输层实体之间有一条端到端的逻辑通信信道</li>
<li>根据应用需求的不同，因特网的运输层为应用层提供了两种不同的运输协议，即面向连接的TCP和无连接的UDP，这两种协议就是本章要讨论的主要内容</li>
</ul>
</li>
</ul>
<h2 id="52-运输层端口号复用与分用的概念">5.2 运输层端口号、复用与分用的概念</h2>
<ul>
<li>运行在计算机上的进程使用进程标识符PID来标识</li>
<li>因特网上的计算机并不是使用统一的操作系统，不同的操作系统又使用不同格式的进程标识符</li>
<li>为了使运行不同操作系统的计算机的应用进程之间能够进行网络通信，就必须使用统一的方法对TCP/IP体系的应用进程进行标识</li>
<li>TCP/IP体系的运输层使用端口号来区分应用层的不同进程
<ul>
<li>端口号用16bit表示，取值范围0～65535
<ul>
<li>熟知端口号：0～1023，IANA把这些端口号指派给了TCP/IP体系中最重要的一些应用协议，例如: FTP使用21/20，HTTP使用80，DNS使用53</li>
<li>登记端口号：1024～49152，为没有熟知端口号的应用程序使用。使用这类端口号必须在IANA按照规定的手续登记，以防止重复。例如：Microsoft RDP微软远程桌面使用的端口是3389</li>
<li>短暂端口号：49152～65535，留给用户进程选择暂时使用。当服务器进程收到客户进程的报文时，就知道了客户进程所使用的动态端口号。通信结束后，这个端口号可供其他客户进程以后使用</li>
</ul>
</li>
<li>端口号只具有本地意义，即端口号只是为了标识本计算机应用层中的各进程，在因特网中，不同计算机中的相同端口号是没有联系的。</li>
<li>发送方的复用和接收方的分用
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-22%2016.35.02.png" alt=""></li>
</ul>
</li>
<li>TCP/IP体系的应用层常用协议所使用的运输层熟知端口号
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-22%2016.37.15.png" alt=""></li>
<li>举例
<ul>
<li>输入url后，给DNS服务器发送请求报文
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-22%2016.42.40.png" alt=""></li>
<li>DNS服务器给用户PC发回响应
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-22%2016.47.04.png" alt=""></li>
<li>用户PC中的HTTP客户端进程可以向Web服务器发送HTTP请求报文
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-22%2016.50.41.png" alt=""></li>
<li>Web服务器接收报文，交付给HTTP服务端，HTTP服务端解析HTTP请求报文，并发回HTTP响应
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-22%2016.53.19.png" alt=""></li>
<li>用户PC接收报文，交付给用户PC中的HTTP客户端进程
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-22%2016.55.40.png" alt=""></li>
</ul>
</li>
</ul>
<h2 id="53-udp和tcp的对比">5.3 UDP和TCP的对比</h2>
<ul>
<li>UDP和TCP是TCP/IP体系结构运输层中的两个重要协议</li>
<li>在使用TCP/IP体系结构的网络通信中，这两个协议的使用频率仅次于网络层的IP协议</li>
<li>UDP用户数据报协议(User Datagram Protocol)
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-23%2015.17.14.png" alt="">
<ul>
<li>使用UDP协议进行通信的四台主机</li>
<li>任何一台主机都可向其他三台主机发送广播</li>
<li>也可以向某个多播组发送多播</li>
<li>还可以向某台主机发送单播</li>
<li>支持一对一、一对多以及一堆全的通信</li>
<li>UDP面向报文
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-23%2015.25.12.png" alt=""></li>
<li>适用于IP电话、视频会议等实时应用</li>
<li>UDP向上层提供无连接不可靠的服务
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-23%2015.29.52.png" alt=""></li>
<li>UDP用户数据报首部仅8字节
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-23%2015.33.24.png" alt=""></li>
</ul>
</li>
<li>TCP传输控制协议(Transmission Control Protocol)
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-23%2015.17.57.png" alt="">
<ul>
<li>使用TCP协议的通信双方，在进行数据传输之前，必须使用三报文握手建立连接</li>
<li>建立连接后，基于TCP连接的可靠信道进行通信</li>
<li>仅支持单播</li>
<li>TCP是面向字节流的
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-23%2015.25.27.png" alt=""></li>
<li>适用于要求可靠传输的应用，例如文件传输</li>
<li>TCP向上层提供面向连接的可靠传输服务
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-23%2015.30.01.png" alt=""></li>
<li>TCP报文段首部最小20字节，最大60字节
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-23%2015.34.12.png" alt=""></li>
</ul>
</li>
</ul>
<h2 id="54-tcp的流量控制">5.4 TCP的流量控制</h2>
<ul>
<li>一般来说，我们希望数据传输的更快一些
<ul>
<li>但如果发送方把数据发送得过快，接收方就可能来不及接受，这就会造成数据的丢失</li>
</ul>
</li>
<li>流量控制就是让发送方发送速率不要太快，要让接收方来得及接受</li>
<li>利用滑动窗口机制可以很方便地在TCP连接上实现对发送方的流量控制
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-23%2015.50.11.png" alt="">
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-23%2015.54.55.png" alt="">
<ul>
<li>零窗口探测报文会设置重传定时器</li>
</ul>
</li>
</ul>
<h2 id="55-tcp的拥塞控制">5.5 TCP的拥塞控制</h2>
<ul>
<li>在某段时间，若对网络中某一资源的需求超过了该资源所能提供的可用部分，网络性能就要变坏。这种情况就叫做拥塞
<ul>
<li>在计算机网络中的链路容量(即带宽)、交换节点中的缓存和处理机等，都是网络的资源</li>
</ul>
</li>
<li>若出现拥塞而不进行控制，整个网络的吞吐量将随输入负荷的增大而下降
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-24%2016.13.02.png" alt=""></li>
<li>TCP的四种拥塞控制算法
<ul>
<li>慢开始slow-start</li>
<li>拥塞避免congestion avoidance</li>
<li>快重传fast retransmit</li>
<li>快恢复fast recovery</li>
<li>假定条件
<ul>
<li>数据单方向传送，另一个方向只传送确认
<ul>
<li>发送方维护一个叫做拥塞窗口cwnd的状态变量，其值取决于网络的拥塞程度，并且动态变化
<ul>
<li>拥塞窗口cwnd的维护原则：只要网络没有出现拥塞，拥塞窗口就再增大一些；但只要网络出现拥塞，拥塞窗口就减小一些</li>
<li>判断出现网络拥塞的依据：没有按时收到应当到达的确认报文(即发生超时重传)</li>
</ul>
</li>
<li>发送方将拥塞窗口作为发送窗口swnd，即swnd=cwnd</li>
<li>维护一个慢开始门限ssthresh状态变量
<ul>
<li>当cwnd &lt; ssthresh时，使用慢开始算法</li>
<li>当cwnd &gt; ssthresh时，停止使用慢开始算法而改用拥塞避免算法</li>
<li>当cwnd = ssthresh时，既可使用慢开始算法，也可使用拥塞避免算法</li>
</ul>
</li>
</ul>
</li>
<li>接收方总是有足够大的缓存空间，因为发送方发送窗口的大小由网络的拥塞程度来决定</li>
<li>以最大报文段MSS的个数为讨论问题的单位，而不是以字节为单位</li>
</ul>
</li>
</ul>
</li>
<li>慢开始算法与拥塞避免算法
<ul>
<li>工作流程
<ul>
<li>传输轮次：发送方给接收方发送数据报文段后，接收方给发送方发回相应的确认报文段；一个传输轮次所经历的时间就是往返时间(并非恒定的数值)</li>
<li>cwnd拥塞窗口，会随网络拥塞程度以及所使用的拥塞控制算法动态变化</li>
<li>在TCP双方建立动态逻辑关系时，拥塞窗口的值设置为1，使用<strong>慢开始算法</strong></li>
<li>慢开始门限值ssthresh=16</li>
<li>发送方每收到一个对新报文段的确认报文时，就把拥塞窗口值加1，然后开始下一轮传输</li>
<li>当拥塞窗口值增长到慢开始门限值时，就改为执行拥塞避免算法，由于发送方当前的拥塞窗口值是1，发送窗口值等于拥塞窗口值，发送方当前只能发送一个TCP数据报文段</li>
<li>发送方发送数据报文段0，接收方发送对报文段0的确认</li>
<li>发送方收到对报文段0的确认后，将cwnd的值加1，发送方发送1～2号共两个数据报文段，接收方收到后，给发送方发回对1～2号报文段的确认报文段</li>
<li>发送方收到1、2的确认报文段后，将cwnd的值+2增大到4，发送方发送3～6号共4个数据报文段，接收方收到后，给发送方发回对3～6号报文段的确认报文段</li>
<li>发送方收到对报文段3～6的确认报文段后，将cwnd的值加4，增大到8，发送方发送7～14号共8个数据报文段，接收方收到后，给发送方发挥对7～14号报文段的确认报文段</li>
<li>发送方收到对7～14号确认报文段的确认后，将cwnd的值加8，增大到16</li>
<li>发送方的cwnd已经增大到慢开始门限值，改用<strong>拥塞避免算法</strong>，每个传输轮次结束后，拥塞窗口值只能线性加1</li>
<li>发送方发送15～30号共16个报文段，接收方收到后，对发送方发送15～36报文段的确认</li>
<li>发送方收到15～36报文段的确认报文段后，将拥塞窗口值+1增大到17</li>
<li>发送方发送31～47号共17个数据报文段，接收方收到后，对发送方发送31～47号报文的确认</li>
<li>发送方收到后，将拥cwnd+1，增大到18</li>
<li>&hellip;</li>
<li>发送方发送171～194号共24个数据报文段，在传输过程中丢失了几个</li>
<li>发生超时重传，发送方以此判断网络可能出现了拥塞，进行以下工作
<ul>
<li>将ssthresh值更新为发生拥塞时cwnd值的<strong>一半</strong>，即12</li>
<li>将cwnd值减小为1，并重新开始执行慢开始算法</li>
</ul>
</li>
<li>重复流程</li>
</ul>
</li>
<li>&ldquo;慢开始&quot;是指一开始向网络注入的报文段少，并不是指拥塞窗口cwnd增长速度慢</li>
<li>&ldquo;拥塞避免&quot;并非指完全能够避免拥塞，而是指在拥塞避免阶段将拥塞窗口控制为按线性规律增长，使网络比较不容易出现拥塞</li>
<li>慢开始和拥塞避免算法是1988年提出的TCP拥塞控制算法(TCP Tahoe版本)</li>
<li>1990年又增加了两个新的拥塞控制算法(改进TCP的性能)，这就是快重传和快恢复(TCP Teno版本)
<ul>
<li>有时，个别报文段会在网络中丢失，但实际上网络并未发生拥塞
<ul>
<li>这将导致发送方超时重传，并误认为网络发生了拥塞</li>
<li>发送方把拥塞窗口的cwnd又设置为最小值1，并错误地启动慢开始算法，因而降低了传输效率</li>
</ul>
</li>
<li>采用快重传算法可以让发送方尽早知道发生了个别报文段的丢失</li>
</ul>
</li>
</ul>
</li>
<li>所谓<strong>快重传</strong>，就是使发送方尽快进行重传，而不是等超时计时器超时再重传
<ul>
<li>要求接收方不要等待自己发送数据时才进行捎带确认，而是要立即发送确认</li>
<li>即使收到了失序的报文段也要立即发出对已收到的报文段的重复确认</li>
<li>发送方一旦收到三个连续的重复确认，就将相应的报文段立即重传，而不是等该报文段的超市重传计时器超时再重传</li>
<li>对于个别丢失的报文段，发送方不会出现超市重传，也就不会误认为出现了拥塞(进而降低拥塞窗口cwnd为1)。使用快重传可以使整个网络的吞吐量提高约20%
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-24%2017.05.24.png" alt=""></li>
</ul>
</li>
<li><strong>快恢复</strong>算法
<ul>
<li>发送方一旦收到三个重复确认，就知道现在只是丢失了个别的报文段。于是不启动慢开始算法，而执行快恢复算法</li>
<li>发送方将慢开始门限值ssthresh值和拥塞窗口cwnd值调整为当前窗口的一半；开始执行拥塞避免算法</li>
<li>也有的快恢复实现是把快恢复开始时的拥塞窗口cwnd值再增大一些，即等于新的ssthresh+3
<ul>
<li>既然发送方收到3个重复的确认，就表明有3个数据报文段离开了网络</li>
<li>这3个报文段不再消耗网络资源而停留在接收方的接受缓存中</li>
<li>可见现在网络中不是堆积了报文段而是减少了3个报文段，因此可以适当把拥塞窗口扩大
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-24%2017.12.31.png" alt=""></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="56-tcp超时重传时间的选择">5.6 TCP超时重传时间的选择</h2>
<ul>
<li>超时重传时间的选择是TCP最复杂的问题之一</li>
<li>超时重传时间RTO应略大于往返时间RTT
<ul>
<li>不能直接使用某次测量得到的RTT样本来计算超时重传时间RTO</li>
<li>利用每次测量得到的RTT样本，计算加权平均往返时间RTTs(又称为平滑的往返时间)</li>
<li>RTT<sub>S1</sub> = RTT<sub>1</sub></li>
<li>新的RTT<sub>S</sub> = (1 - α)<em>旧的RTT<sub>S</sub> + α</em>新的RTT样本</li>
<li>0≤α&lt;1
<ul>
<li>若α很接近于0，则新RTT样本对RTTs的影响不大</li>
<li>若α很接近于1，则新RTT样本对RTTs的影响较大</li>
<li>已成为建议标准的RFC6298推荐的α值为1/8，即0.125</li>
</ul>
</li>
<li>用这种方法得出的加权平均往返RTTs就比测量出的RTT值更加平滑</li>
<li>超市重传时间RTO的值应略大于加权平均往返时间RTTs</li>
</ul>
</li>
<li>RFC6298建议使用下式计算超时重传时间RTO
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-24%2018.29.23.png" alt=""></li>
<li>往返时间RTT的测量比较复杂
<ul>
<li>无法确定确认报文段是对原报文段的确认还是重传报文段的确认</li>
<li>针对出现超时重传时无法测准往返时间RTT的问题，Karn提出了一个算法
<ul>
<li>在计算加权平均往返时间RTTs时，只要报文段重传了，就不采用其往返时间RTT样本。也就是出现重传时，不重新计算RTTs，进而超时重传时间RTO也不会重新计算</li>
<li>这又引起了新的问题：若报文段的时延突然增大了很多，并且之后很长一段时间都会保持这种时延。因此在原来得出的重传时间内，不会收到确认报文段。于是重传。根据Karn算法，重传时间无法更新。这会导致报文段反复被重传</li>
</ul>
</li>
<li>因此，要对Karn算法进行修正
<ul>
<li>报文段每重传一次，就把超时重传时间RTO增大一些。典型的做法是将新RTO的值取为旧RTO值的两倍
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-24%2018.41.04.png" alt=""></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="57-tcp可靠传输的实现">5.7 TCP可靠传输的实现</h2>
<ul>
<li>TCP基于以字节为单位的滑动窗口来实现可靠传输</li>
<li>接收方向发送方发送消息，描述rwnd和ack，发送方根据消息确认发送窗口大小和位置
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-24%2018.52.42.png" alt="">
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-24%2018.55.04.png" alt=""></li>
<li>补充说明
<ul>
<li>虽然发送方的发送窗口是根据接收方的接受窗口设置的，但在同一时刻，发送方的发送窗口并不总是和接收方的接受窗口一样大
<ul>
<li>网络传送窗口值需要经历一定的时间滞后，并且这个时间还是不确定的</li>
<li>发送方还可能根据网络当时的拥塞情况适当减小自己的发送窗口尺寸</li>
</ul>
</li>
<li>对于不按序到达的数据应如何处理，TCP并无明确规定
<ul>
<li>如果接收方把不按序到达的数据一律丢弃，那么接收窗口的管理将会比较简单，但这样做对网络资源的利用不利，因为发送方会重复传送较多的数据</li>
<li>TCP通常对不按序到达的数据是先临时存放在接受窗口中，等到字节流中所缺少的字节收到后，再按序交付上层的应用进程</li>
</ul>
</li>
<li>TCP要求接收方必须有累积确认和捎带确认机制，这样可以减小传输开销。接收方可以在合适的时候发送确认，也可以在自己有数据要发送时把确认信息顺便捎带上
<ul>
<li>接收方不应过分推迟发送确认，否则会导致发送方不必要的超时重传，这反而浪费了网络的资源
<ul>
<li>TCP标准规定，确认推迟的时间不应超过0.5秒。若收到一连串具有最大长度的报文段，则必须每隔一呃报文段就发送一个确认[RFC 1122]</li>
</ul>
</li>
<li>捎带确认实际上并不经常发生，因为大多数应用程序很少同时在两个方向上发送数据</li>
</ul>
</li>
<li>TCP通信是全双工通信。通信中的每一方都在发送和接收报文段。因此，每一方都有自己的发送窗口和接收窗口。在谈到这些窗口是，一定要弄清楚是哪一方的窗口</li>
</ul>
</li>
</ul>
<h2 id="58-tcp的运输连接管理">5.8 TCP的运输连接管理</h2>
<h3 id="581-tcp连接的建立">5.8.1 TCP连接的建立</h3>
<ul>
<li>TCP是面向连接的协议，它基于运输连接来传送TCP报文段</li>
<li>TCP运输连接的建立和释放是每一次面向连接的通信中必不可少的过程</li>
<li>TCP运输连接有以下三个阶段
<ul>
<li>建立TCP连接 三报文握手</li>
<li>数据传送</li>
<li>释放TCP连接 四报文挥手</li>
</ul>
</li>
<li>TCP的运输连接管理就是使运输连接的建立和释放都能正常地进行
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-24%2019.45.19.png" alt=""></li>
<li>TCP的连接建立要解决以下三个问题
<ul>
<li>使TCP双方能够确知对方的存在</li>
<li>使TCP双方能够协商一些参数(如最大窗口值、是否使用窗口扩大选项和时间戳选项以及服务质量等)</li>
<li>使TCP双方能够对运输实体资源(如缓存大小、连接表中的项目等)进行分配</li>
</ul>
</li>
<li>TCP使用&quot;三报文握手&quot;建立连接
<ul>
<li>CLOSED-CLOSED</li>
<li>server建立传输控制块
<ul>
<li>TCP连接表</li>
<li>指向发送和接收缓存的指针</li>
<li>指向重传队列的指针</li>
<li>当前的发送和接收序号</li>
<li>&hellip;</li>
</ul>
</li>
<li>TCP服务器进入监听状态LISTEN，被动等待来自TCP客户端进程的连接请求，而不是主动发起-&gt;被动打开连接</li>
<li>client建立传输控制块
<ul>
<li>指向发送和接收缓存的指针</li>
<li>指向重传队列的指针</li>
<li>当前的发送和接收序号</li>
<li>&hellip;</li>
</ul>
</li>
<li>client向server发送TCP连接请求，并进入同步已发送状态-&gt;主动打开连接
<ul>
<li>TCP连接请求报文段首部中的同步位SYN被设置为1，表明这是一个TCP连接请求报文段</li>
<li>序号字段seq被设置了一个初始值x，作为TCP客户进程所选择的初始序号</li>
<li>TCP规定SYN被设置为1的报文段不能携带数据，但要消耗掉一个序号</li>
</ul>
</li>
<li>server发送针对TCP连接请求的确认，并进入同步已接收状态
<ul>
<li>SYN=1, ACK=1 表明这是一个TCP连接请求设置报文段</li>
<li>seq=y TCP服务进程所选择的初始序号</li>
<li>ack=x+1 对TCP客户进程所选择的初始序号的确认，这个报文段也不能携带数据，但同样要消耗掉一个序号</li>
</ul>
</li>
<li>client收到server发送的确认报文后，继续发送针对TCP连接请求的确认的确认，并进入连接已建立状态
<ul>
<li>ACK=1 普通的TCP确认报文段</li>
<li>seq=x+1 TCP客户进程发送的第一个TCP报文段的序号为x，并且不携带数据</li>
<li>TCP规定普通的TCP确认报文段可以携带数据，但如果不携带数据，则不消耗序号；在这种情况下，所发送的下一个数据报文段的序号仍是x+1</li>
<li>ack=y+1，是对server所选择的书序序号的确认</li>
</ul>
</li>
<li>server收到该确认报文段后也进入连接已建立状态</li>
<li>基于已经建好的连接进行可靠的数据传输
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-24%2020.02.49.png" alt=""></li>
<li>思考：能否使用两报文握手建立连接？
<ul>
<li>不能
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-24%2020.07.09.png" alt=""></li>
<li>三报文握手是为了防止已失效的连接请求报文段突然又传送到了TCP服务器，因而导致错误</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="582-tcp的连接释放">5.8.2 TCP的连接释放</h3>
<ul>
<li>TCP通过&quot;四报文挥手&quot;来释放连接
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-24%2020.53.50.png" alt="">
<ul>
<li>server和client都可以释放连接，都处于<strong>连接已建立</strong>状态</li>
<li>client的应用进程通知其<strong>主动关闭TCP连接</strong>，发送TCP连接释放报文段，并进入<strong>终止等待1</strong>状态
<ul>
<li>该报文段首部中的终止位FIN=1，确认位ACK=1，表明这是一个TCP连接释放报文段，同时也对之前收到的报文段进行确认</li>
<li>序号seq字段的值设置为u=TCP客户进程之前已传送过的、数据的最后一个字节的序号+1</li>
<li>TCP规定终止位FIN=1的报文段即使不携带数据，也要消耗掉一个序号</li>
<li>ack=v =TCP客户端进程之前已收到的数据的最后一个字节的序号+1</li>
</ul>
</li>
<li>server进程收到TCP连接释放报文段后，会发送一个普通的TCP确认报文段并进入<strong>关闭等待状态</strong>
<ul>
<li>ACK=1</li>
<li>seq=v =TCP服务端进程之前已传送过的数据的最后一个字节的序号加1，这也与之前收到的TCP连接释放报文段中的确认号匹配</li>
<li>确认号ack字段的值设置为u+1，这是对TCP连接释放报文段的确认</li>
</ul>
</li>
<li>server通知高层应用进程，TCP客户端要断开与自己的TCP连接-&gt;从TCP客户进程到TCP服务器进程这个方向的连接就释放了，这时的TCP连接属于半关闭状态
<ul>
<li>TCP 客户进程已经没有数据要发送了，但TCP服务器进程发送的数据客户端仍要接收，也就是说，从TCP服务器进程到TCP客户进程这个方向的连接并未关闭，这个状态可能会持续一段时间</li>
</ul>
</li>
<li>client收到server发送的普通的TCP确认报文段之后，进入<strong>终止等待2</strong>状态，等待TCP服务器进程发出的TCP连接释放报文段</li>
<li>若使用TCP服务器进程的应用程序已经没有数据要发送了，应用进程就通知其TCP服务进程释放连接；由于TCP连接释放是由TCP客户进程主动发起的，因此TCP服务器进程对TCP连接的释放称为<strong>被动关闭连接</strong></li>
<li>TCP服务器进程发送TCP连接释放报文段并进入<strong>最后确认状态</strong>
<ul>
<li>终止位FIN=1，确认位ACK=1，表明这是一个TCP连接释放报文段，同时也对之前收到的报文段进行确认</li>
<li>假定序号seq的字段的值为w，因为在半关闭状态下TCPserver可能又发送了一些数据</li>
<li>ack=u+1，对之前收到的TCP连接释放报文段的重复确认</li>
</ul>
</li>
<li>TCP客户进程收到TCP连接释放报文段后，必须针对该报文段发送普通的TCP确认报文段，之后进入<strong>时间等待状态</strong>
<ul>
<li>ACK=1，表明这是一个普通的tcp确认报文段</li>
<li>seq=u+1，因为TCP客户端进程之前发送的TCP连接释放报文段虽然不携带数据，但要消耗掉一个序号</li>
<li>ack=w+1，对所收到的TCP连接释放报文段的确认</li>
</ul>
</li>
<li>TCP服务器进程收到该报文段后就进入<strong>关闭状态</strong>，而TCP客户进程还要经过2MSL后才能进入<strong>关闭状态</strong>
<ul>
<li>MSL最长报文段寿命，RFC793建议为2min</li>
<li>TCP允许不同的实现可根据具体情况使用更小的MSL值</li>
<li>思考：为什么TCP客户端进程不直接进入关闭状态？
<ul>
<li>接收TCP服务器进程的超时重传
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-24%2020.52.29.png" alt=""></li>
<li>确保TCP服务器进程可以收到最后一个TCP确认报文段而进入关闭状态</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>TCP中保活计时器的作用
<ul>
<li>建立连接后TCP客户进程的主机出现故障-&gt;TCP服务进程收不到数据</li>
<li>使用保活计时器</li>
<li>TCP服务器进程每收到一次TCP客户进程的数据，就重新设置并启动保活计时器(2小时定时)</li>
<li>若保活计时器定时周期内未收到TCP客户进程发来的数据，则当保活计时器到时后，TCP服务器进程就向TCP客户进程发送一个探测报文段，以后每隔75s发送一次。若一连发送10个探测报文段后仍无TCP客户进程的响应，TCP服务器进程就认为TCP客户进程所在主机出了故障，接着就关闭这个连接。</li>
</ul>
</li>
</ul>
<h2 id="59-tcp报文段首部格式">5.9 TCP报文段首部格式</h2>
<ul>
<li>为了实现可靠传输，TCP采用了面向字节流的方式</li>
<li>TCP在发送数据时，是从发送缓存取出一部分或全部字节并给其添加一个首部使之成为TCP报文段后进行发送
<ul>
<li>一个TCP报文段由首部和数据载荷两部分构成
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-24%2021.02.23.png" alt=""></li>
</ul>
</li>
<li>TCP报文段的首部格式
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-24%2021.27.09.png" alt="">
<ul>
<li>20字节固定首部</li>
<li>最大40字节扩展首部</li>
<li>源端口 16bit，写入源端口号，用来标识发送该TCP报文段的应用进程</li>
<li>目的端口 16bit，写入目的端口号，用来标识接受该TCP报文段的应用进程</li>
<li>序号 32bit，序号增加到最后一个后，下一个序号又回到0
<ul>
<li>用来指出本TCP报文段数据载荷的第一个字节的序号</li>
</ul>
</li>
<li>确认号 32bit，确认号增加到最后一个后，下一个确认号就又回到0
<ul>
<li>指出期望收到对方下一个TCP报文段的数据载荷的第一个自己的序号，同时也是对之前收到的所有数据的确认</li>
</ul>
</li>
<li>确认标志位ACK：取值为1时确认号字段才有效；取值为0时确认号字段无效
<ul>
<li>TCP规定，在连接建立后所有传送的TCP报文段都必须把ACK置1</li>
</ul>
</li>
<li>数据偏移字段 4bit，以4字节为单位
<ul>
<li>用来指出TCP报文段的数据载荷部分的起始处距离TCP报文段的起始处有多远</li>
<li>这个字段实际上是指出了TCP报文段的首部长度</li>
<li>首部固定长度为20字节，因此数据偏移字段的最小值为(0101)<sub>2</sub></li>
<li>首部最大长度为60字节，因此数据便宜字段的最大值为(1111)<sub>2</sub></li>
</ul>
</li>
<li>保留字段 6bit，保留为今后使用，但目前应置为0</li>
<li>窗口字段 16bit，以字节为单位
<ul>
<li>指出发送本报文字段的一方的接受窗口</li>
<li>窗口值作为接收方让发送方设置其发送窗口的依据</li>
<li>这是以接收方的接受能力来控制发送方的发送能力，称为流量控制</li>
<li>发送窗口应在接收方接受窗口和拥塞窗口之中取小者</li>
</ul>
</li>
<li>校验和字段 16bit
<ul>
<li>检查范围包括TCP报文段首部和数据载荷两部分</li>
<li>计算校验和事，要在TCP报文段的前面加上12字节的伪首部</li>
</ul>
</li>
<li>同步标志位SYN
<ul>
<li>在TCP连接建立时用来同步序号</li>
</ul>
</li>
<li>终止标志位FIN
<ul>
<li>用来释放TCP连接</li>
</ul>
</li>
<li>复位标志位RST
<ul>
<li>用来复位TCP连接</li>
<li>当RST=1时，表明TCP连接出现了异常，必须释放连接，然后再重新建立连接</li>
<li>RST置1还用来拒绝一个非法的报文段或拒绝打开一个TCP连接</li>
</ul>
</li>
<li>推送标志位PSH
<ul>
<li>接收方的TCP收到该标志位为1的报文段会尽快上交应用进程，而不必等到接收缓存都填满后再向上交付</li>
</ul>
</li>
<li>紧急标志位URG
<ul>
<li>取值为1时紧急指针字段有效</li>
<li>取值为0时紧急指针字段无效</li>
</ul>
</li>
<li>紧急指针
<ul>
<li>16bit，以字节为单位，用来指明紧急数据的长度</li>
<li>当发送方有紧急数据时，可将紧急数据插队到发送缓存的最前面，并立刻封装到一个TCP报文段中进行发送</li>
<li>紧急指针会指出本报文段数据载荷部分包含了多长的紧急数据，紧急数据之后是普通数据</li>
</ul>
</li>
<li>选项(长度可变)最大40字节
<ul>
<li>增加TCP的功能</li>
<li>最大报文段长度MSS选项
<ul>
<li>TCP报文段数据载荷部分的最大长度</li>
</ul>
</li>
<li>窗口扩大选项
<ul>
<li>为了扩大窗口(提高吞吐率)</li>
</ul>
</li>
<li>时间戳选项
<ul>
<li>用来计算往返时间RTT</li>
<li>用于处理序号超范围的情况，又称为防止序号绕回PAWS</li>
</ul>
</li>
<li>选择确认选项，用来实现选择确认功能</li>
</ul>
</li>
<li>填充字段
<ul>
<li>确保报文段首部能被4整除(因为数据偏移字段，也就是首部长度字段，是以4字节为单位的)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="p6-应用层">P6 应用层</h1>
<h2 id="61-应用层概述">6.1 应用层概述</h2>
<ul>
<li>享受其下各层提供的服务，解决通过应用进程的交互来实现特定网络应用的问题</li>
<li>是计算机网络体系的最顶层，是设计和建立计算机网络的最终目的，也是计算机网络中发展最快的部分
<ul>
<li>早期基于文本的应用(电子邮件、远程登录、文件传输、新闻组)</li>
<li>20世界90年代将因特网带入千家万户的万维网WWW</li>
<li>当今流行的即时通信，P2P文件共享及各种音视频应用</li>
<li>计算设备的小型化和无处不在，宽带住宅接入和无线接入的日益普及和迅速发展，为未来更多的新型应用提供了广阔的舞台</li>
</ul>
</li>
<li>万维网WWW应用
<ul>
<li>超文本传送协议HTTP</li>
<li>输入域名</li>
<li>域名系统DNS</li>
<li>IP地址</li>
</ul>
</li>
<li>域名系统DNS</li>
<li>动态主机配置DHCP</li>
<li>电子邮件</li>
<li>文件传送FTP和P2P文件共享</li>
<li>多媒体网络应用</li>
</ul>
<h2 id="62-客户服务器方式cs方式和对等方式p2p方式">6.2 客户——服务器方式(C/S方式)和对等方式(P2P方式)</h2>
<ul>
<li>网络应用程序运行在处于网络边缘的不同端系统上，通过彼此间的通信来共同完成某项任务</li>
<li>开发一种新的网络应用首先要考虑的问题就是网络应用程序在各种端系统上的组织方式和它们之间的关系
<ul>
<li>客户/服务器(C/S)方式</li>
<li>对等(P2P)方式</li>
</ul>
</li>
<li>客户/服务器(C/S)方式
<ul>
<li>客户和服务器是指通信中所涉及的两个应用进程</li>
<li>客户/服务器方式所描述的是进程之间服务和被服务的关系</li>
<li>客户是服务请求方，服务器是服务提供方</li>
<li>服务器总是处于运行状态，并等待客户的服务请求。服务器具有固定的端口号(例如HTTP服务器的默认端口号为80)，而运行服务器的主机也具有固定的IP地址
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-25%2008.52.27.png" alt=""></li>
</ul>
</li>
<li>C/S方式是因特网上传统的、同时也是最成熟的方式，很多我们熟悉的网络应用采用的都是C/S方式。包括万维网WWW、电子邮件、文件传输FTP等</li>
<li>基于C/S方式的应用服务通常是服务集中型的，即应用服务集中在网络中必客户计算机少得多的服务器计算机上
<ul>
<li>由于一台服务器计算机要为多个客户机提供服务，在C/S应用中，常会出现服务器计算机跟不上众多客户机请求的情况</li>
<li>在C/S应用中，常用计算集群集(或服务器场)构建一个强大的虚拟服务器</li>
</ul>
</li>
<li>对等(P2P)方式
<ul>
<li>在P2P方式中，没有固定的服务请求者和服务提供者，分布在网络边缘各端系统中的应用进程是对等的，被称为对等方。对等方相互之间直接通信，每个对等方既是服务的请求者，又是服务的提供者</li>
<li>目前，在因特网上流行的P2P应用主要包括P2P文件共享、即时通信、P2P流媒体、分布式存储器等</li>
<li>基于P2P的应用是服务分散型的，因为服务不是集中在少数几个服务器计算机中，而是分散在大量对等计算机中，这些计算机并不为服务提供商所有，而是为个人控制的桌面计算机和笔记本电脑，它们通常位于住宅、校园和办公室中
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-25%2009.00.19.png" alt=""></li>
<li>P2P方式的最突出特性之一就是它的可扩展性。因为系统每增加一个对等方，不仅增加的是服务的请求者，同时也增加了服务的提供者，系统性能不会因规模的增大而降低</li>
<li>P2P方式具有成本上的优势，因为它通常不需要庞大的服务器设施和服务器带宽。为了降低成本，服务提供商对于将P2P方式用于应用的兴趣越来越大</li>
</ul>
</li>
</ul>
<h2 id="63-动态主机配置协议dhcp">6.3 动态主机配置协议DHCP</h2>
<ul>
<li>是应用层协议，使用运输层的UDP所提供的服务</li>
<li>熟知UDP端口
<ul>
<li>DHCP服务器67</li>
<li>DHCP客户68</li>
</ul>
</li>
<li>DHCP的作用
<ul>
<li>设置好可为网络中各主机配置的信息</li>
<li>主机开机后自动启动DHCP程序，向DHCP服务器请求自己的网路配置信息
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-25%2009.06.25.png" alt=""></li>
</ul>
</li>
<li>DHCP的工作过程
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-25%2009.35.18.png" alt="">
<ul>
<li>C/S方式</li>
<li>启用主机的DHCP后，DHCP客户将广播发送<strong>DHCP发现报文</strong>，封装该报文的IP数据报的源IP地址是0.0.0.0，目的IP地址为广播地址255.255.255.255</li>
<li>网络中的所有设备都收到IP数据包，解封出封装有DHCP发现报文的UDP数据报
<ul>
<li>对于DHCP客户，其应用层没有监听该UDP用户数据报目的端口67的进程，也就是DHCP服务器进程，因此无法交付DHCP发现报文，只能丢弃</li>
<li>对于DHCP服务器，其应用层使用运行着DHCP服务器进程，因此会接受该DHCP发现报文并作出响应</li>
<li>DHCP发现报文
<ul>
<li>事物ID</li>
<li>DHCP客户端的MAC地址</li>
</ul>
</li>
</ul>
</li>
<li>DHCP服务器在收到DHCP发现报文后，根据其中封装的DHCP客户端的MAC地址来查找自己的数据库，看是否有针对该MAC地址的配置信息
<ul>
<li>有，使用这些配置信息来构建并发送<strong>DHCP提供报文</strong>
<ul>
<li>配置信息
<ul>
<li>IP地址(使用<strong>ARP</strong>确保所选IP地址未被网络中其他主机占用)</li>
<li>子网掩码</li>
<li>地址租期</li>
<li>默认网关</li>
<li>DNS服务器</li>
</ul>
</li>
</ul>
</li>
<li>没有，采用默认配置信息来构建并发送DHCP提供报文</li>
<li>源IP地址为DHCP服务器的IP地址</li>
<li>目的IP地址仍为广播地址(主机目前还没有配置IP地址)
<ul>
<li>网络中的所有设备都会收到封装有DHCP提供报文的IP数据报，解封出封装有DHCP提供报文的UDP用户数据报
<ul>
<li>对于DHCP服务器，其应用层没有监听该UDP用户数据报目的端口68的进程，也就是DHCP客户进程，无法交付DHCP提供报文，丢弃</li>
<li>对于DHCP客户，其应用层运行时DHCP客户进程，因此会接受该DHCP提供报文，并作出相应报文
<ul>
<li>根据事物ID判断是否是自己所请求的报文(是否与自己之前发送的DHCP请求报文中的事物ID相等)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>在本例中，DHCP客户会收到两个DHCP服务器发送的DHCP提供报文
<ul>
<li>DHCP从中选择一个</li>
<li>一般选择先到的一个(假设选择DHCP服务器1)</li>
<li>从所选择的DHCP服务器发送<strong>DHCP请求报文</strong>
<ul>
<li>IP数据报源地址0.0.0.0(征得同意才能使用)</li>
<li>目的地址为广播地址-&gt;不用向网络中每一个DHCP服务器单播发送DHCP请求报文来告知是否请求
<ul>
<li>事物ID</li>
<li>DHCP客户端的MAC地址</li>
<li>接受的租约中的IP地址</li>
<li>提供此租约的DHCP服务器端的IP地址</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>DHCP服务器1接受该请求，向DHCP客户发送<strong>DHCP确认报文</strong>
<ul>
<li>源IP地址为DHCP服务器1的IP地址</li>
<li>目的地址为广播地址</li>
</ul>
</li>
<li>DHCP客户收到确认报文后就可以使用租用到的IP地址了
<ul>
<li>使用之前，主机还会使用<strong>ARP</strong>检测该IP地址是否已被网络中其他主机占用
<ul>
<li>若被占用，DHCP客户会给DHCP服务器发送DHCP谢绝报文，撤销IP地址租约，并重新发送DHCP发现报文</li>
<li>若未被占用，则可以使用租约中的IP地址与网络中的其他主机通信了</li>
</ul>
</li>
<li>租用期过了一半，DHCP客户会向DHCP服务器发送DHCP请求报文，来请求更新租用期
<ul>
<li>源IP地址：DHCP客户之前租用到的IP地址</li>
<li>目的地址：DHCP服务器1的地址</li>
</ul>
</li>
<li>DHCP服务器若同意，就发回DHCP确认报文-&gt;DHCP客户就得到了新的租用期</li>
<li>DHCP服务器若不同意，就发回DHCP否认报文-&gt;DHCP客户立即停止使用之前租用到的IP地址，并重新发送DHCP发现报文来重新申请IP地址</li>
<li>DHCP服务器未作出响应-&gt;租用期过了0.875之后，DHCP客户重新发送DHCP请求报文、继续等待反应
<ul>
<li>若DHCP服务器未作出响应-&gt;租用期过了之后立即停止使用并重新发送DHCP发现报文</li>
</ul>
</li>
</ul>
</li>
<li>DHCP客户可以随时终止DHCP服务器所提供的租用期，这时只需要向DHCP服务器发送DHCP释放报文段即可</li>
</ul>
</li>
<li>DHCP中继代理
<ul>
<li>给路由器配置DHCP服务器的IP地址并使之成为DHCP中继代理</li>
<li>原因：我们并不愿意在每一个网路中都设置一个DHCP服务器，而路由器会隔绝广播域，隔绝DHCP发现报文的发送</li>
</ul>
</li>
</ul>
<h2 id="64-域名系统dns">6.4 域名系统DNS</h2>
<ul>
<li>使用运输层的UDP协议进行封装，运输层端口号为53</li>
<li>域名系统DNS的作用
<ul>
<li>浏览器中输入域名-&gt;访问web服务器所提供的内容
<ul>
<li>输入web服务器域名</li>
<li>用户主机在DNS高速缓存中查找域名对应的IP地址</li>
<li>如果没有找到则会向网络中某台DNS服务器查询：DNS服务器有域名和IP地址映射关系的数据库</li>
<li>当DNS服务器收到DNS查询报文后，在其数据库中进行查询，之后将查询结果发送给用户主机</li>
<li>现在用户主机中的浏览器可以通过Web服务器的IP地址对其进行访问了</li>
<li>思考：因特网是否可以只使用一台DNS服务器？
<ul>
<li>不可取。因为因特网规模很大，这样的域名服务器肯定会因为超负荷而无法正常工作，而且一旦域名服务器出现故障，整个因特网就会瘫痪</li>
<li>早在1983年，因特网就开始采用层次结构的命名树作为主机的名字(即域名)，并使用分布式的域名系统DNS。</li>
<li>DNS使大多数域名都在本地解析，仅少量解析需要在因特网上通信，因此系统效率很高</li>
<li>由于DNS是分布式系统，即是单个计算机出了故障，也不会妨碍整个系统的正常运行</li>
</ul>
</li>
</ul>
</li>
<li>用户主机中通过ping命令测试用户主机与web服务器的连通性
<ul>
<li>ping+web服务器域名(但实际上是IP地址)</li>
</ul>
</li>
<li>域名更便于人们记忆-&gt;一般使用域名来访问</li>
</ul>
</li>
<li>因特网采用层次树状结构的域名结构
<ul>
<li>域名的结构由若干个分量组成，个分量之间用点隔开，分别代表不同级别的域名
<ul>
<li>每一级域名都由英文字母和数字组成，不超过63个字符，不区分大小写字母</li>
<li>级别最低的域名写在最左边，而级别最高的顶级域名写在最右边</li>
<li>完整的域名不超过255个字符</li>
<li>···.三级域名.二级域名.顶级域名</li>
</ul>
</li>
<li>域名系统既不规定一个域名需要包含多少个下级域名，也不规定每一级的域名代表什么意思</li>
<li>各级域名由其上一级的域名管理机构管理，而最高的顶级域名则由因特网名称与数字地址分配机构ICANN进行管理</li>
</ul>
</li>
<li>顶级域名TLD分为以下三类
<ul>
<li>国家顶级域名nTLD 采用ISO 3166的规定。如cn表示中国，us表示美国，uk表示英国、等等</li>
<li>通用顶级域名gTLD 最常见的通用顶级域名有七个，即: <strong>com(公司企业)</strong>、net(网络服务机构)、org(非营利性组织)、int(国际组织)、edu(美国教育结构)、gov(美国政府部门)、mil(美国军事部门)</li>
<li>反向域arpa 用于反向域名解析，即IP地址反向解析为域名</li>
</ul>
</li>
<li>在国家顶级域名下注册的二级域名均由该国家自行确定。例如，顶级域名为jp的日本，将其教育和企业机构的二级域名定为ac和co，而不用edu和com</li>
<li>我国则将二级域名划分为以下两类
<ul>
<li>类别域名：共七个
<ul>
<li>ac科研机构</li>
<li><strong>com工、商、金融等企业</strong></li>
<li>edu教育机构</li>
<li>gov政府部分</li>
<li>net提供网络服务的机构</li>
<li>mil军事机构</li>
<li>org非营利性组织</li>
</ul>
</li>
<li>行政区域名：34个
<ul>
<li>适用于我国的各省、自治区、直辖市</li>
<li>bj为北京市</li>
<li>sh为上海市</li>
<li>js为江苏省</li>
</ul>
</li>
</ul>
</li>
<li>名称相同的域名等级未必相同，注意区分</li>
<li>举例
<ul>
<li>这种按等级管理的命名方法便于维护名字的唯一性，并且也容易设计出一种高效的域名查询机制</li>
<li>需要注意的是，域名只是个逻辑概念，并不代表计算机所在的物理地点
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-25%2010.44.09.png" alt=""></li>
</ul>
</li>
<li>域名和IP地址的映射关系必须保存在域名服务器中，供所有其他应用查询。显然不能将所有信息都储存在一台域名服务器中。DNS使用分布在各地的域名服务器来实现域名到IP地址的转换</li>
<li>域名服务器可以划分为以下四种不同类型
<ul>
<li>根域名服务器
<ul>
<li>根域名服务器是最高层次的域名服务器。每个根域名服务器都知道所有的顶级域名服务器的域名及其IP地址。因特网上共有13个不同IP地址的根域名服务器。尽管我们将这13个根域名服务器中的每一个都视为单个的服务器，但“每台服务器”实际上是由许多分布在世界各地的计算机构成的服务器群集。当本域名服务器向根域名服务器发出查询请求时，路由器就把查询请求报文转发到离这个DNS客户最近的一个根域名服务器。这就加快了DNS查询过程，同时也更合理地利用了因特网的资源。根域名服务器通常并不直接对域名进行解析，而是返回该域名所属顶级域名的顶级域名服务器的IP地址</li>
<li>顶级域名服务器。负责管理在该顶级域名服务器注册的所有二级域名。当收到DNS查询请求时就给出相应的回答(可能是最后的结果，也可能是下一季权限域名服务器的IP地址)</li>
<li>权限域名服务器。这些域名服务器负责管理某个区的域名。每一个主机的域名都必须在某个权限域名服务器处注册登记。因此权限域名服务器知道其管辖的域名与IP地址的映射关系。另外，权限域名服务器还知道其下级域名服务器的地址</li>
<li>本地域名服务器。本地域名服务器<strong>不属于上述的域名服务器的等级结构</strong>。当一个主机发出DNS请求报文时，这个报文首先被送网该主机的本地域名服务器。本地域名服务器起着代理的作用，会将该报文转发到上述的域名服务器等级结构中。每一个因特网服务提供者ISP，一个大学，甚至一个大学里的学院，都可以拥有一个本地域名服务器，有时也称为默认域名服务器。本地域名服务器离用户较近，一般不超过几个路由器的距离，也有可能就在同一个局域网中。本地域名服务器的IP地址需要直接配置在需要域名解析的主机中。</li>
</ul>
</li>
<li>域名解析过程
<ul>
<li>递归查询
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-25%2010.59.37.png" alt=""></li>
<li>迭代查询
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-25%2011.00.09.png" alt=""></li>
</ul>
</li>
<li>高速缓存
<ul>
<li>为了提高DNS的查询效率，并减轻根域名服务器的负荷和减少因特网上的DNS查询报文数量，在域名服务器中广泛使用了高速缓存。高速缓存用来存放最近查询过的域名以及从何处获得域名映射信息的记录
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-25%2011.04.17.png" alt=""></li>
<li>由于域名到IP地址的映射关系不是永久不变，为保存高速缓存中的内容正确，域名服务器应为每项内容设置计时器并删除超过合理时间的项(例如，每个项目之存放两天)</li>
<li>不但在本地域名服务器中需要高速缓存，在用户主机中也很需要。许多用户主机在启动时从本地域名服务器下载域名和IP地址的全部数据库，维护存放自己最近使用的域名的高速缓存，并且旨在从缓存中找不到域名时才想域名服务器查询。同理，主机中也需要保持高速缓存中内容的正确性</li>
</ul>
</li>
<li>例
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-25%2011.12.15.png" alt=""></li>
</ul>
</li>
</ul>
<h2 id="65-文件传送协议ftp">6.5 文件传送协议FTP</h2>
<ul>
<li>将某台计算机中的文件通过网络传送到可能相距很远的另一台计算机中，是一项基本的网络应用，即文件传送</li>
<li>文件传送协议FTP是因特网上使用得最广泛的文件传送协议
<ul>
<li>FTP提供交互式的访问，允许客户指明文件的类型与格式(如指明是否使用ASCII码)，并允许文件具有存取权限(如访问文件的用户必须经过授权，并输入有效的口令)</li>
<li>FTP屏蔽了各计算机系统的细节，因而适合于在异构网络中任意计算机之间传送文件</li>
</ul>
</li>
<li>在因特网发展的早期阶段，用FTP传送文件约占整个因特网的通信量的三分之一，而电子邮件和域名系统所产生的通信量还要小于FTP所产生的通信量。只是到了1995年，万维网www的通信量才首次超过了FTP</li>
<li>FTP的应用
<ul>
<li>C/S模式</li>
<li>FTP服务器可能需要一台高性能和高可靠性的服务器计算机也可能只需要一台普通的个人计算机即可</li>
<li>在FTP服务计算机中创建FTP服务器，可以使用第三方的FTP服务器软件，也可以使用操作系统自带的FTP服务器软件</li>
<li>FTP的常见用途
<ul>
<li>在计算机之间传输文件，尤其是用于批量传输文件</li>
<li>让网站设计者将构成网站内容的大量文件批量上传到他们的Web服务器</li>
</ul>
</li>
</ul>
</li>
<li>FTP的基本工作原理
<ul>
<li>FTP服务器监听熟知端口号21</li>
<li>FTP客户随机选择临时端口号与FTP服务器建立TCP连接，用于FTP客户与服务器之间传送FTP的相关控制命令
<ul>
<li>FTP客户与服务器之间的命令通道</li>
<li>控制连接在整个会话期间一直保持打开，用于传送FTP相关控制命令</li>
</ul>
</li>
<li>主动模式
<ul>
<li>当有数据要传送时，FTP客户通过命令通道告知FTP服务器来与自己的另一个临时端口号建立TCP连接，建立数据通道</li>
<li>FTP客户随机选择另一个临时端口号与FTP的熟知端口号20建立TCP连接，用于FTP客户与服务器之间传送文件
<ul>
<li>FTP客户与服务器之间的数据通道</li>
<li>建立数据通道时，FTP服务器主动连接FTP客户，因此称为主动模式</li>
<li>数据连接用于文件传输，在每次文件传输时才建立，传输结束就关闭</li>
</ul>
</li>
</ul>
</li>
<li>被动模式
<ul>
<li>当有数据要传输时，FTP客户通过命令通道告知FTP服务器开启某个临时端口被动等待TCP连接，建立数据通道</li>
<li>FTP服务器使用与FTP客户协商好的临时端口号，FTP客户随机选择另一个端口号，FTP客户发起与FTP服务器的TCP连接，以建立数据通道
<ul>
<li>由于在建立数据通道时，FTP服务器被动带灯FTP客户的连接，因此称为被动模式</li>
<li>数据连接在每次数据传输完毕后就关闭
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-25%2014.15.49.png" alt=""></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="66-电子邮件">6.6 电子邮件</h2>
<ul>
<li>电子邮件(E-mail)是因特网上最早流行的一种应用，并且仍然是当今因特网上最重要、最实用的应用之一</li>
<li>传统的电话通信属于实时通信，存在以下两个缺点
<ul>
<li>电话通信的主叫和被叫双方必须同时在场</li>
<li>一些不是十分紧迫的电话也常常不必要的打断人们的工作或休息</li>
</ul>
</li>
<li>电子邮件与邮政系统的寄信相似
<ul>
<li>发件人将邮件发送到自己使用的邮件服务器</li>
<li>发件人的邮件服务器将收到的邮件按其目的地址转发到收件人邮件服务器中的收件人邮箱</li>
<li>收件人在方便的时候访问收件人邮件服务器中自己的邮箱，获取收到的电子邮件</li>
</ul>
</li>
<li>电子邮件使用方便、传递迅速而且费用低廉。它不仅可以传送文字信息，而且还可附上声音和图像</li>
<li>由于电子邮件的广泛使用，现在许多国家已经正式取消了电报业务。在我国，电信局的电报业务也因电子邮件的普及而濒临消失。</li>
<li>电子邮件系统采用C/S方式</li>
<li>三个主要组成构件
<ul>
<li>用户代理
<ul>
<li>用户与电子邮件系统的接口，又称为电子邮件客户端软件</li>
</ul>
</li>
<li>邮件服务器
<ul>
<li>电子邮件系统的基础设施。因特网上所有ISP都有邮件服务器，其功能是发送和接受邮件，同时还要负责维护用户的邮箱</li>
</ul>
</li>
<li>电子邮件所需协议
<ul>
<li>邮件发送协议，如SMTP</li>
<li>邮件读取协议，如POP3，IMAP
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-25%2014.34.04.png" alt=""></li>
</ul>
</li>
</ul>
</li>
<li>简单邮件传送协议SMTP的基本工作原理
<ul>
<li>发送方邮件服务器周期性地扫描邮件缓存</li>
<li>如果有待转发的邮件，则发送方邮件服务器中的SMTP客户会与接收方服务器中的SMTP服务器进行TCP连接，使用熟知端口号25</li>
<li>之后SMTP客户就可以基于这条TCP连接给SMTP服务器发送SMTP命令，共14条</li>
<li>SMTP服务器也会给SMTP客户发送相应的应答，共21中</li>
<li>SMTP客户与SMTP服务器之间，通过命令与应答的交互方式，最终实现SMTP客户发送邮件给SMTP服务器
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-25%2014.42.49.png" alt=""></li>
</ul>
</li>
<li>电子邮件的信息格式
<ul>
<li>并不是由SMTP定义的，而是在RFC 822中单独定义的。这个RFC文档已在2008年更新为RFC 5322</li>
<li>一个电子邮件有信封和内容两部分</li>
<li>内容又由首部和主体两部分构成</li>
<li>Cc：一个或多个收件人意外的抄送人的邮件地址
<ul>
<li>收送人收到邮件后可读可不读可回可不回
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-25%2014.50.43.png" alt=""></li>
</ul>
</li>
</ul>
</li>
<li>SMTP协议只能传送7bitASCII码文本数据，不能传送可执行文件或其他的二进制对象
<ul>
<li>SMTP不能满足传送多媒体邮件(例如带有图片、音频或视频数据)的需要。并且许多其他非英语国家的文(例如中文、俄文、甚至带有重音符号的法文或德文)也无法用SMTP传送</li>
<li>为解决SMTP传送非ASCII码文本的问题，提出了多用途因特网邮件扩展MIME
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-25%2014.55.53.png" alt="">
<ul>
<li>MIME增加了5个新的邮件首部字段，这些字段提供了有关邮件主体的信息</li>
<li>定义了许多邮件内容的格式，对多媒体电子邮件的表示方法进行了标准化</li>
<li>定义了传送编码，可对任何内容格式进行转换，而不会被邮件系统改变</li>
</ul>
</li>
<li>实际上，MIME不仅仅用于SMTP，也用于后来的同样面向ASCII字符的HTTP(超文本传送协议)</li>
</ul>
</li>
<li>常用的邮件读取协议(从邮件服务器向用户代理发送文件)
<ul>
<li>邮局协议POP
<ul>
<li>POP3是其第三个版本，是因特网正式标准</li>
<li>非常简单、功能有限的邮件读取协议。用户只能以下载并删除方式或下载并保留方式从邮件服务器下载邮件到用户方计算机。不允许用户在邮件服务器上管理自己的邮件(例如创建文件夹，对邮件进行分类管理等)</li>
</ul>
</li>
<li>因特网邮件访问协议IMAP
<ul>
<li>IMAP4是其第四个版本，目前还只是因特网建议标准</li>
<li>功能比POP3强大的邮件读取协议。用户在自己的计算机上就可以操控邮件服务器中的邮箱，就像在本地操控一样，因此IMAP是一个联机协议。</li>
</ul>
</li>
<li>POP3和IMAP4都采用基于TCP连接的C/S方式
<ul>
<li>POP3使用熟知端口110，IMAP4使用熟知端口143</li>
</ul>
</li>
</ul>
</li>
<li>基于万维网的电子邮件
<ul>
<li>通过浏览器登录(提供用户名和口令)邮件服务器万维网网站就可以撰写、首发、阅读和管理电子邮件。这种工作方式与IMAP很类似，不同的是用户计算机无需安装专门的用户代理程序，只需要使用通用的万维网浏览器。</li>
<li>邮件服务器网站通常都提供非常强大和方便的邮件管理功能，用户可以在邮件服务器网站上管理和处理自己的邮件，而不需要将邮件下载到本地进行管理
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-25%2015.16.06.png" alt=""></li>
</ul>
</li>
</ul>
<h2 id="万维网www">万维网WWW</h2>
<ul>
<li>万维网简介
<ul>
<li>万维网WWWW并非某种特殊的计算机网络。它是一个大规模的、联机式的信息储藏所，是运行在因特网上的一个分布式应用</li>
<li>万维网利用网页之间的超链接将不同网站的网页连接成一张逻辑上的信息网</li>
<li>万维网是欧洲粒子物理实验室的Tim Berners-Lee最初于1989年3月提出的</li>
<li>1993年2月，第一个图形界面的浏览器Mosaic</li>
<li>1995年著名的Netscape Navigator浏览器上市</li>
<li>目前比较流行的浏览器
<ul>
<li>Chrome-Blink</li>
<li>Firefox-Gecko</li>
<li>Safari-WebKit</li>
<li>Opera-Blink</li>
<li>Internet Explorer-Trident</li>
</ul>
</li>
<li>浏览器最重要的部分是渲染引擎，也就是浏览器内核。负责对网页内容进行解析和显示。
<ul>
<li>不同浏览器内核对网页内容的解析也有不同</li>
<li>网页编写者需要在不同内核的浏览器中测试网页显示效果
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-25%2015.31.34.png" alt=""></li>
</ul>
</li>
</ul>
</li>
<li>URL
<ul>
<li>为了方便的访问在世界范围内的文档，万维网使用统一资源定位符URL来之名因特网上任何种类“资源”的位置</li>
<li>URL的一般形式由以下四个部分组成:
<ul>
<li>&lt;协议&gt;://&lt;主机&gt;:&lt;端口&gt;/&lt;路径&gt;</li>
</ul>
</li>
<li>万维网的文档
<ul>
<li>htm
<ul>
<li>html超文本标记语言</li>
<li>使用多种“标签”来描述网页的结构和内容</li>
</ul>
</li>
<li>js
<ul>
<li>javascript一种脚本语言(和java没有任何关系)</li>
<li>控制网页的行为</li>
</ul>
</li>
<li>css
<ul>
<li>层叠样式表css</li>
<li>从审美的角度来描写网页的样式</li>
</ul>
</li>
<li>由浏览器内核进行接解释和渲染</li>
</ul>
</li>
</ul>
</li>
<li>超文本传输协议HTTP
<ul>
<li>HTTP定义了浏览器(即万维网客户进程)怎样向万维网服务器请求万维网文档，以及万维网服务器怎样把万维网文档传送给浏览器
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-25%2015.46.02.png" alt=""></li>
<li>HTTP/1.0采用非持续连接方式。在该方式下，每次浏览器要请求一个文件都要与服务器建立TCP连接，当收到相应后就立即关闭连接
<ul>
<li>每请求一个文档就要有两倍的RTT的开销。若一个网页上有很多引用对象(例如图片等)，那么请求每一个对象都需要花费2RTT的时间</li>
<li>为了减小时延，浏览器通常会建立多个并行的TP连接同时请求多个对象。但是，这会大量占用万维网服务器的资源，特别是万维网服务器往往要同师傅无语大量何苦的要求，这会使其负担很重
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-25%2015.51.21.png" alt=""></li>
</ul>
</li>
<li>HTTP/1.1采用持续连接方式。在该方式下，万维网服务器在发送响应后仍然保持这条连接，使同一个客户(浏览器)和该服务器可以继续在这条连接上传送后续的HTTP请求报文和响应报文。这并不局限于传送同一个页面上引用的对象，而是只要这些文档都在同一个服务器上就行
<ul>
<li>流水线方式工作
<ul>
<li>浏览器在收到HTTP的相应报文之前就能连续发送多个请求报文，服务器可发回一个接一个的响应报文，节省了很多个RTT时间，使TCP连接中的空闲时间减少，提高了下载文档的效率</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>HTTP的报文格式
<ul>
<li>面向文本</li>
<li>每个字段都是一些ASCII码串</li>
<li>每个字段长度都是不确定的</li>
<li>HTTP请求报文格式
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-25%2016.00.32.png" alt="">
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-25%2016.02.26.png" alt=""></li>
<li>HTTP响应报文格式
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-25%2016.03.55.png" alt="">
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-25%2016.04.58.png" alt=""></li>
</ul>
</li>
<li>使用Cookie在服务器上记录用户信息
<ul>
<li>早期的万维网应用非常简单，仅仅是用户查看存放在不同服务器上的各种静态的文档。因此HTTP被设计为一种无状态的洗衣，这样可以简化服务器的设计</li>
<li>现在，用户可以通过万维网实现各种复杂的应用，如网上购物、电子商务等。这些应用往往需要万维网服务器能够识别用户</li>
<li>Cookie提供了一种机制使得万维网能够“记住”用户，而无需用户主动提供用户标识信息。也就是说，Cookie是一种对无状态的HTTP进行状态化的技术
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-25%2016.10.23.png" alt=""></li>
</ul>
</li>
<li>万维网缓存与代理服务器
<ul>
<li>在万维网中还可以使用缓存机制提高万维网的效率</li>
<li>万维网缓存又称为Web缓存，可位于客户机，也可位于中间系统上，位于中间系统上的Web缓存又称为代理服务器</li>
<li>Web缓存把最近的一些请求和响应暂存在在本地磁盘中。当新请求到达时，若发现这个请求与暂时存放的请求相同，就返回暂存的响应，而不需要按URL的地址再次去因特网访问该资源
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-25%2016.16.28.png" alt="">
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-25%2016.17.38.png" alt=""></li>
<li>如果Web缓存的命中率比较高，就可以大大减少通信量，减小时延</li>
<li>解决文档修改后缓存与原文档不一致的问题
<ul>
<li>Last-Modified</li>
<li>Expires</li>
<li>判断是否过期
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-25%2016.22.32.png" alt="">
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-25%2016.23.48.png" alt=""></li>
</ul>
</li>
</ul>
</li>
<li>例
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-25%2016.25.51.png" alt="">
<img src="/images/%E6%88%AA%E5%B1%8F2024-05-25%2016.28.38.png" alt=""></li>
</ul>
</article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
<script type="application/javascript" src='https://y-m-m.github.io/js/toc.js'></script>
<link rel="stylesheet" href='https://y-m-m.github.io/css/toc.css' />

  
<div id="gitalk-container" class="gitalk-container"></div>
<link rel="stylesheet" href='https://y-m-m.github.io/css/gitalk.css'>
<script src='https://y-m-m.github.io/js/gitalk.min.js'></script>
<script>
  const gitalk = new Gitalk({
    clientID: 'Ov23livxKNtTlPeMjV2H',
    clientSecret: '6d3bc9f47a1296f29628a63701ea5624cd28a26b',
    repo: 'y-m-m.github.io',
    owner: 'Y-M-M',
    admin: ['Y-M-M'],
    id: eval("location.pathname"), 
    distractionFreeMode: false 
  });
  (function() {
    gitalk.render('gitalk-container');
  })();
</script>

</div>

  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="https://y-m-m.github.io/">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0">Theme by <a href='https://github.com/MeiK2333/github-style'>github-style</a></li>
      
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>
</body>

<script type="application/javascript" src="https://y-m-m.github.io/js/github-style.js"></script>





<script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js"></script>
<script type="application/javascript" src='https://y-m-m.github.io/js/search.js'></script>



</html>